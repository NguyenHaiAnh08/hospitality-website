{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///D:/Codes/Projects/hospitalityWeb/hospitality-website/my-app/src/app/datats/mockPatients.ts"],"sourcesContent":["// Dữ liệu được fetched từ API thay vì dùng static data\r\nimport axiosInstance from '../services/axios.customize.service';\r\n\r\n// Khai báo các interface\r\nexport interface User {\r\n  _id: string;\r\n  userId: string;\r\n  username: string;\r\n  email: string;\r\n  password: string;\r\n  fullName: string;\r\n  phone: string;\r\n  role: 'PATIENT' | 'DOCTOR' | 'PHARMACIST' | 'RECEPTIONIST' | 'ADMIN';\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  __v: number;\r\n}\r\n\r\nexport interface Queue {\r\n  _id: string;\r\n  patient: string; // ObjectId của bệnh nhân\r\n  status: 'waiting' | 'in_progress' | 'completed' | 'canceled';\r\n  doctorId?: string; // ObjectId của bác sĩ được chỉ định (nếu có)\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  __v: number;\r\n}\r\n\r\nexport interface Prescription {\r\n  _id: string;\r\n  customPrescriptionId: string;\r\n  patientId: string; // ObjectId\r\n  doctorId: string; // ObjectId\r\n  diagnosis: string;\r\n  date: string;\r\n  status: 'PENDING_DISPENSE' | 'DISPENSED' | 'CANCELED';\r\n  __v: number;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface PrescriptionDetail {\r\n  _id: string;\r\n  customPrescriptionDetailId: string;\r\n  prescriptionId: string; // ObjectId\r\n  medicineId: string; // ObjectId\r\n  quantity: number;\r\n  dosage: string;\r\n  __v: number;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface Medicine {\r\n  _id: string;\r\n  customMedicineId: string;\r\n  name: string;\r\n  totalPills: number;\r\n  price: number;\r\n  __v: number;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface Invoice {\r\n  _id: string;\r\n  prescriptionId: string; // ObjectId\r\n  patientId: string; // ObjectId\r\n  totalAmount: number;\r\n  status: 'PAID' | 'UNPAID';\r\n  __v: number;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n// Biến cache để lưu trữ dữ liệu từ API\r\nexport let mockUsers: User[] = [];\r\nexport let mockQueues: Queue[] = [];\r\nexport let mockMedicines: Medicine[] = [];\r\nexport let mockPrescriptions: Prescription[] = [];\r\nexport let mockPrescriptionDetails: PrescriptionDetail[] = [];\r\nexport let mockInvoices: Invoice[] = [];\r\n\r\n// Biến toàn cục để lưu token xác thực\r\nlet authToken: string | null = null;\r\n\r\n// Hàm thiết lập token khi người dùng đăng nhập\r\nexport const setAuthToken = (token: string) => {\r\n  authToken = token;\r\n  if (typeof window !== 'undefined') { // Kiểm tra nếu đang chạy trên browser\r\n    localStorage.setItem('authToken', token); // Lưu token vào localStorage để giữ qua refresh\r\n  }\r\n};\r\n\r\n// Hàm để lấy token hiện tại\r\nexport const getAuthToken = () => {\r\n  // Nếu không có token trong memory, thử lấy từ localStorage\r\n  if (!authToken && typeof window !== 'undefined') {\r\n    authToken = localStorage.getItem('authToken');\r\n  }\r\n  return authToken;\r\n};\r\n\r\n// Helper function để thực hiện API call có xác thực\r\nconst authenticatedGet = async (endpoint: string) => {\r\n  try {\r\n    // Lấy token từ localStorage hoặc cookies\r\n    let token = getAuthToken();\r\n    \r\n    // Thử lấy token từ cookies nếu không tìm thấy trong localStorage\r\n    if (!token && typeof document !== 'undefined') {\r\n      // Check browser cookies if localStorage doesn't have the token\r\n      const cookies = document.cookie.split(';');\r\n      const tokenCookie = cookies.find(c => c.trim().startsWith('token='));\r\n      if (tokenCookie) {\r\n        token = tokenCookie.split('=')[1];\r\n        console.log(\"Found token in cookies, using it for API calls\");\r\n        // Lưu lại vào authToken để sử dụng cho các lần sau\r\n        setAuthToken(token);\r\n      }\r\n    }\r\n    \r\n    if (!token) {\r\n      console.warn('No authentication token available for API call to:', endpoint);\r\n      console.warn('Please login first or check token storage.');\r\n      return null;\r\n    }\r\n\r\n    console.log(`Making authenticated request to ${endpoint}`);\r\n    console.log(`Using token (first 10 chars): ${token.substring(0, 10)}...`);\r\n\r\n    const response = await axiosInstance.get(endpoint, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`\r\n      }\r\n    });\r\n    \r\n    console.log(`Successful response from ${endpoint}:`, response.status);\r\n    if (Array.isArray(response.data)) {\r\n      console.log(`Got ${response.data.length} items from ${endpoint}`);\r\n    } else {\r\n      console.log(`Got data from ${endpoint}:`, response.data ? 'Object returned' : 'Empty response');\r\n    }\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(`Error fetching from ${endpoint}:`, error.message);\r\n    \r\n    // Log more detailed error info\r\n    if (error.response) {\r\n      console.error('Response status:', error.response.status);\r\n      console.error('Response data:', error.response.data);\r\n      \r\n      if (error.response.status === 403) {\r\n        console.error(`Access forbidden to ${endpoint} - check user permissions`);\r\n      } else if (error.response.status === 401) {\r\n        console.error(`Unauthorized access to ${endpoint} - token may be expired`);\r\n        // Thử xóa token để người dùng phải đăng nhập lại\r\n        if (typeof window !== 'undefined') {\r\n          localStorage.removeItem('authToken');\r\n          document.cookie = 'token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';\r\n          authToken = null;\r\n        }\r\n      }\r\n    } else if (error.request) {\r\n      console.error('No response received from request. Server may be down.');\r\n    } else {\r\n      console.error('Error setting up request:', error.message);\r\n    }\r\n    \r\n    return null;\r\n  }\r\n};\r\n\r\n// ============= FETCH DATA FUNCTIONS =============\r\n\r\n// Load users từ API\r\nexport const fetchUsers = async () => {\r\n  console.log('Fetching users from API...');\r\n  \r\n  // Đầu tiên thử lấy thông tin user hiện tại để biết role\r\n  try {\r\n    const currentUser = await authenticatedGet('/users/me');\r\n    \r\n    if (currentUser) {\r\n      console.log(`Current user role: ${currentUser.role}`);\r\n      \r\n      if (currentUser.role === 'ADMIN') {\r\n        // Nếu là ADMIN, có quyền lấy tất cả users\r\n        console.log('User is ADMIN, trying to fetch all users');\r\n        const data = await authenticatedGet('/users');\r\n        \r\n        if (data && Array.isArray(data)) {\r\n          console.log(`Successfully fetched ${data.length} users from API`);\r\n          mockUsers = data;\r\n          return data;\r\n        }\r\n      } \r\n      \r\n      // Dù là role nào, thử dùng endpoint mới để lấy danh sách bệnh nhân\r\n      if (['ADMIN', 'DOCTOR', 'PHARMACIST', 'RECEPTIONIST'].includes(currentUser.role)) {\r\n        console.log(`Trying to fetch patients using /users/patients endpoint for ${currentUser.role}`);\r\n        const patients = await authenticatedGet('/users/patients');\r\n        \r\n        if (patients && Array.isArray(patients)) {\r\n          console.log(`Successfully fetched ${patients.length} patients from API`);\r\n          \r\n          // Kết hợp với dữ liệu hiện có (nếu có)\r\n          // Giữ lại các user không phải bệnh nhân từ danh sách hiện có (nếu có)\r\n          const nonPatients = mockUsers.filter(user => user.role !== 'PATIENT');\r\n          mockUsers = [...nonPatients, ...patients];\r\n          \r\n          console.log(`Combined user data: ${mockUsers.length} users (${nonPatients.length} non-patients + ${patients.length} patients)`);\r\n          return mockUsers;\r\n        }\r\n      }\r\n      \r\n      // Nếu không thể lấy dữ liệu, giữ nguyên dữ liệu mockUsers hiện tại\r\n      console.log(`Using existing mock data with ${mockUsers.length} users`);\r\n      return [...mockUsers];\r\n    } else {\r\n      console.error('Could not fetch current user info, authentication may be invalid');\r\n      return mockUsers;\r\n    }\r\n  } catch (error) {\r\n    console.error('Error in fetchUsers:', error);\r\n    return mockUsers;\r\n  }\r\n};\r\n\r\n// Load queues từ API\r\nexport const fetchQueues = async () => {\r\n  const data = await authenticatedGet('/queues');\r\n  if (data && Array.isArray(data)) {\r\n    mockQueues = data;\r\n    return data;\r\n  }\r\n  return [];\r\n};\r\n\r\n// Load medicines từ API\r\nexport const fetchMedicines = async () => {\r\n  const data = await authenticatedGet('/medicines');\r\n  if (data && Array.isArray(data)) {\r\n    mockMedicines = data;\r\n    return data;\r\n  }\r\n  return [];\r\n};\r\n\r\n// Load prescriptions từ API\r\nexport const fetchPrescriptions = async () => {\r\n  const data = await authenticatedGet('/prescriptions');\r\n  if (data && Array.isArray(data)) {\r\n    mockPrescriptions = data;\r\n    return data;\r\n  }\r\n  return [];\r\n};\r\n\r\n// Load prescription details từ API\r\nexport const fetchPrescriptionDetails = async () => {\r\n  const data = await authenticatedGet('/prescription-details');\r\n  if (data && Array.isArray(data)) {\r\n    mockPrescriptionDetails = data;\r\n    return data;\r\n  }\r\n  return [];\r\n};\r\n\r\n// Load invoices từ API\r\nexport const fetchInvoices = async () => {\r\n  const data = await authenticatedGet('/invoices');\r\n  if (data && Array.isArray(data)) {\r\n    mockInvoices = data;\r\n    return data;\r\n  }\r\n  return [];\r\n};\r\n\r\n// Initialize all data (call when app starts)\r\nexport const initializeData = async () => {\r\n  console.log('Initializing data from API or mock sources...');\r\n  \r\n  try {\r\n    // Check if we have a valid token first\r\n    const token = getAuthToken();\r\n    if (!token) {\r\n      console.warn('No authentication token found, will use existing mock data');\r\n      return false;\r\n    }\r\n    \r\n    // Try to validate token\r\n    try {\r\n      console.log('Validating token before fetching data...');\r\n      const currentUser = await authenticatedGet('/users/me');\r\n      if (!currentUser) {\r\n        console.error('Token validation failed, cannot fetch data');\r\n        return false;\r\n      }\r\n      console.log(`Token valid, logged in as ${currentUser.username} (${currentUser.role})`);\r\n    } catch (error) {\r\n      console.error('Error validating token:', error);\r\n      return false;\r\n    }\r\n    \r\n    // Initialize with separate try/catch for each resource type\r\n    // This allows some data to load even if others fail\r\n    const results = {\r\n      users: false,\r\n      queues: false,\r\n      medicines: false,\r\n      prescriptions: false,\r\n      prescriptionDetails: false,\r\n      invoices: false\r\n    };\r\n    \r\n    try {\r\n      await fetchUsers();\r\n      results.users = true;\r\n      console.log(`Users loaded: ${mockUsers.length} items`);\r\n    } catch (error) {\r\n      console.error('Error loading users:', error);\r\n    }\r\n    \r\n    try {\r\n      await fetchQueues();\r\n      results.queues = true;\r\n      console.log(`Queues loaded: ${mockQueues.length} items`);\r\n    } catch (error) {\r\n      console.error('Error loading queues:', error);\r\n    }\r\n    \r\n    try {\r\n      await fetchMedicines();\r\n      results.medicines = true;\r\n      console.log(`Medicines loaded: ${mockMedicines.length} items`);\r\n    } catch (error) {\r\n      console.error('Error loading medicines:', error);\r\n    }\r\n    \r\n    try {\r\n      await fetchPrescriptions();\r\n      results.prescriptions = true;\r\n      console.log(`Prescriptions loaded: ${mockPrescriptions.length} items`);\r\n    } catch (error) {\r\n      console.error('Error loading prescriptions:', error);\r\n    }\r\n    \r\n    try {\r\n      await fetchPrescriptionDetails();\r\n      results.prescriptionDetails = true;\r\n      console.log(`Prescription details loaded: ${mockPrescriptionDetails.length} items`);\r\n    } catch (error) {\r\n      console.error('Error loading prescription details:', error);\r\n    }\r\n    \r\n    try {\r\n      await fetchInvoices();\r\n      results.invoices = true;\r\n      console.log(`Invoices loaded: ${mockInvoices.length} items`);\r\n    } catch (error) {\r\n      console.error('Error loading invoices:', error);\r\n    }\r\n    \r\n    const successCount = Object.values(results).filter(Boolean).length;\r\n    console.log(`Data initialization complete: ${successCount}/6 resource types loaded successfully`);\r\n    \r\n    return successCount > 0;\r\n  } catch (error) {\r\n    console.error('Error in data initialization:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// ============= USER-RELATED FUNCTIONS =============\r\n\r\nexport const getAllUsers = async () => {\r\n  if (mockUsers.length === 0) {\r\n    await fetchUsers();\r\n  }\r\n  return [...mockUsers];\r\n};\r\n\r\nexport const getUserById = async (id: string) => {\r\n  if (mockUsers.length === 0) {\r\n    await fetchUsers();\r\n  }\r\n  return mockUsers.find(user => user._id === id);\r\n};\r\n\r\nexport const getUsersByRole = async (role: string) => {\r\n  if (mockUsers.length === 0) {\r\n    await fetchUsers();\r\n  }\r\n  return mockUsers.filter(user => user.role === role);\r\n};\r\n\r\nexport const searchUsers = async (searchTerm: string) => {\r\n  if (mockUsers.length === 0) {\r\n    await fetchUsers();\r\n  }\r\n  const term = searchTerm.toLowerCase();\r\n  return mockUsers.filter(user => \r\n    user.fullName.toLowerCase().includes(term) || \r\n    user.username.toLowerCase().includes(term) ||\r\n    user.email.toLowerCase().includes(term) ||\r\n    user.phone.includes(term) ||\r\n    user.userId.includes(term)\r\n  );\r\n};\r\n\r\n// ============= QUEUE-RELATED FUNCTIONS =============\r\n\r\nexport const getAllQueues = async () => {\r\n  if (mockQueues.length === 0) {\r\n    await fetchQueues();\r\n  }\r\n  return [...mockQueues];\r\n};\r\n\r\nexport const getQueuesByStatus = async (status: string) => {\r\n  if (mockQueues.length === 0) {\r\n    await fetchQueues();\r\n  }\r\n  return mockQueues.filter(queue => queue.status === status);\r\n};\r\n\r\nexport const getQueueByPatientId = async (patientId: string) => {\r\n  if (mockQueues.length === 0) {\r\n    await fetchQueues();\r\n  }\r\n  return mockQueues.find(queue => queue.patient === patientId);\r\n};\r\n\r\nexport const addQueue = async (patientId: string, status: 'waiting' | 'in_progress' | 'completed' | 'canceled' = 'waiting') => {\r\n  // Kiểm tra xem patientId có tồn tại và là bệnh nhân không\r\n  const patient = await getUserById(patientId);\r\n  if (!patient || patient.role !== 'PATIENT') {\r\n    console.error('Invalid patient ID or user is not a patient');\r\n    return null;\r\n  }\r\n\r\n  // Kiểm tra xem bệnh nhân đã có trong queue chưa\r\n  const existingQueue = await getQueueByPatientId(patientId);\r\n  if (existingQueue) {\r\n    console.warn('Patient already in queue');\r\n    return existingQueue;\r\n  }\r\n\r\n  // Tạo queue mới\r\n  const newQueue: Queue = {\r\n    _id: generateMongoId(),\r\n    patient: patientId,\r\n    status: status,\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString(),\r\n    __v: 0\r\n  };\r\n\r\n  // Gọi API để tạo queue thực sự qua API\r\n  try {\r\n    // Đây là phần sẽ gọi API thực tế\r\n    // const response = await axiosInstance.post('/queues', newQueue, {\r\n    //   headers: { Authorization: `Bearer ${getAuthToken()}` }\r\n    // });\r\n    // if (response.data) {\r\n    //   mockQueues.push(response.data);\r\n    //   return response.data;\r\n    // }\r\n    \r\n    // Hiện tại, chúng ta chỉ thêm vào cache\r\n    mockQueues.push(newQueue);\r\n    return newQueue;\r\n  } catch (error) {\r\n    console.error('Error creating queue:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const updateQueueStatus = async (\r\n  queueId: string, \r\n  status: 'waiting' | 'in_progress' | 'completed' | 'canceled', \r\n  doctorId?: string\r\n) => {\r\n  if (mockQueues.length === 0) {\r\n    await fetchQueues();\r\n  }\r\n  \r\n  const index = mockQueues.findIndex(queue => queue._id === queueId);\r\n  if (index !== -1) {\r\n    const updatedQueue = {\r\n      ...mockQueues[index],\r\n      status: status,\r\n      updatedAt: new Date().toISOString()\r\n    };\r\n    \r\n    if (doctorId && status === 'in_progress') {\r\n      updatedQueue.doctorId = doctorId;\r\n    }\r\n    \r\n    // Thực tế sẽ gọi API để cập nhật queue\r\n    // const response = await axiosInstance.put(`/queues/${queueId}`, updatedQueue, {\r\n    //   headers: { Authorization: `Bearer ${getAuthToken()}` }\r\n    // });\r\n    \r\n    // Hiện tại chỉ cập nhật trong cache\r\n    mockQueues[index] = updatedQueue;\r\n    return mockQueues[index];\r\n  }\r\n  return null;\r\n};\r\n\r\nexport const deleteQueue = async (queueId: string) => {\r\n  if (mockQueues.length === 0) {\r\n    await fetchQueues();\r\n  }\r\n  \r\n  const index = mockQueues.findIndex(queue => queue._id === queueId);\r\n  if (index !== -1) {\r\n    const deletedQueue = mockQueues[index];\r\n    \r\n    // Thực tế sẽ gọi API để xóa queue\r\n    // await axiosInstance.delete(`/queues/${queueId}`, {\r\n    //   headers: { Authorization: `Bearer ${getAuthToken()}` }\r\n    // });\r\n    \r\n    // Hiện tại chỉ xóa trong cache\r\n    mockQueues.splice(index, 1);\r\n    return deletedQueue;\r\n  }\r\n  return null;\r\n};\r\n\r\n// ============= MEDICINE-RELATED FUNCTIONS =============\r\n\r\nexport const getAllMedicines = async () => {\r\n  if (mockMedicines.length === 0) {\r\n    await fetchMedicines();\r\n  }\r\n  return [...mockMedicines];\r\n};\r\n\r\nexport const getMedicineById = async (id: string) => {\r\n  if (mockMedicines.length === 0) {\r\n    await fetchMedicines();\r\n  }\r\n  return mockMedicines.find(medicine => medicine._id === id);\r\n};\r\n\r\nexport const searchMedicines = async (searchTerm: string) => {\r\n  if (mockMedicines.length === 0) {\r\n    await fetchMedicines();\r\n  }\r\n  const term = searchTerm.toLowerCase();\r\n  return mockMedicines.filter(medicine => \r\n    medicine.name.toLowerCase().includes(term) || \r\n    medicine.customMedicineId.toLowerCase().includes(term)\r\n  );\r\n};\r\n\r\n// ============= PRESCRIPTION-RELATED FUNCTIONS =============\r\n\r\nexport const getAllPrescriptions = async () => {\r\n  if (mockPrescriptions.length === 0) {\r\n    await fetchPrescriptions();\r\n  }\r\n  return [...mockPrescriptions];\r\n};\r\n\r\nexport const getPrescriptionById = async (id: string) => {\r\n  if (mockPrescriptions.length === 0) {\r\n    await fetchPrescriptions();\r\n  }\r\n  return mockPrescriptions.find(prescription => prescription._id === id);\r\n};\r\n\r\nexport const getPrescriptionsByPatientId = async (patientId: string) => {\r\n  if (mockPrescriptions.length === 0) {\r\n    await fetchPrescriptions();\r\n  }\r\n  return mockPrescriptions.filter(prescription => prescription.patientId === patientId);\r\n};\r\n\r\nexport const getPrescriptionsByDoctorId = async (doctorId: string) => {\r\n  if (mockPrescriptions.length === 0) {\r\n    await fetchPrescriptions();\r\n  }\r\n  return mockPrescriptions.filter(prescription => prescription.doctorId === doctorId);\r\n};\r\n\r\nexport const getPrescriptionsByStatus = async (status: string) => {\r\n  if (mockPrescriptions.length === 0) {\r\n    await fetchPrescriptions();\r\n  }\r\n  return mockPrescriptions.filter(prescription => prescription.status === status);\r\n};\r\n\r\n// ============= PRESCRIPTION DETAIL-RELATED FUNCTIONS =============\r\n\r\nexport const getAllPrescriptionDetails = async () => {\r\n  if (mockPrescriptionDetails.length === 0) {\r\n    await fetchPrescriptionDetails();\r\n  }\r\n  return [...mockPrescriptionDetails];\r\n};\r\n\r\nexport const getPrescriptionDetailsByPrescriptionId = async (prescriptionId: string) => {\r\n  if (mockPrescriptionDetails.length === 0) {\r\n    await fetchPrescriptionDetails();\r\n  }\r\n  return mockPrescriptionDetails.filter(detail => detail.prescriptionId === prescriptionId);\r\n};\r\n\r\nexport const getMedicinesForPrescription = async (prescriptionId: string) => {\r\n  const details = await getPrescriptionDetailsByPrescriptionId(prescriptionId);\r\n  \r\n  const result = [];\r\n  for (const detail of details) {\r\n    const medicine = await getMedicineById(detail.medicineId);\r\n    result.push({\r\n      ...detail,\r\n      medicine: medicine || null\r\n    });\r\n  }\r\n  \r\n  return result;\r\n};\r\n\r\n// ============= INVOICE-RELATED FUNCTIONS =============\r\n\r\nexport const getAllInvoices = async () => {\r\n  if (mockInvoices.length === 0) {\r\n    await fetchInvoices();\r\n  }\r\n  return [...mockInvoices];\r\n};\r\n\r\nexport const getInvoiceById = async (id: string) => {\r\n  if (mockInvoices.length === 0) {\r\n    await fetchInvoices();\r\n  }\r\n  return mockInvoices.find(invoice => invoice._id === id);\r\n};\r\n\r\nexport const getInvoiceByPrescriptionId = async (prescriptionId: string) => {\r\n  if (mockInvoices.length === 0) {\r\n    await fetchInvoices();\r\n  }\r\n  return mockInvoices.find(invoice => invoice.prescriptionId === prescriptionId);\r\n};\r\n\r\nexport const getInvoicesByPatientId = async (patientId: string) => {\r\n  if (mockInvoices.length === 0) {\r\n    await fetchInvoices();\r\n  }\r\n  return mockInvoices.filter(invoice => invoice.patientId === patientId);\r\n};\r\n\r\nexport const getInvoicesByStatus = async (status: string) => {\r\n  if (mockInvoices.length === 0) {\r\n    await fetchInvoices();\r\n  }\r\n  return mockInvoices.filter(invoice => invoice.status === status);\r\n};\r\n\r\n// ============= UTILITY FUNCTIONS =============\r\n\r\nexport const getPatientFullPrescriptionDetails = async (patientId: string) => {\r\n  const prescriptions = await getPrescriptionsByPatientId(patientId);\r\n  \r\n  const result = [];\r\n  for (const prescription of prescriptions) {\r\n    // Lấy thông tin bác sĩ\r\n    const doctor = await getUserById(prescription.doctorId);\r\n    \r\n    // Lấy chi tiết đơn thuốc và thông tin thuốc\r\n    const details = await getPrescriptionDetailsByPrescriptionId(prescription._id);\r\n    const medicineDetails = [];\r\n    \r\n    for (const detail of details) {\r\n      const medicine = await getMedicineById(detail.medicineId);\r\n      medicineDetails.push({\r\n        ...detail,\r\n        medicineName: medicine ? medicine.name : 'Unknown',\r\n        medicinePrice: medicine ? medicine.price : 0\r\n      });\r\n    }\r\n    \r\n    // Lấy hóa đơn nếu có\r\n    const invoice = await getInvoiceByPrescriptionId(prescription._id);\r\n    \r\n    result.push({\r\n      ...prescription,\r\n      doctorName: doctor ? doctor.fullName : 'Unknown',\r\n      details: medicineDetails,\r\n      invoice: invoice || null\r\n    });\r\n  }\r\n  \r\n  return result;\r\n};\r\n\r\nexport const getAllPatients = async () => {\r\n  if (mockUsers.length === 0) {\r\n    await fetchUsers();\r\n  }\r\n  return mockUsers.filter(user => user.role === 'PATIENT');\r\n};\r\n\r\nexport const getAllDoctors = async () => {\r\n  if (mockUsers.length === 0) {\r\n    await fetchUsers();\r\n  }\r\n  return mockUsers.filter(user => user.role === 'DOCTOR');\r\n};\r\n\r\nexport type Patient = User;\r\nexport const mockPatients = getAllPatients;\r\n\r\nexport const getWaitingPatients = async () => {\r\n  const waitingQueues = await getQueuesByStatus('waiting');\r\n  \r\n  const result = [];\r\n  for (const queue of waitingQueues) {\r\n    const patient = await getUserById(queue.patient);\r\n    result.push({\r\n      queueInfo: queue,\r\n      patientInfo: patient || null\r\n    });\r\n  }\r\n  \r\n  return result;\r\n};\r\n\r\nexport const getAllQueuesWithPatientInfo = async () => {\r\n  if (mockQueues.length === 0) {\r\n    await fetchQueues();\r\n  }\r\n  \r\n  const result = [];\r\n  for (const queue of mockQueues) {\r\n    const patient = await getUserById(queue.patient);\r\n    result.push({\r\n      ...queue,\r\n      patientInfo: patient || null\r\n    });\r\n  }\r\n  \r\n  return result;\r\n};\r\n\r\n// Hàm tạo MongoDB-like ID\r\nexport const generateMongoId = () => {\r\n  // MongoDB ObjectId format: 24 hex characters\r\n  const timestamp = Math.floor(Date.now() / 1000).toString(16).padStart(8, '0');\r\n  const randomPart = Array(16).fill(0).map(() => Math.floor(Math.random() * 16).toString(16)).join('');\r\n  return timestamp + randomPart;\r\n};\r\n\r\n// Hàm để làm mới/reload dữ liệu từ API\r\nexport const reloadData = async (dataTypes?: ('users' | 'queues' | 'medicines' | 'prescriptions' | 'prescriptionDetails' | 'invoices')[]) => {\r\n  if (!dataTypes || dataTypes.length === 0) {\r\n    // Reload tất cả\r\n    return await initializeData();\r\n  }\r\n\r\n  const promises = [];\r\n  if (dataTypes.includes('users')) promises.push(fetchUsers());\r\n  if (dataTypes.includes('queues')) promises.push(fetchQueues());\r\n  if (dataTypes.includes('medicines')) promises.push(fetchMedicines());\r\n  if (dataTypes.includes('prescriptions')) promises.push(fetchPrescriptions());\r\n  if (dataTypes.includes('prescriptionDetails')) promises.push(fetchPrescriptionDetails());\r\n  if (dataTypes.includes('invoices')) promises.push(fetchInvoices());\r\n  \r\n  await Promise.all(promises);\r\n  return {\r\n    users: mockUsers.length,\r\n    queues: mockQueues.length,\r\n    medicines: mockMedicines.length,\r\n    prescriptions: mockPrescriptions.length,\r\n    prescriptionDetails: mockPrescriptionDetails.length,\r\n    invoices: mockInvoices.length\r\n  };\r\n};\r\n\r\n// Hàm thay thế để lấy dữ liệu khi không có quyền admin\r\nexport const fetchUsersAlternative = async () => {\r\n  console.log('Trying alternative method to fetch users...');\r\n  \r\n  try {\r\n    // Thử lấy thông tin người dùng hiện tại (me endpoint)\r\n    const currentUser = await authenticatedGet('/users/me');\r\n    if (!currentUser) {\r\n      console.warn('Could not fetch current user');\r\n      return [];\r\n    }\r\n    \r\n    console.log('Current user retrieved:', currentUser.role);\r\n    \r\n    if (currentUser.role === 'ADMIN') {\r\n      // Nếu là admin, thử lại với endpoint /users\r\n      return await fetchUsers();\r\n    }\r\n    \r\n    // Không phải admin, phải dùng cách khác\r\n    // 1. Nếu là bác sĩ, có thể lấy danh sách bệnh nhân được chỉ định\r\n    // 2. Nếu là receptionist, thử lấy dữ liệu theo cách khác\r\n    \r\n    // Endpoint hoặc API call thích hợp theo role\r\n    // Ví dụ: const patients = await authenticatedGet('/appointments/patients');\r\n    \r\n    // Tạm thời giữ nguyên dữ liệu hiện tại nếu có\r\n    return mockUsers.length > 0 ? mockUsers : [];\r\n  } catch (error) {\r\n    console.error('Alternative user fetch failed:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n// Mock function để gửi thông tin queue đến bác sĩ\r\nexport const sendQueueToDoctor = async (queueId: string): Promise<Queue | null> => {\r\n  try {\r\n    // Lấy thông tin queue\r\n    const queue = mockQueues.find(q => q._id === queueId);\r\n    \r\n    if (!queue) {\r\n      console.error(`Queue with ID ${queueId} not found.`);\r\n      return null;\r\n    }\r\n    \r\n    // Kiểm tra xem queue đã được gán cho bác sĩ chưa\r\n    if (!queue.doctorId) {\r\n      console.error(`Queue ${queueId} has no assigned doctor.`);\r\n      return null;\r\n    }\r\n    \r\n    // Trong môi trường thực tế, tại đây sẽ có logic gửi thông báo đến bác sĩ\r\n    // Trong mock data, ta chỉ cần đảm bảo trạng thái là in_progress\r\n    if (queue.status !== 'in_progress') {\r\n      queue.status = 'in_progress';\r\n      queue.updatedAt = new Date().toISOString();\r\n    }\r\n    \r\n    console.log(`Mock: Queue ${queueId} information sent to doctor ${queue.doctorId}`);\r\n    return queue;\r\n  } catch (error) {\r\n    console.error('Error sending queue information to doctor:', error);\r\n    throw error;\r\n  }\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 715, "column": 0}, "map": {"version":3,"sources":["file:///D:/Codes/Projects/hospitalityWeb/hospitality-website/my-app/src/app/receptionistPage/Dashboard.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { UsersIcon, ClockIcon, CheckSquareIcon, CalendarIcon, UserIcon, LogOutIcon, CheckCircleIcon, RefreshCcw } from 'lucide-react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { \r\n  getAllPatients, \r\n  getQueuesByStatus,\r\n  initializeData\r\n} from '../datats/mockPatients';\r\nimport * as apiService from '../services/api.service';\r\n\r\ninterface DashboardProps {\r\n  onNavigate: (view: string) => void;\r\n}\r\n\r\nexport function Dashboard({ onNavigate }: DashboardProps) {\r\n  const { user, logout, token } = useAuth();\r\n  \r\n  // State cho các thống kê từ mock data\r\n  const [patientCount, setPatientCount] = useState(0);\r\n  const [waitingCount, setWaitingCount] = useState(0);\r\n  const [completedTodayCount, setCompletedTodayCount] = useState(0);\r\n  const [newPatientsToday, setNewPatientsToday] = useState(0);\r\n  \r\n  // State cho danh sách queue đã hoàn thành\r\n  const [completedQueues, setCompletedQueues] = useState<any[]>([]);\r\n  const [loadingQueues, setLoadingQueues] = useState(false);\r\n  const [queueError, setQueueError] = useState<string | null>(null);\r\n  \r\n  // Pagination state cho danh sách queue đã hoàn thành\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [queuesPerPage, setQueuesPerPage] = useState(5);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n\r\n  // Load dữ liệu từ API khi component mount\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      try {\r\n        // Initialize data from API\r\n        await initializeData();\r\n        \r\n        // Lấy tổng số bệnh nhân\r\n        const patients = await getAllPatients();\r\n        setPatientCount(patients.length);\r\n        \r\n        // Tính số bệnh nhân mới hôm nay\r\n        const today = new Date().toISOString().split('T')[0]; // Lấy ngày hiện tại dạng YYYY-MM-DD\r\n        const newPatients = patients.filter(p => \r\n          p.createdAt.startsWith(today)).length;\r\n        setNewPatientsToday(newPatients);\r\n        \r\n        // Lấy số bệnh nhân đang chờ\r\n        const waitingQueues = await getQueuesByStatus('waiting');\r\n        setWaitingCount(waitingQueues.length);\r\n        \r\n        // Lấy số bệnh nhân đã hoàn thành khám hôm nay\r\n        const todayStart = new Date();\r\n        todayStart.setHours(0, 0, 0, 0); // Đặt thời gian về đầu ngày\r\n        \r\n        const completedQueues = await getQueuesByStatus('completed');\r\n        const completedToday = completedQueues.filter(q => {\r\n          const queueDate = new Date(q.updatedAt);\r\n          return queueDate >= todayStart;\r\n        });\r\n        setCompletedTodayCount(completedToday.length);\r\n        \r\n        // Lấy danh sách queue đã hoàn thành\r\n        await fetchCompletedQueues();\r\n      } catch (error) {\r\n        console.error('Error loading dashboard data:', error);\r\n      }\r\n    };\r\n    \r\n    loadData();\r\n  }, [token]);\r\n\r\n  // Thống kê hiển thị với dữ liệu từ mock data\r\n  const stats = [\r\n    {\r\n      title: 'Lịch hẹn hôm nay',\r\n      value: `${waitingCount + completedTodayCount}`,\r\n      icon: <CalendarIcon className=\"h-6 w-6 text-blue-600\" />,\r\n      change: `${waitingCount} chờ`,\r\n      changeType: 'neutral'\r\n    },\r\n    {\r\n      title: 'Đang chờ khám',\r\n      value: `${waitingCount}`,\r\n      icon: <ClockIcon className=\"h-6 w-6 text-yellow-600\" />,\r\n      change: waitingCount > 0 ? `${waitingCount} bệnh nhân` : 'Không có',\r\n      changeType: 'neutral'\r\n    },\r\n    {\r\n      title: 'Hoàn thành hôm nay',\r\n      value: `${completedTodayCount}`,\r\n      icon: <CheckSquareIcon className=\"h-6 w-6 text-green-600\" />,\r\n      change: completedTodayCount > 0 ? \r\n        `${Math.round((completedTodayCount / (completedTodayCount + waitingCount || 1)) * 100)}%` : \r\n        '0%',\r\n      changeType: 'increase'\r\n    },\r\n    {\r\n      title: 'Tổng bệnh nhân',\r\n      value: patientCount.toString(),\r\n      icon: <UsersIcon className=\"h-6 w-6 text-purple-600\" />,\r\n      change: `+${newPatientsToday} mới`,\r\n      changeType: 'increase'\r\n    }\r\n  ];\r\n\r\n  const appointments = [\r\n    { id: 1, patient: 'Nguyễn Văn A', time: '9:00 AM', doctor: 'Dr. Nguyễn Thị Hương', department: 'Nội khoa', status: 'Đang chờ' },\r\n    { id: 2, patient: 'Trần Văn B', time: '9:30 AM', doctor: 'Dr. Lê Minh Tuấn', department: 'Tim mạch', status: 'Đang khám' },\r\n    { id: 3, patient: 'Phạm Thị C', time: '10:00 AM', doctor: 'Dr. Trần Thị Mai', department: 'Da liễu', status: 'Đặt trước' },\r\n    { id: 4, patient: 'Hoàng Văn D', time: '10:30 AM', doctor: 'Dr. Nguyễn Thị Hương', department: 'Nội khoa', status: 'Đặt trước' },\r\n    { id: 5, patient: 'Lê Thị E', time: '11:00 AM', doctor: 'Dr. Phạm Văn Nam', department: 'Nhãn khoa', status: 'Đặt trước' }\r\n  ];\r\n\r\n  // Hàm lấy danh sách queue đã hoàn thành\r\n  const fetchCompletedQueues = async () => {\r\n    setLoadingQueues(true);\r\n    setQueueError(null);\r\n    \r\n    try {\r\n      if (token) {\r\n        // Sử dụng API với token\r\n        try {\r\n          console.log(\"Fetching completed queues from API...\");\r\n          const response = await apiService.getQueuesByStatus('completed', token);\r\n          console.log(\"API response:\", response);\r\n          \r\n          // Format lại dữ liệu nếu cần\r\n          const formattedQueues = response.map((queue: any) => ({\r\n            ...queue,\r\n            patientName: queue.patient && typeof queue.patient === 'object' ? \r\n                        queue.patient.fullName : 'Không có tên',\r\n            doctorName: queue.doctorId && typeof queue.doctorId === 'object' ? \r\n                       queue.doctorId.fullName : 'Không rõ bác sĩ'\r\n          }));\r\n          \r\n          // Sắp xếp theo thời gian hoàn thành mới nhất\r\n          formattedQueues.sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\r\n          \r\n          setCompletedQueues(formattedQueues);\r\n          setTotalPages(Math.ceil(formattedQueues.length / queuesPerPage));\r\n          setCurrentPage(1); // Reset to first page when data changes\r\n        } catch (apiError: any) {\r\n          console.error(\"API error:\", apiError);\r\n          setQueueError(`Lỗi khi lấy dữ liệu từ API: ${apiError.message}`);\r\n          \r\n          // Fallback to mock data\r\n          await fetchCompletedQueuesMock();\r\n        }\r\n      } else {\r\n        // Sử dụng mock data nếu không có token\r\n        await fetchCompletedQueuesMock();\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching completed queues:\", error);\r\n      setQueueError(`Lỗi: ${error.message}`);\r\n    } finally {\r\n      setLoadingQueues(false);\r\n    }\r\n  };\r\n  \r\n  // Hàm fallback sử dụng mock data\r\n  const fetchCompletedQueuesMock = async () => {\r\n    try {\r\n      console.log(\"Using mock data for completed queues...\");\r\n      await initializeData();\r\n      \r\n      // Lấy danh sách queue đã hoàn thành từ mock data\r\n      const mockCompletedQueues = await getQueuesByStatus('completed');\r\n      \r\n      // Format lại dữ liệu để hiển thị\r\n      const formattedMockQueues = await Promise.all(mockCompletedQueues.map(async (queue: any) => {\r\n        // Giả sử bạn có các hàm mock để lấy thông tin bệnh nhân và bác sĩ\r\n        let patientName = 'Không có tên';\r\n        \r\n        // Xử lý các cấu trúc dữ liệu khác nhau có thể có\r\n        if (queue.patientInfo && queue.patientInfo.fullName) {\r\n          patientName = queue.patientInfo.fullName;\r\n        } else if (queue.patient && typeof queue.patient === 'object' && queue.patient.fullName) {\r\n          patientName = queue.patient.fullName;\r\n        }\r\n        \r\n        return {\r\n          ...queue,\r\n          patientName: patientName,\r\n          doctorName: queue.doctorId ? `Bác sĩ ${queue._id.substring(0, 5)}` : 'Không rõ bác sĩ',\r\n          completedAt: new Date(queue.updatedAt).toLocaleString('vi-VN')\r\n        };\r\n      }));\r\n      \r\n      // Sắp xếp theo thời gian hoàn thành mới nhất\r\n      formattedMockQueues.sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\r\n      \r\n      setCompletedQueues(formattedMockQueues);\r\n      setTotalPages(Math.ceil(formattedMockQueues.length / queuesPerPage));\r\n      setCurrentPage(1); // Reset to first page when data changes\r\n    } catch (mockError: any) {\r\n      console.error(\"Error loading mock data for completed queues:\", mockError);\r\n      setQueueError(`Không thể tải dữ liệu mô phỏng: ${mockError.message}`);\r\n      setCompletedQueues([]);\r\n      setTotalPages(1);\r\n    }\r\n  };\r\n\r\n  // Calculating pagination variables\r\n  const indexOfLastQueue = currentPage * queuesPerPage;\r\n  const indexOfFirstQueue = indexOfLastQueue - queuesPerPage;\r\n  const currentQueues = completedQueues.slice(indexOfFirstQueue, indexOfLastQueue);\r\n  \r\n  // Function to handle page change\r\n  const paginate = (pageNumber: number) => setCurrentPage(pageNumber);\r\n  \r\n  // Function to handle records per page change\r\n  const handleRecordsPerPageChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    const value = parseInt(e.target.value);\r\n    setQueuesPerPage(value);\r\n    setTotalPages(Math.ceil(completedQueues.length / value));\r\n    setCurrentPage(1); // Reset to first page when changing records per page\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      {/* Header */}\r\n      <header className=\"bg-white shadow\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center py-4\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">Hệ thống Lễ tân MediClinic</h1>\r\n          <div className=\"flex items-center\">\r\n            <div className=\"mr-4 text-right\">\r\n              <p className=\"text-sm font-medium text-gray-900\">{user?.fullName || 'Người dùng'}</p>\r\n              <p className=\"text-xs text-gray-500\">Lễ tân</p>\r\n            </div>\r\n            <div className=\"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center\">\r\n              <UserIcon className=\"h-5 w-5 text-gray-600\" />\r\n            </div>\r\n            <button \r\n              onClick={logout}\r\n              className=\"ml-4 p-2 rounded-full text-gray-500 hover:bg-gray-100\"\r\n              title=\"Đăng xuất\"\r\n            >\r\n              <LogOutIcon size={20} />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Main Content */}\r\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n        {/* Stats Cards */}\r\n        <div className=\"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-6\">\r\n          {stats.map((stat, index) => (\r\n            <div key={index} className=\"bg-white overflow-hidden shadow rounded-lg\">\r\n              <div className=\"p-5\">\r\n                <div className=\"flex items-center\">\r\n                  <div className=\"flex-shrink-0\">{stat.icon}</div>\r\n                  <div className=\"ml-5 w-0 flex-1\">\r\n                    <dl>\r\n                      <dt className=\"text-sm font-medium text-gray-500 truncate\">{stat.title}</dt>\r\n                      <dd>\r\n                        <div className=\"text-lg font-medium text-gray-900\">{stat.value}</div>\r\n                      </dd>\r\n                    </dl>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"bg-gray-50 px-5 py-3\">\r\n                <div className=\"text-sm\">\r\n                  <span className={`font-medium ${\r\n                    stat.changeType === 'increase' ? 'text-green-600' : \r\n                    stat.changeType === 'decrease' ? 'text-red-600' : 'text-gray-500'\r\n                  }`}>\r\n                    {stat.change}\r\n                  </span>\r\n                  <span className=\"text-gray-500\"> so với hôm qua</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Completed Queues List */}\r\n        <div className=\"bg-white shadow rounded-lg mb-6\">\r\n          <div className=\"px-4 py-5 sm:px-6 flex justify-between items-center\">\r\n            <h3 className=\"text-lg font-medium leading-6 text-gray-900\">Danh sách bệnh nhân đã hoàn thành khám</h3>\r\n            <button \r\n              onClick={fetchCompletedQueues}\r\n              className=\"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded flex items-center\"\r\n              disabled={loadingQueues}\r\n            >\r\n              <RefreshCcw size={14} className={`mr-1 ${loadingQueues ? 'animate-spin' : ''}`} />\r\n              Làm mới\r\n            </button>\r\n          </div>\r\n          \r\n          {queueError && (\r\n            <div className=\"px-4 py-3 bg-red-50 text-red-700 border-t border-b border-red-200\">\r\n              {queueError}\r\n            </div>\r\n          )}\r\n          \r\n          <div className=\"border-t border-gray-200\">\r\n            {loadingQueues ? (\r\n              <div className=\"flex justify-center items-center py-8\">\r\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\r\n                <span className=\"ml-2 text-gray-600\">Đang tải dữ liệu...</span>\r\n              </div>\r\n            ) : completedQueues.length > 0 ? (\r\n              <div className=\"overflow-x-auto\">\r\n                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                  <thead className=\"bg-gray-50\">\r\n                    <tr>\r\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                        Bệnh nhân\r\n                      </th>\r\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                        Bác sĩ\r\n                      </th>\r\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                        Ngày hoàn thành\r\n                      </th>\r\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                        Trạng thái\r\n                      </th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                    {currentQueues.map((queue) => (\r\n                      <tr key={queue._id} className=\"hover:bg-gray-50\">\r\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                          <div className=\"text-sm font-medium text-gray-900\">\r\n                            {queue.patientName || (queue.patient && typeof queue.patient === 'object' ? \r\n                              queue.patient.fullName : 'Không có tên')}\r\n                          </div>\r\n                          <div className=\"text-sm text-gray-500\">\r\n                            ID: {queue.patient && typeof queue.patient === 'object' ? \r\n                              queue.patient.userId : queue.patient || 'N/A'}\r\n                          </div>\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                          <div className=\"text-sm text-gray-900\">\r\n                            {queue.doctorName || (queue.doctorId && typeof queue.doctorId === 'object' ? \r\n                              queue.doctorId.fullName : 'Không rõ bác sĩ')}\r\n                          </div>\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                          {new Date(queue.updatedAt).toLocaleString('vi-VN')}\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                          <span className=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800\">\r\n                            <CheckCircleIcon size={14} className=\"mr-1\" /> Hoàn thành\r\n                          </span>\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n                \r\n                {/* Pagination Controls */}\r\n                <div className=\"px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6\">\r\n                  <div className=\"flex flex-col gap-4 sm:hidden\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <p className=\"text-sm text-gray-700\">\r\n                        Trang {currentPage}/{totalPages}\r\n                      </p>\r\n                      <select \r\n                        className=\"border border-gray-300 rounded-md py-1 px-2 focus:outline-none focus:ring-2 focus:ring-black focus:border-black text-sm\"\r\n                        value={queuesPerPage}\r\n                        onChange={(e) => {\r\n                          setQueuesPerPage(Number(e.target.value));\r\n                          setTotalPages(Math.ceil(completedQueues.length / Number(e.target.value)));\r\n                          setCurrentPage(1); // Reset to first page when changing records per page\r\n                        }}\r\n                      >\r\n                        <option value={5}>5 mỗi trang</option>\r\n                        <option value={10}>10 mỗi trang</option>\r\n                        <option value={20}>20 mỗi trang</option>\r\n                        <option value={completedQueues.length}>Tất cả</option>\r\n                      </select>\r\n                    </div>\r\n                    <div className=\"flex justify-between\">\r\n                      <button\r\n                        onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\r\n                        className={`relative inline-flex items-center px-4 py-2 rounded-md text-sm font-medium ${\r\n                          currentPage === 1 \r\n                            ? 'text-gray-400 bg-gray-100'\r\n                            : 'text-blue-600 bg-blue-100 hover:bg-blue-200'\r\n                        } focus:outline-none`}\r\n                        disabled={currentPage === 1}\r\n                      >\r\n                        Trước\r\n                      </button>\r\n                      <span className=\"text-sm font-medium\">\r\n                        {currentPage} / {totalPages}\r\n                      </span>\r\n                      <button\r\n                        onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}\r\n                        className={`relative inline-flex items-center px-4 py-2 rounded-md text-sm font-medium ${\r\n                          currentPage === totalPages \r\n                            ? 'text-gray-400 bg-gray-100'\r\n                            : 'text-blue-600 bg-blue-100 hover:bg-blue-200'\r\n                        } focus:outline-none`}\r\n                        disabled={currentPage === totalPages}\r\n                      >\r\n                        Tiếp theo\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"hidden sm:flex-1 sm:flex sm:justify-between\">\r\n                    <div className=\"flex items-center\">\r\n                      <p className=\"text-sm text-gray-700\">\r\n                        Hiển thị{' '}\r\n                        <span className=\"font-medium\">{(currentPage - 1) * queuesPerPage + 1}</span>\r\n                        {' '}đến{' '}\r\n                        <span className=\"font-medium\">{Math.min(currentPage * queuesPerPage, completedQueues.length)}</span>\r\n                        {' '}trong tổng số{' '}\r\n                        <span className=\"font-medium\">{completedQueues.length}</span>\r\n                        {' '}bệnh nhân đã hoàn thành khám\r\n                      </p>\r\n                      <select \r\n                        className=\"ml-3 border border-gray-300 rounded-md py-1 px-2 focus:outline-none focus:ring-2 focus:ring-black focus:border-black text-sm\"\r\n                        value={queuesPerPage}\r\n                        onChange={(e) => {\r\n                          setQueuesPerPage(Number(e.target.value));\r\n                          setTotalPages(Math.ceil(completedQueues.length / Number(e.target.value)));\r\n                          setCurrentPage(1); // Reset to first page when changing records per page\r\n                        }}\r\n                      >\r\n                        <option value={5}>5 mỗi trang</option>\r\n                        <option value={10}>10 mỗi trang</option>\r\n                        <option value={20}>20 mỗi trang</option>\r\n                        <option value={completedQueues.length}>Hiển thị tất cả</option>\r\n                      </select>\r\n                    </div>\r\n                    <div>\r\n                      <nav className=\"relative z-0 inline-flex rounded-md shadow-sm -space-x-px\" aria-label=\"Pagination\">\r\n                        <button\r\n                          onClick={() => setCurrentPage(1)}\r\n                          className=\"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus:z-10\"\r\n                        >\r\n                          <span className=\"sr-only\">Đến trang đầu</span>\r\n                          <svg className=\"h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15 18l-6-6 6-6\" />\r\n                          </svg>\r\n                        </button>\r\n                        <button\r\n                          onClick={() => setCurrentPage(currentPage - 1)}\r\n                          className=\"relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus:z-10\"\r\n                          disabled={currentPage === 1}\r\n                        >\r\n                          <span className=\"sr-only\">Trang trước</span>\r\n                          <svg className=\"h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15 18l-6-6 6-6\" />\r\n                          </svg>\r\n                        </button>\r\n                        \r\n                        {/* Page number buttons */}\r\n                        {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\r\n                          // Logic to show pages around current page\r\n                          let pageToShow;\r\n                          if (totalPages <= 5) {\r\n                            pageToShow = i + 1;\r\n                          } else if (currentPage <= 3) {\r\n                            pageToShow = i + 1;\r\n                          } else if (currentPage >= totalPages - 2) {\r\n                            pageToShow = totalPages - 4 + i;\r\n                          } else {\r\n                            pageToShow = currentPage - 2 + i;\r\n                          }\r\n                          \r\n                          if (pageToShow > 0 && pageToShow <= totalPages) {\r\n                            return (\r\n                              <button\r\n                                key={pageToShow}\r\n                                onClick={() => setCurrentPage(pageToShow)}\r\n                                className={`relative inline-flex items-center px-4 py-2 border border-gray-300 ${\r\n                                  currentPage === pageToShow\r\n                                    ? 'bg-blue-600 text-white'\r\n                                    : 'bg-white text-gray-700 hover:bg-gray-50'\r\n                                } text-sm font-medium focus:z-10 focus:outline-none focus:ring-1 focus:ring-black focus:border-black transition-colors`}\r\n                              >\r\n                                {pageToShow}\r\n                              </button>\r\n                            );\r\n                          }\r\n                          return null;\r\n                        })}\r\n                        \r\n                        <button\r\n                          onClick={() => setCurrentPage(currentPage + 1)}\r\n                          className=\"relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus:z-10\"\r\n                          disabled={currentPage === totalPages}\r\n                        >\r\n                          <span className=\"sr-only\">Trang tiếp theo</span>\r\n                          <svg className=\"h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 6l6 6-6 6\" />\r\n                          </svg>\r\n                        </button>\r\n                        <button\r\n                          onClick={() => setCurrentPage(totalPages)}\r\n                          className=\"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus:z-10\"\r\n                        >\r\n                          <span className=\"sr-only\">Đến trang cuối</span>\r\n                          <svg className=\"h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 6l6 6-6 6\" />\r\n                          </svg>\r\n                        </button>\r\n                      </nav>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center py-8 text-gray-500\">\r\n                <CheckCircleIcon className=\"mx-auto h-12 w-12 text-gray-400 mb-2\" />\r\n                <p className=\"text-gray-500\">Không có bệnh nhân nào đã hoàn thành khám</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Quick Actions */}\r\n        <div className=\"bg-white shadow rounded-lg\">\r\n          <div className=\"px-4 py-5 sm:px-6\">\r\n            <h3 className=\"text-lg font-medium leading-6 text-gray-900\">Thao tác nhanh</h3>\r\n          </div>\r\n          <div className=\"border-t border-gray-200\">\r\n            <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 p-6\">\r\n              {/* Card 1 - Patient Management */}\r\n              <div \r\n                className=\"relative rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm flex items-center space-x-3 hover:border-gray-400 cursor-pointer\"\r\n                onClick={() => onNavigate('PatientManagement')}\r\n              >\r\n                <div className=\"flex-shrink-0 bg-blue-100 rounded-md p-2\">\r\n                  <UsersIcon className=\"h-6 w-6 text-blue-600\" />\r\n                </div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <p className=\"text-sm font-medium text-gray-900\">Quản lý bệnh nhân</p>\r\n                  <p className=\"text-sm text-gray-500\">Xem và quản lý thông tin bệnh nhân</p>\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Card 2 - Queue Management */}\r\n              <div \r\n                className=\"relative rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm flex items-center space-x-3 hover:border-gray-400 cursor-pointer\"\r\n                onClick={() => onNavigate('QueueManagement')}\r\n              >\r\n                <div className=\"flex-shrink-0 bg-green-100 rounded-md p-2\">\r\n                  <CalendarIcon className=\"h-6 w-6 text-green-600\" />\r\n                </div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <p className=\"text-sm font-medium text-gray-900\">Quản lý lịch hẹn</p>\r\n                  <p className=\"text-sm text-gray-500\">Thêm và chỉnh sửa lịch hẹn</p>\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Card 3 - Medication History */}\r\n              <div \r\n                className=\"relative rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm flex items-center space-x-3 hover:border-gray-400 cursor-pointer\"\r\n                onClick={() => onNavigate('MedicationHistory')}\r\n              >\r\n                <div className=\"flex-shrink-0 bg-purple-100 rounded-md p-2\">\r\n                  <ClockIcon className=\"h-6 w-6 text-purple-600\" />\r\n                </div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <p className=\"text-sm font-medium text-gray-900\">Báo cáo</p>\r\n                  <p className=\"text-sm text-gray-500\">Xem báo cáo hoạt động</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2107, "column": 0}, "map": {"version":3,"sources":["file:///D:/Codes/Projects/hospitalityWeb/hospitality-website/my-app/src/app/receptionistPage/components/Patients/PatientForm.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { XIcon, UserIcon, SaveIcon } from 'lucide-react';\r\nimport { User, generateMongoId } from '../../../datats/mockPatients';\r\nimport { useAuth } from '../../../context/AuthContext';\r\nimport * as apiService from '../../../services/api.service';\r\n\r\ninterface PatientFormProps {\r\n  patient?: User | null;\r\n  onClose: () => void;\r\n  onSave?: (patient: Partial<User>) => void;\r\n  isLoading?: boolean;\r\n}\r\n\r\nexport function PatientForm({ patient, onClose, onSave, isLoading = false }: PatientFormProps) {\r\n  const [formData, setFormData] = useState({\r\n    fullName: '',\r\n    userId: '',\r\n    username: '',\r\n    email: '',\r\n    phone: '',\r\n    password: '',\r\n    role: 'PATIENT' as const,\r\n  });\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [fieldErrors, setFieldErrors] = useState<{[key: string]: string}>({});\r\n  const [internalLoading, setInternalLoading] = useState(false);\r\n  \r\n  // Combine external and internal loading states\r\n  const loading = isLoading || internalLoading;\r\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\r\n  const { token, user } = useAuth();\r\n\r\n  // Define mock functions for fallback\r\n  const addPatient = async (patientData: Partial<User>): Promise<User | null> => {\r\n    try {\r\n      // Create a new patient object with MongoDB-like ID\r\n      const newPatient = {\r\n        ...patientData,\r\n        _id: generateMongoId(),\r\n        userId: patientData.userId || `PA${Date.now()}`,\r\n        createdAt: new Date().toISOString(),\r\n        updatedAt: new Date().toISOString(),\r\n        __v: 0\r\n      } as User;\r\n      \r\n      console.log(\"Using mock function to add patient:\", newPatient);\r\n      return newPatient;\r\n    } catch (error) {\r\n      console.error(\"Error in mock addPatient:\", error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const updatePatient = (id: string, patientData: Partial<User>): User | null => {\r\n    try {\r\n      // In a real implementation with a database, this would update the record\r\n      // Here we just return the merged data as if it was updated\r\n      const updatedPatient = {\r\n        ...patient,\r\n        ...patientData,\r\n        _id: id,\r\n        updatedAt: new Date().toISOString()\r\n      } as User;\r\n      \r\n      console.log(`Using mock function to update patient with ID ${id}:`, updatedPatient);\r\n      return updatedPatient;\r\n    } catch (error) {\r\n      console.error(`Error in mock updatePatient for ${id}:`, error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const isEditing = !!patient;\r\n\r\n  useEffect(() => {\r\n    if (patient) {\r\n      setFormData({\r\n        fullName: patient.fullName || '',\r\n        userId: patient.userId || '',\r\n        username: patient.username || '',\r\n        email: patient.email || '',\r\n        phone: patient.phone || '',\r\n        password: '',  // Không hiển thị mật khẩu\r\n        role: 'PATIENT',  // Vì form này chỉ dành cho bệnh nhân\r\n      });\r\n    }\r\n  }, [patient]);\r\n\r\n  // Clear success message after 5 seconds\r\n  useEffect(() => {\r\n    if (successMessage) {\r\n      const timer = setTimeout(() => {\r\n        setSuccessMessage(null);\r\n      }, 5000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [successMessage]);\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData((prev) => ({\r\n      ...prev,\r\n      [name]: value,\r\n    }));\r\n    // Xóa lỗi khi người dùng thay đổi input\r\n    setError(null);\r\n    setFieldErrors(prev => ({ ...prev, [name]: '' }));\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    const errors: {[key: string]: string} = {};\r\n    let isValid = true;\r\n    \r\n    // Validate required fields\r\n    if (!formData.fullName.trim()) {\r\n      errors.fullName = 'Họ và tên là bắt buộc';\r\n      isValid = false;\r\n    }\r\n    \r\n    if (!formData.username.trim()) {\r\n      errors.username = 'Tên đăng nhập là bắt buộc';\r\n      isValid = false;\r\n    }\r\n    \r\n    if (!formData.email.trim()) {\r\n      errors.email = 'Email là bắt buộc';\r\n      isValid = false;\r\n    }\r\n    \r\n    if (!formData.phone.trim()) {\r\n      errors.phone = 'Số điện thoại là bắt buộc';\r\n      isValid = false;\r\n    }\r\n    \r\n    // Validate email format\r\n    if (formData.email && !/^\\S+@\\S+\\.\\S+$/.test(formData.email)) {\r\n      errors.email = 'Email không hợp lệ. Vui lòng kiểm tra lại.';\r\n      isValid = false;\r\n    }\r\n    \r\n    // Validate phone number (adjust for Vietnamese phone numbers)\r\n    if (formData.phone && !/^[0-9]{10,11}$/.test(formData.phone.replace(/\\s/g, ''))) {\r\n      errors.phone = 'Số điện thoại phải có 10-11 số.';\r\n      isValid = false;\r\n    }\r\n    \r\n    // Validate password requirement for new users\r\n    if (!isEditing && (!formData.password || formData.password.length < 6)) {\r\n      errors.password = 'Mật khẩu phải có ít nhất 6 ký tự.';\r\n      isValid = false;\r\n    }\r\n    \r\n    setFieldErrors(errors);\r\n    return isValid;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    // Xóa lỗi trước khi submit\r\n    setError(null);\r\n    setSuccessMessage(null);\r\n    \r\n    // Validate form first\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n    \r\n    setInternalLoading(true);\r\n    \r\n    // Chuẩn bị dữ liệu người dùng\r\n    const userData = {\r\n      ...formData,\r\n      // Nếu không phải là chế độ chỉnh sửa và userId trống, không cần thêm vào\r\n      // hệ thống sẽ tự động tạo userId\r\n      ...((!isEditing && !formData.userId.trim()) ? {} : { userId: formData.userId }),\r\n      role: formData.role as 'PATIENT' | 'DOCTOR' | 'PHARMACIST' | 'RECEPTIONIST' | 'ADMIN',\r\n    };\r\n\r\n    try {\r\n      let resultPatient = null;\r\n      \r\n      if (isEditing && patient && patient._id) {\r\n        // Cập nhật bệnh nhân hiện có\r\n        if (token) {\r\n          try {\r\n            // Attempt to use the API first\r\n            console.log('Using API to update patient');\r\n            const response = await apiService.updateUser(patient._id, userData, token);\r\n            resultPatient = response;\r\n            console.log('API update successful:', response);\r\n          } catch (apiError: any) {\r\n            console.error('API error when updating patient:', apiError);\r\n            \r\n            // Hiển thị chi tiết lỗi từ API\r\n            if (apiError.response) {\r\n              if (apiError.response.data && apiError.response.data.field) {\r\n                const fieldName = apiError.response.data.field;\r\n                setFieldErrors({\r\n                  [fieldName]: apiError.response.data.message || `Lỗi với trường ${fieldName}`\r\n                });\r\n              } else {\r\n                setError(`Lỗi từ server: ${apiError.response.data?.message || apiError.message}`);\r\n              }\r\n            } else {\r\n              setError(`Lỗi kết nối: ${apiError.message}`);\r\n            }\r\n            \r\n            console.log('Falling back to mock update function');\r\n            // Fallback to mock update if API fails\r\n            resultPatient = updatePatient(patient._id, userData);\r\n          }\r\n        } else {\r\n          // Use mock update if no token is available\r\n          console.log('No token available, using mock update function');\r\n          resultPatient = updatePatient(patient._id, userData);\r\n        }\r\n        \r\n        if (resultPatient) {\r\n          setSuccessMessage(`Đã cập nhật thông tin bệnh nhân: ${resultPatient.fullName}`);\r\n        } else {\r\n          setError('Không thể cập nhật thông tin bệnh nhân. Vui lòng thử lại.');\r\n          setInternalLoading(false);\r\n          return;\r\n        }\r\n      } else {\r\n        // Thêm bệnh nhân mới\r\n        if (token) {\r\n          try {\r\n            // Attempt to use the API first\r\n            console.log('Using API to create new patient');\r\n            console.log('User role:', user?.role);\r\n            console.log('Data being sent:', userData);\r\n            \r\n            const response = await apiService.createUser(userData, token);\r\n            resultPatient = response;\r\n            console.log('API creation successful:', response);\r\n          } catch (apiError: any) {\r\n            console.error('API error when creating patient:', apiError);\r\n            \r\n            // Hiển thị chi tiết lỗi từ API\r\n            if (apiError.response) {\r\n              console.log('API error response:', apiError.response.data);\r\n              \r\n              if (apiError.response.data && apiError.response.data.field) {\r\n                const fieldName = apiError.response.data.field;\r\n                setFieldErrors({\r\n                  [fieldName]: apiError.response.data.message || `Lỗi với trường ${fieldName}`\r\n                });\r\n              } else {\r\n                setError(`Lỗi từ server: ${apiError.response.data?.message || apiError.message}`);\r\n              }\r\n              \r\n              // Nếu lỗi là không có quyền, không fallback\r\n              if (apiError.response.status === 403) {\r\n                setError(`Bạn không có quyền tạo bệnh nhân mới. Vui lòng liên hệ admin.`);\r\n                setInternalLoading(false);\r\n                return;\r\n              }\r\n            } else {\r\n              setError(`Lỗi kết nối: ${apiError.message}`);\r\n            }\r\n            \r\n            console.log('Falling back to mock creation function');\r\n            // Fallback to mock creation if API fails\r\n            resultPatient = await addPatient(userData);\r\n          }\r\n        } else {\r\n          // Use mock creation if no token is available\r\n          console.log('No token available, using mock creation function');\r\n          resultPatient = await addPatient(userData);\r\n        }\r\n        \r\n        if (resultPatient) {\r\n          setSuccessMessage(`Đã thêm bệnh nhân mới: ${resultPatient.fullName} (ID: ${resultPatient.userId})`);\r\n          \r\n          // Reset form after successful creation if not using API or if specifically requested\r\n          if (!token) {\r\n            setFormData({\r\n              fullName: '',\r\n              userId: '',\r\n              username: '',\r\n              email: '',\r\n              phone: '',\r\n              password: '',\r\n              role: 'PATIENT' as const,\r\n            });\r\n          }\r\n        } else {\r\n          setError('Không thể thêm bệnh nhân mới. Vui lòng thử lại.');\r\n          setInternalLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Gọi onSave callback nếu có để thông báo lên component cha\r\n      if (onSave) {\r\n        onSave(resultPatient || userData);\r\n      }\r\n      \r\n      // Nếu thành công và đang chỉnh sửa, đóng form sau 1 giây\r\n      if (isEditing) {\r\n        setTimeout(() => {\r\n          onClose();\r\n        }, 1000);\r\n      }\r\n    } catch (error) {\r\n      console.error('Lỗi khi lưu bệnh nhân:', error);\r\n      // Hiển thị thông báo lỗi\r\n      if (error instanceof Error) {\r\n        setError(error.message);\r\n      } else {\r\n        setError('Đã xảy ra lỗi khi lưu thông tin bệnh nhân.');\r\n      }\r\n    } finally {\r\n      setInternalLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full\">\r\n      {/* Form header */}\r\n      <div className=\"px-6 py-4 border-b border-gray-300 bg-gray-50 flex justify-between items-center\">\r\n        <div className=\"flex items-center\">\r\n          <UserIcon size={20} className=\"mr-2 text-black\" />\r\n          <h2 className=\"text-lg font-semibold text-black\">\r\n            {isEditing ? 'Sửa thông tin bệnh nhân' : 'Thêm bệnh nhân mới'}\r\n          </h2>\r\n        </div>\r\n        <button\r\n          onClick={onClose}\r\n          className=\"p-1.5 rounded-full hover:bg-gray-200 text-black transition-colors\"\r\n          disabled={loading}\r\n        >\r\n          <XIcon size={20} />\r\n        </button>\r\n      </div>\r\n\r\n      {/* Form content */}\r\n      <form onSubmit={handleSubmit} className=\"p-6\">\r\n        {/* Error message */}\r\n        {error && (\r\n          <div className=\"mb-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg\">\r\n            <p className=\"font-medium\">{error}</p>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Success message */}\r\n        {successMessage && (\r\n          <div className=\"mb-4 p-3 bg-green-50 border border-green-200 text-green-700 rounded-lg\">\r\n            <p className=\"font-medium\">{successMessage}</p>\r\n          </div>\r\n        )}\r\n        \r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n          <div>\r\n            <label htmlFor=\"fullName\" className=\"block text-sm font-medium text-black mb-2\">\r\n              Họ và tên <span className=\"text-red-600\">*</span>\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"fullName\"\r\n              name=\"fullName\"\r\n              required\r\n              placeholder=\"Nhập họ và tên...\"\r\n              className={`w-full border ${fieldErrors.fullName ? 'border-red-500' : 'border-gray-300'} rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-black focus:border-black text-black shadow-sm`}\r\n              value={formData.fullName}\r\n              onChange={handleChange}\r\n              disabled={loading}\r\n            />\r\n            {fieldErrors.fullName && (\r\n              <p className=\"mt-1 text-sm text-red-600\">{fieldErrors.fullName}</p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"userId\" className=\"block text-sm font-medium text-black mb-2\">\r\n              User ID {isEditing && <span className=\"text-red-600\">*</span>}\r\n              {!isEditing && <span className=\"text-xs text-gray-500 ml-1\">(Tự động nếu để trống)</span>}\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"userId\"\r\n              name=\"userId\"\r\n              required={isEditing}\r\n              placeholder={isEditing ? \"Nhập User ID...\" : \"Để trống để tạo ID tự động...\"}\r\n              className={`w-full border ${fieldErrors.userId ? 'border-red-500' : 'border-gray-300'} rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-black focus:border-black text-black shadow-sm`}\r\n              value={formData.userId}\r\n              onChange={handleChange}\r\n              disabled={loading}\r\n            />\r\n            {fieldErrors.userId && (\r\n              <p className=\"mt-1 text-sm text-red-600\">{fieldErrors.userId}</p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"username\" className=\"block text-sm font-medium text-black mb-2\">\r\n              Tên đăng nhập <span className=\"text-red-600\">*</span>\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"username\"\r\n              name=\"username\"\r\n              required\r\n              placeholder=\"Nhập tên đăng nhập...\"\r\n              className={`w-full border ${fieldErrors.username ? 'border-red-500' : 'border-gray-300'} rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-black focus:border-black text-black shadow-sm`}\r\n              value={formData.username}\r\n              onChange={handleChange}\r\n              disabled={loading}\r\n            />\r\n            {fieldErrors.username && (\r\n              <p className=\"mt-1 text-sm text-red-600\">{fieldErrors.username}</p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"email\" className=\"block text-sm font-medium text-black mb-2\">\r\n              Email <span className=\"text-red-600\">*</span>\r\n            </label>\r\n            <input\r\n              type=\"email\"\r\n              id=\"email\"\r\n              name=\"email\"\r\n              required\r\n              placeholder=\"Nhập email...\"\r\n              className={`w-full border ${fieldErrors.email ? 'border-red-500' : 'border-gray-300'} rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-black focus:border-black text-black shadow-sm`}\r\n              value={formData.email}\r\n              onChange={handleChange}\r\n              disabled={loading}\r\n            />\r\n            {fieldErrors.email && (\r\n              <p className=\"mt-1 text-sm text-red-600\">{fieldErrors.email}</p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"phone\" className=\"block text-sm font-medium text-black mb-2\">\r\n              Số điện thoại <span className=\"text-red-600\">*</span>\r\n            </label>\r\n            <input\r\n              type=\"tel\"\r\n              id=\"phone\"\r\n              name=\"phone\"\r\n              required\r\n              placeholder=\"Nhập số điện thoại...\"\r\n              className={`w-full border ${fieldErrors.phone ? 'border-red-500' : 'border-gray-300'} rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-black focus:border-black text-black shadow-sm`}\r\n              value={formData.phone}\r\n              onChange={handleChange}\r\n              disabled={loading}\r\n            />\r\n            {fieldErrors.phone && (\r\n              <p className=\"mt-1 text-sm text-red-600\">{fieldErrors.phone}</p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"password\" className=\"block text-sm font-medium text-black mb-2\">\r\n              Mật khẩu {!isEditing && <span className=\"text-red-600\">*</span>}\r\n            </label>\r\n            <input\r\n              type=\"password\"\r\n              id=\"password\"\r\n              name=\"password\"\r\n              required={!isEditing}\r\n              placeholder={isEditing ? \"Để trống nếu không thay đổi...\" : \"Nhập mật khẩu...\"}\r\n              className={`w-full border ${fieldErrors.password ? 'border-red-500' : 'border-gray-300'} rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-black focus:border-black text-black shadow-sm`}\r\n              value={formData.password}\r\n              onChange={handleChange}\r\n              disabled={loading}\r\n            />\r\n            {fieldErrors.password && (\r\n              <p className=\"mt-1 text-sm text-red-600\">{fieldErrors.password}</p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Form actions */}\r\n        <div className=\"mt-8 pt-5 border-t border-gray-300 flex justify-end gap-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            className=\"px-5 py-2 border border-gray-300 rounded-lg text-black font-medium hover:bg-gray-50 transition-colors\"\r\n            disabled={loading}\r\n          >\r\n            Hủy\r\n          </button>\r\n          <button\r\n            type=\"submit\"\r\n            className={`px-5 py-2 rounded-lg text-white font-medium transition-colors flex items-center shadow-sm ${\r\n              loading ? 'bg-green-400 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700'\r\n            }`}\r\n            disabled={loading}\r\n          >\r\n            {loading ? (\r\n              <>\r\n                <span className=\"animate-spin mr-2\">⏳</span>\r\n                {isEditing ? 'Đang cập nhật...' : 'Đang lưu...'}\r\n              </>\r\n            ) : (\r\n              <>\r\n                <SaveIcon size={18} className=\"mr-2\" />\r\n                {isEditing ? 'Cập nhật' : 'Lưu'}\r\n              </>\r\n            )}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2899, "column": 0}, "map": {"version":3,"sources":["file:///D:/Codes/Projects/hospitalityWeb/hospitality-website/my-app/src/app/receptionistPage/PatientManagement.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { SearchIcon, PlusIcon, EditIcon, TrashIcon, UsersIcon, FilterIcon, ArrowUpDown, UserPlusIcon } from 'lucide-react';\r\nimport { PatientForm } from './components/Patients/PatientForm';\r\nimport { \r\n  User,\r\n  getAllPatients,\r\n  searchUsers,\r\n  addQueue,\r\n  getQueueByPatientId,\r\n  initializeData,\r\n  generateMongoId\r\n} from '../datats/mockPatients';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport * as apiService from '../services/api.service';\r\nimport axiosInstance from '../services/axios.customize.service';\r\n\r\ninterface PatientManagementProps {\r\n  onBack: () => void;\r\n}\r\n\r\n// Custom CRUD functions for patients with API integration\r\nconst addPatient = async (patientData: Partial<User>, authToken?: string) => {\r\n  try {\r\n    if (authToken) {\r\n      // Sử dụng API nếu có token\r\n      try {\r\n        console.log(\"Adding patient via API:\", patientData);\r\n        const result = await apiService.createUser(patientData, authToken);\r\n        console.log(\"API success - new patient added:\", result);\r\n        return result;\r\n      } catch (apiError) {\r\n        console.error(\"API error when adding patient:\", apiError);\r\n        // Fallback to mock data nếu API lỗi\r\n        console.log(\"Falling back to mock data for adding patient\");\r\n      }\r\n    }\r\n    \r\n    // Sử dụng mock data nếu không có token hoặc API lỗi\r\n    const newPatient = {\r\n      ...patientData,\r\n      _id: generateMongoId(),\r\n      userId: patientData.userId || `PA${Date.now()}`,\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString(),\r\n      __v: 0\r\n    } as User;\r\n    \r\n    console.log(\"Added patient using mock data:\", newPatient);\r\n    return newPatient;\r\n  } catch (error) {\r\n    console.error(\"Error adding patient:\", error);\r\n    return null;\r\n  }\r\n};\r\n\r\nconst updatePatient = async (id: string, patientData: Partial<User>, authToken?: string) => {\r\n  try {\r\n    if (authToken) {\r\n      // Sử dụng API nếu có token\r\n      try {\r\n        console.log(`Updating patient via API - ID ${id}:`, patientData);\r\n        \r\n        // Kiểm tra tính hợp lệ của token trước khi gọi API\r\n        const tokenStatus = await apiService.validateToken(authToken);\r\n        if (!tokenStatus.valid) {\r\n          console.error(\"Invalid token when updating patient:\", tokenStatus);\r\n          throw new Error(`Authentication error: ${tokenStatus.reason}`);\r\n        }\r\n        \r\n        // Gọi API để cập nhật thông tin bệnh nhân\r\n        const result = await apiService.updateUser(id, patientData, authToken);\r\n        console.log(\"API success - patient updated:\", result);\r\n        \r\n        // Trả về dữ liệu từ API để cập nhật UI\r\n        return result;\r\n      } catch (apiError: any) {\r\n        // Log chi tiết lỗi từ API để debug\r\n        console.error(`API error when updating patient ${id}:`, apiError);\r\n        if (apiError.response) {\r\n          console.error(\"Error status:\", apiError.response.status);\r\n          console.error(\"Error data:\", apiError.response.data);\r\n        }\r\n        \r\n        // Hiển thị thông báo lỗi cụ thể\r\n        if (apiError.response && apiError.response.status === 403) {\r\n          // Thử lại với vai trò tiếp tân\r\n          try {\r\n            console.log(\"Trying to update patient as receptionist...\");\r\n            const currentUser = await apiService.getUserById('me', authToken);\r\n            \r\n            // Nếu người dùng là tiếp tân, thử gửi với tham số đặc biệt\r\n            if (currentUser && currentUser.role === 'RECEPTIONIST') {\r\n              console.log(\"User is a receptionist, trying with receptionist parameter\");\r\n              // Thêm tham số isReceptionist: true để backend biết đây là tiếp tân\r\n              const updatedData = { ...patientData, isReceptionist: true };\r\n              const result = await apiService.updateUser(id, updatedData, authToken);\r\n              console.log(\"Success updating patient as receptionist:\", result);\r\n              return result;\r\n            } else {\r\n              throw new Error(\"Bạn không có quyền cập nhật thông tin bệnh nhân\");\r\n            }\r\n          } catch (retryError) {\r\n            console.error(\"Error when retrying as receptionist:\", retryError);\r\n            throw new Error(\"Bạn không có quyền cập nhật thông tin bệnh nhân\");\r\n          }\r\n        } else if (apiError.response && apiError.response.status === 401) {\r\n          throw new Error(\"Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại\");\r\n        } else if (apiError.response && apiError.response.status === 404) {\r\n          throw new Error(\"Không tìm thấy bệnh nhân với ID đã cung cấp\");\r\n        } else {\r\n          throw new Error(`Lỗi cập nhật thông tin: ${apiError.message || 'Không thể kết nối đến máy chủ'}`);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Sử dụng mock data nếu không có token\r\n    console.log(\"No token available, using mock data for updating patient\");\r\n    const updatedPatient = {\r\n      ...patientData,\r\n      _id: id,\r\n      updatedAt: new Date().toISOString()\r\n    } as User;\r\n    \r\n    console.log(`Updated patient using mock data - ID ${id}:`, updatedPatient);\r\n    return updatedPatient;\r\n  } catch (error) {\r\n    // Re-throw để component xử lý và hiển thị\r\n    console.error(`Error updating patient ${id}:`, error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst deletePatient = async (id: string, authToken?: string) => {\r\n  try {\r\n    if (authToken) {\r\n      // Sử dụng API nếu có token\r\n      try {\r\n        console.log(`Deleting patient via API - ID ${id}`);\r\n        \r\n        // Kiểm tra tính hợp lệ của token trước khi gọi API\r\n        const tokenStatus = await apiService.validateToken(authToken);\r\n        if (!tokenStatus.valid) {\r\n          console.error(\"Invalid token when deleting patient:\", tokenStatus);\r\n          throw new Error(`Authentication error: ${tokenStatus.reason}`);\r\n        }\r\n        \r\n        // Gọi API để xóa bệnh nhân\r\n        await axiosInstance.delete(`/users/${id}`, {\r\n          headers: {\r\n            Authorization: `Bearer ${authToken}`\r\n          }\r\n        });\r\n        \r\n        console.log(\"API success - patient deleted\");\r\n        return true;\r\n      } catch (apiError: any) {\r\n        // Log chi tiết lỗi từ API để debug\r\n        console.error(`API error when deleting patient ${id}:`, apiError);\r\n        if (apiError.response) {\r\n          console.error(\"Error status:\", apiError.response.status);\r\n          console.error(\"Error data:\", apiError.response.data);\r\n        }\r\n        \r\n        // Hiển thị thông báo lỗi cụ thể\r\n        if (apiError.response && apiError.response.status === 403) {\r\n          // Thử lại với vai trò tiếp tân\r\n          try {\r\n            console.log(\"Trying to delete patient as receptionist...\");\r\n            const currentUser = await apiService.getUserById('me', authToken);\r\n            \r\n            // Nếu người dùng là tiếp tân, thử gửi với tham số đặc biệt\r\n            if (currentUser && currentUser.role === 'RECEPTIONIST') {\r\n              console.log(\"User is a receptionist, trying with receptionist parameter\");\r\n              \r\n              // Thêm tham số query isReceptionist=true để backend biết đây là tiếp tân\r\n              await axiosInstance.delete(`/users/${id}?isReceptionist=true`, {\r\n                headers: {\r\n                  Authorization: `Bearer ${authToken}`\r\n                }\r\n              });\r\n              \r\n              console.log(\"Success deleting patient as receptionist\");\r\n              return true;\r\n            } else {\r\n              throw new Error(\"Bạn không có quyền xóa bệnh nhân\");\r\n            }\r\n          } catch (retryError) {\r\n            console.error(\"Error when retrying delete as receptionist:\", retryError);\r\n            throw new Error(\"Bạn không có quyền xóa bệnh nhân\");\r\n          }\r\n        } else if (apiError.response && apiError.response.status === 401) {\r\n          throw new Error(\"Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại\");\r\n        } else if (apiError.response && apiError.response.status === 404) {\r\n          throw new Error(\"Không tìm thấy bệnh nhân với ID đã cung cấp\");\r\n        } else if (apiError.response && apiError.response.status === 400) {\r\n          throw new Error(\"Không thể xóa bệnh nhân này. Bệnh nhân có thể đang có dữ liệu liên quan.\");\r\n        } else {\r\n          throw new Error(`Lỗi xóa bệnh nhân: ${apiError.message || 'Không thể kết nối đến máy chủ'}`);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Sử dụng mock data nếu không có token\r\n    console.log(`No token available, using mock data for deleting patient - ID ${id}`);\r\n    return true;\r\n  } catch (error) {\r\n    // Re-throw để component xử lý và hiển thị\r\n    console.error(`Error deleting patient ${id}:`, error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport function PatientManagement({ onBack }: PatientManagementProps) {\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [editingPatient, setEditingPatient] = useState<User | null>(null);\r\n  // Thêm state để theo dõi thay đổi và buộc giao diện cập nhật\r\n  const [refreshData, setRefreshData] = useState(0);\r\n  const [loading, setLoading] = useState(false);\r\n  \r\n  // Sử dụng dữ liệu bệnh nhân từ API hoặc mock data\r\n  const [patients, setPatients] = useState<User[]>([]);\r\n  \r\n  // Lấy token xác thực từ context\r\n  const { token } = useAuth();\r\n  \r\n  // Cập nhật danh sách bệnh nhân khi có thay đổi\r\n  // State để theo dõi lỗi xác thực\r\n  const [authError, setAuthError] = useState<string | null>(null);\r\n\r\n  // State để hiển thị thông báo\r\n  const [notification, setNotification] = useState<{\r\n    type: 'success' | 'error';\r\n    message: string;\r\n  } | null>(null);\r\n\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      setLoading(true);\r\n      setAuthError(null);\r\n      try {\r\n        let patientData: User[] = [];\r\n        \r\n        if (token) {\r\n          try {\r\n            // Kiểm tra tính hợp lệ của token trước\r\n            const tokenStatus = await apiService.validateToken(token);\r\n            \r\n            if (!tokenStatus.valid) {\r\n              console.error(\"Invalid token:\", tokenStatus.reason);\r\n              throw new Error(`Auth token invalid: ${tokenStatus.reason}`);\r\n            }\r\n            \r\n            // Nếu có token hợp lệ, thử lấy dữ liệu từ API\r\n            console.log(\"Fetching patients from API...\");\r\n            patientData = await apiService.getPatients(token);\r\n            console.log(\"Successfully fetched patients from API:\", patientData.length, \"patients\");\r\n          } catch (apiError: any) {\r\n            console.error(\"API error when loading patients:\", apiError);\r\n            \r\n            // Kiểm tra lỗi cụ thể\r\n            if (apiError.response && apiError.response.status === 403) {\r\n              setAuthError(\"Không có quyền truy cập dữ liệu bệnh nhân. Vui lòng đăng nhập lại với tài khoản có quyền.\");\r\n            }\r\n            \r\n            console.log(\"Falling back to mock data...\");\r\n            // Nếu API lỗi, sử dụng mock data\r\n            await initializeData();\r\n            patientData = await getAllPatients();\r\n          }\r\n        } else {\r\n          // Nếu không có token, sử dụng mock data\r\n          console.log(\"No authentication token, using mock data...\");\r\n          await initializeData();\r\n          patientData = await getAllPatients();\r\n        }\r\n        \r\n        setPatients(patientData);\r\n      } catch (error) {\r\n        console.error(\"Error loading patients data:\", error);\r\n        setPatients([]);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    \r\n    loadData();\r\n  }, [refreshData, token]);\r\n  \r\n  const handleEdit = (patient: User) => {\r\n    setEditingPatient(patient);\r\n    setShowForm(true);\r\n  };\r\n  \r\n  const handleDelete = async (id: string) => {\r\n    const confirmed = window.confirm(\"Bạn có chắc chắn muốn xóa bệnh nhân này không?\");\r\n    if (confirmed) {\r\n      setLoading(true);\r\n      setNotification(null);\r\n      try {\r\n        await deletePatient(id, token || undefined);\r\n        // Hiển thị thông báo thành công\r\n        setNotification({\r\n          type: 'success',\r\n          message: 'Xóa bệnh nhân thành công'\r\n        });\r\n        \r\n        // Kích hoạt cập nhật giao diện\r\n        setRefreshData(prev => prev + 1);\r\n      } catch (error: any) {\r\n        console.error(\"Error deleting patient:\", error);\r\n        setNotification({\r\n          type: 'error',\r\n          message: error.message || 'Không thể xóa bệnh nhân. Vui lòng thử lại sau.'\r\n        });\r\n      } finally {\r\n        setLoading(false);\r\n        \r\n        // Tự động ẩn thông báo sau 5 giây\r\n        setTimeout(() => {\r\n          setNotification(null);\r\n        }, 5000);\r\n      }\r\n    }\r\n  };\r\n  \r\n  const handleSavePatient = async (patientData: Partial<User>) => {\r\n    setLoading(true);\r\n    setNotification(null);\r\n    try {\r\n      let result;\r\n      if (editingPatient && editingPatient._id) {\r\n        // Cập nhật bệnh nhân hiện có\r\n        console.log(\"Updating existing patient:\", editingPatient._id);\r\n        result = await updatePatient(editingPatient._id, patientData, token || undefined);\r\n        setNotification({\r\n          type: 'success',\r\n          message: `Cập nhật thông tin bệnh nhân ${result.fullName || ''} thành công`\r\n        });\r\n      } else {\r\n        // Thêm bệnh nhân mới với role là PATIENT\r\n        console.log(\"Adding new patient\");\r\n        result = await addPatient({\r\n          ...patientData,\r\n          role: 'PATIENT'\r\n        }, token || undefined);\r\n        setNotification({\r\n          type: 'success',\r\n          message: `Thêm bệnh nhân ${result.fullName || ''} thành công`\r\n        });\r\n      }\r\n      \r\n      // Kích hoạt cập nhật giao diện\r\n      setRefreshData(prev => prev + 1);\r\n      handleCloseForm();\r\n    } catch (error: any) {\r\n      console.error(\"Error saving patient:\", error);\r\n      setNotification({\r\n        type: 'error',\r\n        message: error.message || 'Không thể lưu thông tin bệnh nhân. Vui lòng thử lại sau.'\r\n      });\r\n      // Không đóng form để người dùng có thể sửa lỗi và thử lại\r\n    } finally {\r\n      setLoading(false);\r\n      \r\n      // Tự động ẩn thông báo sau 5 giây\r\n      setTimeout(() => {\r\n        setNotification(null);\r\n      }, 5000);\r\n    }\r\n  };\r\n  \r\n  const handleCloseForm = () => {\r\n    setShowForm(false);\r\n    setEditingPatient(null);\r\n  };\r\n  \r\n  // Hàm thêm bệnh nhân vào phòng chờ\r\n  const addToWaitingRoom = async (patientId: string) => {\r\n    try {\r\n      setLoading(true);\r\n      setNotification(null);\r\n\r\n      if (token) {\r\n        // Thử sử dụng API nếu có token\r\n        try {\r\n          console.log(`Adding patient ${patientId} to queue via API`);\r\n          \r\n          // Kiểm tra tính hợp lệ của token\r\n          const tokenStatus = await apiService.validateToken(token);\r\n          if (!tokenStatus.valid) {\r\n            console.error(\"Invalid token when adding to queue:\", tokenStatus);\r\n            throw new Error(`Authentication error: ${tokenStatus.reason}`);\r\n          }\r\n          \r\n          // Kiểm tra xem bệnh nhân đã có trong phòng chờ chưa bằng API\r\n          const allQueues = await apiService.getQueues(token);\r\n          const existingQueue = allQueues.find(\r\n            (queue: any) => queue.patient === patientId && \r\n                          ['waiting', 'in_progress'].includes(queue.status)\r\n          );\r\n          \r\n          if (existingQueue) {\r\n            setNotification({\r\n              type: 'error',\r\n              message: 'Bệnh nhân này đã có trong phòng chờ hoặc đang khám!'\r\n            });\r\n            return;\r\n          }\r\n          \r\n          // Gọi API để tạo queue mới\r\n          const newQueue = await apiService.createQueue(patientId, token);\r\n          \r\n          console.log(\"Successfully added patient to queue via API:\", newQueue);\r\n          setNotification({\r\n            type: 'success',\r\n            message: 'Đã thêm bệnh nhân vào phòng chờ!'\r\n          });\r\n          \r\n          return;\r\n        } catch (apiError: any) {\r\n          console.error(\"API error when adding to queue:\", apiError);\r\n          if (apiError.response) {\r\n            console.error(\"Error status:\", apiError.response.status);\r\n            console.error(\"Error data:\", apiError.response.data);\r\n          }\r\n          \r\n          // Hiển thị lỗi cụ thể\r\n          if (apiError.response && apiError.response.status === 403) {\r\n            setNotification({\r\n              type: 'error',\r\n              message: 'Bạn không có quyền thêm bệnh nhân vào phòng chờ'\r\n            });\r\n            return;\r\n          } else if (apiError.response && apiError.response.status === 401) {\r\n            setNotification({\r\n              type: 'error',\r\n              message: 'Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại'\r\n            });\r\n            return;\r\n          }\r\n          \r\n          console.log(\"Falling back to mock data for adding to queue\");\r\n          // Không return, tiếp tục xuống phần fallback\r\n        }\r\n      }\r\n      \r\n      // Fallback to mock data\r\n      // Kiểm tra xem bệnh nhân đã có trong phòng chờ chưa\r\n      const existingQueue = await getQueueByPatientId(patientId);\r\n      \r\n      if (existingQueue) {\r\n        if (existingQueue.status === 'waiting' || existingQueue.status === 'in_progress') {\r\n          setNotification({\r\n            type: 'error',\r\n            message: 'Bệnh nhân này đã có trong phòng chờ hoặc đang khám!'\r\n          });\r\n          return;\r\n        } else if (existingQueue.status === 'completed' || existingQueue.status === 'canceled') {\r\n          // Nếu bệnh nhân đã từng được thêm vào phòng chờ trước đó,\r\n          // nhưng đã hoàn thành hoặc hủy, ta có thể thêm họ vào lại phòng chờ\r\n          const newQueue = await addQueue(patientId);\r\n          if (newQueue) {\r\n            setNotification({\r\n              type: 'success',\r\n              message: 'Đã thêm bệnh nhân vào phòng chờ! (dữ liệu mô phỏng)'\r\n            });\r\n          } else {\r\n            setNotification({\r\n              type: 'error',\r\n              message: 'Có lỗi khi thêm bệnh nhân vào phòng chờ!'\r\n            });\r\n          }\r\n        }\r\n      } else {\r\n        // Nếu bệnh nhân chưa từng được thêm vào phòng chờ\r\n        const newQueue = await addQueue(patientId);\r\n        if (newQueue) {\r\n          setNotification({\r\n            type: 'success',\r\n            message: 'Đã thêm bệnh nhân vào phòng chờ! (dữ liệu mô phỏng)'\r\n          });\r\n        } else {\r\n          setNotification({\r\n            type: 'error',\r\n            message: 'Có lỗi khi thêm bệnh nhân vào phòng chờ!'\r\n          });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error adding patient to waiting room:\", error);\r\n      setNotification({\r\n        type: 'error',\r\n        message: 'Có lỗi xảy ra khi thêm bệnh nhân vào phòng chờ!'\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n      \r\n      // Tự động ẩn thông báo sau 5 giây\r\n      setTimeout(() => {\r\n        setNotification(null);\r\n      }, 5000);\r\n    }\r\n  };\r\n  \r\n  // State for handling search results\r\n  const [searchResults, setSearchResults] = useState<User[]>([]);\r\n  \r\n  // Effect to handle search\r\n  useEffect(() => {\r\n    const handleSearch = async () => {\r\n      if (searchTerm.trim() === '') {\r\n        setSearchResults([]);\r\n        return;\r\n      }\r\n      \r\n      try {\r\n        const results = await searchUsers(searchTerm);\r\n        const filteredResults = results.filter(user => user.role === 'PATIENT');\r\n        setSearchResults(filteredResults);\r\n      } catch (error) {\r\n        console.error(\"Error searching patients:\", error);\r\n        setSearchResults([]);\r\n      }\r\n    };\r\n    \r\n    handleSearch();\r\n  }, [searchTerm]);\r\n  \r\n  // Use either search results or all patients\r\n  const filteredPatients = searchTerm.trim() === '' ? patients : searchResults;\r\n  \r\n  return (\r\n    <div className=\"w-full px-4 sm:px-6\">\r\n      <div className=\"flex items-center mb-4\">\r\n        <button \r\n          onClick={onBack}\r\n          className=\"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-md flex items-center text-gray-700\"\r\n        >\r\n          ← Quay lại\r\n        </button>\r\n      </div>\r\n      {/* Header section */}\r\n      <div className=\"mb-8 border-b border-gray-200 pb-5\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <h1 className=\"text-3xl font-bold text-black tracking-tight\">Quản lý bệnh nhân</h1>\r\n          <button \r\n            onClick={() => setShowForm(true)} \r\n            className=\"bg-green-600 hover:bg-green-700 text-white px-5 py-2.5 rounded-lg flex items-center font-medium shadow-sm transition-colors\"\r\n          >\r\n            <PlusIcon size={18} className=\"mr-2\" />\r\n            Thêm bệnh nhân\r\n          </button>\r\n        </div>\r\n        <p className=\"text-black mt-2\">\r\n          Quản lý thông tin bệnh nhân và thêm vào phòng chờ\r\n        </p>\r\n      </div>\r\n      \r\n      {/* Main content */}\r\n      <div className=\"border border-gray-300 rounded-xl shadow-sm overflow-hidden bg-white\">\r\n        {/* Auth error notification if present */}\r\n        {authError && (\r\n          <div className=\"bg-red-50 border border-red-200 text-red-700 px-6 py-4 mb-4 rounded-lg mx-6 mt-6\">\r\n            <div className=\"flex\">\r\n              <div className=\"flex-shrink-0\">\r\n                <svg className=\"h-5 w-5 text-red-500\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                  <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n                </svg>\r\n              </div>\r\n              <div className=\"ml-3\">\r\n                <h3 className=\"text-sm font-medium text-red-800\">Lỗi xác thực</h3>\r\n                <div className=\"mt-1 text-sm text-red-700\">{authError}</div>\r\n                <div className=\"mt-2\">\r\n                  <button \r\n                    className=\"text-sm font-medium text-red-700 hover:text-red-600 underline\"\r\n                    onClick={() => setRefreshData(prev => prev + 1)}\r\n                  >\r\n                    Thử lại\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Search and filters */}\r\n        <div className=\"p-6 border-b border-gray-300 bg-gray-50\">\r\n          <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\r\n            <div className=\"relative flex-1\">\r\n              <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                <SearchIcon size={18} className=\"text-black\" />\r\n              </div>\r\n              <input \r\n                type=\"text\" \r\n                placeholder=\"Tìm kiếm theo tên, ID, email hoặc SĐT...\" \r\n                className=\"pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-black focus:border-black text-black placeholder-gray-500 shadow-sm\" \r\n                value={searchTerm} \r\n                onChange={e => setSearchTerm(e.target.value)} \r\n              />\r\n            </div>\r\n            \r\n            <div className=\"flex gap-3\">\r\n              <div className=\"relative\">\r\n                <select className=\"appearance-none bg-white border border-gray-300 rounded-lg pl-10 pr-10 py-2.5 focus:outline-none focus:ring-2 focus:ring-black focus:border-black text-black shadow-sm\">\r\n                  <option value=\"\">Tất cả vai trò</option>\r\n                  <option value=\"PATIENT\">Bệnh nhân</option>\r\n                  <option value=\"DOCTOR\">Bác sĩ</option>\r\n                  <option value=\"PHARMACIST\">Nhân viên quầy thuốc</option>\r\n                  <option value=\"RECEPTIONIST\">Lễ tân</option>\r\n                  <option value=\"ADMIN\">Quản trị viên</option>\r\n                </select>\r\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                  <FilterIcon size={16} className=\"text-black\" />\r\n                </div>\r\n                <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\r\n                  <svg className=\"h-4 w-4 text-black\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                    <path fillRule=\"evenodd\" d=\"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"relative\">\r\n                <select className=\"appearance-none bg-white border border-gray-300 rounded-lg pl-10 pr-10 py-2.5 focus:outline-none focus:ring-2 focus:ring-black focus:border-black text-black shadow-sm\">\r\n                  <option value=\"\">Sắp xếp theo</option>\r\n                  <option value=\"fullName\">Tên</option>\r\n                  <option value=\"username\">Tên đăng nhập</option>\r\n                  <option value=\"createdAt\">Ngày tạo</option>\r\n                </select>\r\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                  <ArrowUpDown size={16} className=\"text-black\" />\r\n                </div>\r\n                <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\r\n                  <svg className=\"h-4 w-4 text-black\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                    <path fillRule=\"evenodd\" d=\"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Table or empty state */}\r\n        <div className=\"p-6\">\r\n          {filteredPatients.length > 0 ? (\r\n            <div className=\"overflow-x-auto border border-gray-200 rounded-lg\">\r\n              <table className=\"min-w-full divide-y divide-gray-200\">\r\n                <thead className=\"bg-gray-50\">\r\n                  <tr>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider border-b border-gray-200\">\r\n                      Họ và tên\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider border-b border-gray-200\">\r\n                      User ID\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider border-b border-gray-200\">\r\n                      Username\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider border-b border-gray-200\">\r\n                      Email\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider border-b border-gray-200\">\r\n                      Điện thoại\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider border-b border-gray-200\">\r\n                      Vai trò\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider border-b border-gray-200\">\r\n                      Thao tác\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                  {loading ? (\r\n                    <tr>\r\n                      <td colSpan={7} className=\"px-6 py-10 text-center\">\r\n                        <div className=\"flex justify-center items-center space-x-2\">\r\n                          <span className=\"animate-spin\">⏳</span>\r\n                          <span>Đang tải dữ liệu...</span>\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  ) : filteredPatients.length === 0 ? (\r\n                    <tr>\r\n                      <td colSpan={7} className=\"px-6 py-10 text-center\">\r\n                        Không tìm thấy bệnh nhân nào.\r\n                      </td>\r\n                    </tr>\r\n                  ) : (\r\n                    filteredPatients.map((patient, index) => (\r\n                      <tr key={patient._id} className={index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>\r\n                        <td className=\"px-6 py-3.5 whitespace-nowrap text-sm font-medium text-black\">\r\n                          {patient.fullName}\r\n                        </td>\r\n                        <td className=\"px-6 py-3.5 whitespace-nowrap text-sm text-black\">\r\n                          {patient.userId}\r\n                        </td>\r\n                        <td className=\"px-6 py-3.5 whitespace-nowrap text-sm text-black\">\r\n                          {patient.username}\r\n                        </td>\r\n                        <td className=\"px-6 py-3.5 whitespace-nowrap text-sm text-black\">\r\n                          {patient.email}\r\n                        </td>\r\n                        <td className=\"px-6 py-3.5 whitespace-nowrap text-sm text-black\">\r\n                          {patient.phone}\r\n                        </td>\r\n                        <td className=\"px-6 py-3.5 whitespace-nowrap text-sm text-black\">\r\n                          {patient.role}\r\n                        </td>\r\n                        <td className=\"px-6 py-3.5 whitespace-nowrap text-sm text-black\">\r\n                          <div className=\"flex items-center space-x-3\">\r\n                            <button \r\n                              onClick={() => handleEdit(patient)} \r\n                              className=\"p-1.5 rounded-full hover:bg-gray-100 text-black border border-gray-300\"\r\n                              title=\"Chỉnh sửa\"\r\n                            >\r\n                              <EditIcon size={16} />\r\n                            </button>\r\n                            <button \r\n                              onClick={() => handleDelete(patient._id)}\r\n                              className=\"p-1.5 rounded-full hover:bg-gray-100 text-black border border-gray-300\"\r\n                              title=\"Xóa\"\r\n                            >\r\n                              <TrashIcon size={16} />\r\n                            </button>\r\n                            <button \r\n                              onClick={() => addToWaitingRoom(patient._id)}\r\n                              className=\"text-sm text-white bg-green-600 hover:bg-green-700 px-3 py-1.5 rounded-lg transition-colors shadow-sm flex items-center\"\r\n                            >\r\n                              <UserPlusIcon size={16} className=\"mr-1\" />\r\n                              Thêm vào phòng chờ\r\n                            </button>\r\n                          </div>\r\n                        </td>\r\n                      </tr>\r\n                    ))\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          ) : (\r\n            <div className=\"flex flex-col items-center justify-center py-16 border border-dashed border-gray-300 rounded-lg\">\r\n              <UsersIcon size={48} className=\"text-gray-400 mb-4\" />\r\n              <h3 className=\"text-lg font-medium text-black\">\r\n                Không tìm thấy bệnh nhân\r\n              </h3>\r\n              <p className=\"text-black mt-2\">\r\n                Thử tìm kiếm với từ khóa khác hoặc thêm bệnh nhân mới\r\n              </p>\r\n            </div>\r\n          )}\r\n          \r\n          {/* Pagination */}\r\n          {filteredPatients.length > 0 && (\r\n            <div className=\"mt-6 flex justify-between items-center\">\r\n              <p className=\"text-sm text-black\">\r\n                Hiển thị <span className=\"font-medium\">{filteredPatients.length}</span> bệnh nhân\r\n              </p>\r\n              <div className=\"inline-flex shadow-sm rounded-md\">\r\n                <button className=\"px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-black rounded-l-md hover:bg-gray-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-black focus:border-black transition-colors\">\r\n                  Trước\r\n                </button>\r\n                <button className=\"px-4 py-2 bg-gray-200 text-black text-sm font-medium border border-gray-300 relative -ml-px hover:bg-gray-300 focus:z-10 focus:outline-none focus:ring-1 focus:ring-black focus:border-black transition-colors\">\r\n                  1\r\n                </button>\r\n                <button className=\"px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-black rounded-r-md hover:bg-gray-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-black focus:border-black transition-colors\">\r\n                  Sau\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Modal form */}\r\n      {showForm && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n            <PatientForm \r\n              patient={editingPatient} \r\n              onClose={handleCloseForm}\r\n              onSave={handleSavePatient} \r\n              isLoading={loading}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n      {/* Notification component */}\r\n      {notification && (\r\n        <div className={`fixed bottom-6 right-6 max-w-sm w-full shadow-lg rounded-lg p-4 flex items-start space-x-4 z-50 ${\r\n          notification.type === 'success' ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'\r\n        }`}>\r\n          <div className={`flex-shrink-0 h-5 w-5 relative mt-0.5 ${\r\n            notification.type === 'success' ? 'text-green-600' : 'text-red-600'\r\n          }`}>\r\n            {notification.type === 'success' ? (\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            ) : (\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            )}\r\n          </div>\r\n          <div className=\"flex-1\">\r\n            <h3 className={`text-sm font-medium ${\r\n              notification.type === 'success' ? 'text-green-800' : 'text-red-800'\r\n            }`}>\r\n              {notification.type === 'success' ? 'Thành công' : 'Lỗi'}\r\n            </h3>\r\n            <p className={`mt-1 text-sm ${\r\n              notification.type === 'success' ? 'text-green-700' : 'text-red-700'\r\n            }`}>\r\n              {notification.message}\r\n            </p>\r\n          </div>\r\n          <button \r\n            onClick={() => setNotification(null)}\r\n            className=\"flex-shrink-0 text-gray-500 hover:text-gray-700 focus:outline-none\"\r\n          >\r\n            <svg className=\"h-4 w-4\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n              <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      )}\r\n      \r\n      {/* Notification component */}\r\n      {notification && (\r\n        <div className={`fixed bottom-6 right-6 max-w-sm w-full shadow-lg rounded-lg p-4 flex items-start space-x-4 z-50 ${\r\n          notification.type === 'success' ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'\r\n        }`}>\r\n          <div className={`flex-shrink-0 h-5 w-5 relative mt-0.5 ${\r\n            notification.type === 'success' ? 'text-green-600' : 'text-red-600'\r\n          }`}>\r\n            {notification.type === 'success' ? (\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            ) : (\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            )}\r\n          </div>\r\n          <div className=\"flex-1\">\r\n            <h3 className={`text-sm font-medium ${\r\n              notification.type === 'success' ? 'text-green-800' : 'text-red-800'\r\n            }`}>\r\n              {notification.type === 'success' ? 'Thành công' : 'Lỗi'}\r\n            </h3>\r\n            <p className={`mt-1 text-sm ${\r\n              notification.type === 'success' ? 'text-green-700' : 'text-red-700'\r\n            }`}>\r\n              {notification.message}\r\n            </p>\r\n          </div>\r\n          <button \r\n            onClick={() => setNotification(null)}\r\n            className=\"flex-shrink-0 text-gray-500 hover:text-gray-700 focus:outline-none\"\r\n          >\r\n            <svg className=\"h-4 w-4\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n              <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4442, "column": 0}, "map": {"version":3,"sources":["file:///D:/Codes/Projects/hospitalityWeb/hospitality-website/my-app/src/app/receptionistPage/QueueManagement.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { MoveRightIcon, CheckCircleIcon, ClockIcon, UserIcon, X, RefreshCcw } from 'lucide-react';\r\nimport { \r\n  getAllQueuesWithPatientInfo, \r\n  updateQueueStatus, \r\n  Queue,\r\n  getAllDoctors,\r\n  getUsersByRole,\r\n  User,\r\n  initializeData,\r\n  sendQueueToDoctor\r\n} from '../datats/mockPatients';\r\nimport * as apiService from '../services/api.service';\r\nimport { useAuth } from '../context/AuthContext';\r\n\r\ninterface QueueManagementProps {\r\n  onBack: () => void;\r\n}\r\n\r\n// Extended interface to work with both API and mock data\r\ninterface QueueWithPatientInfo {\r\n  _id: string;\r\n  patientInfo?: {\r\n    _id: string;\r\n    userId: string;\r\n    fullName: string;\r\n    phone: string;\r\n    role: string;\r\n    [key: string]: any;\r\n  } | null;\r\n  // For API response\r\n  patient?: {\r\n    _id: string;\r\n    userId: string;\r\n    fullName: string;\r\n    phone: string;\r\n    role: string;\r\n    email: string;\r\n    [key: string]: any;\r\n  } | string;\r\n  status: 'waiting' | 'in_progress' | 'completed' | 'canceled';\r\n  doctorId?: {\r\n    _id: string;\r\n    userId: string;\r\n    fullName: string;\r\n    [key: string]: any;\r\n  } | string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  __v: number;\r\n}\r\n\r\nexport function QueueManagement({ onBack }: QueueManagementProps) {\r\n  // State để lưu trữ danh sách queue đã được fetch từ API\r\n  const [queues, setQueues] = useState<QueueWithPatientInfo[]>([]);\r\n  \r\n  // State để lưu trữ danh sách bệnh nhân đang chờ\r\n  const [waitingPatients, setWaitingPatients] = useState<QueueWithPatientInfo[]>([]);\r\n  \r\n  // State để lưu trữ danh sách bệnh nhân đang khám\r\n  const [inProgressPatients, setInProgressPatients] = useState<QueueWithPatientInfo[]>([]);\r\n  \r\n  // Lấy danh sách bác sĩ từ API\r\n  const [doctors, setDoctors] = useState<User[]>([]);\r\n  \r\n  // State để theo dõi modal chọn bác sĩ\r\n  const [showDoctorModal, setShowDoctorModal] = useState(false);\r\n  const [selectedQueue, setSelectedQueue] = useState<string>('');\r\n  \r\n  // State để theo dõi trạng thái loading\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  // Lấy authentication token từ context\r\n  const { token } = useAuth();\r\n  \r\n  // Function để format dữ liệu từ API về đúng định dạng cần dùng\r\n  const formatApiQueueResponse = (apiData: any[]): QueueWithPatientInfo[] => {\r\n    return apiData.map(item => ({\r\n      ...item,\r\n      // Map thông tin bệnh nhân từ phản hồi API sang format patientInfo cho tương thích\r\n      patientInfo: item.patient && typeof item.patient === 'object' ? {\r\n        _id: item.patient._id,\r\n        userId: item.patient.userId,\r\n        fullName: item.patient.fullName,\r\n        phone: item.patient.phone,\r\n        role: item.patient.role,\r\n        email: item.patient.email\r\n      } : null,\r\n      // Giữ nguyên patient từ API để tiện sử dụng\r\n    }));\r\n  };\r\n  \r\n  // Format dữ liệu từ mock data để tương thích với kiểu QueueWithPatientInfo\r\n  const formatMockQueueData = (mockData: any[]): QueueWithPatientInfo[] => {\r\n    return mockData.map(item => ({\r\n      ...item,\r\n      // Đảm bảo kiểu dữ liệu phù hợp với QueueWithPatientInfo\r\n      patient: item.patient, // Giữ nguyên dạng string cho mock data\r\n    }));\r\n  };\r\n  \r\n  // Effect để fetch dữ liệu queue từ API khi component được render\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      try {\r\n        if (token) {\r\n          // Fetch data từ API nếu có token\r\n          try {\r\n            console.log(\"Fetching queues from API...\");\r\n            const apiQueues = await apiService.getQueuesWithPatients(token);\r\n            console.log(\"API response:\", apiQueues);\r\n            \r\n            // Format lại dữ liệu từ API\r\n            const formattedQueues = formatApiQueueResponse(apiQueues);\r\n            setQueues(formattedQueues);\r\n            \r\n            // Lọc ra các trạng thái khác nhau\r\n            const waiting = formattedQueues.filter(q => q.status === 'waiting');\r\n            const inProgress = formattedQueues.filter(q => q.status === 'in_progress');\r\n            \r\n            setWaitingPatients(waiting);\r\n            setInProgressPatients(inProgress);\r\n            \r\n            // Không lấy danh sách bác sĩ ở đây nữa, sẽ lấy khi mở modal\r\n          } catch (apiError: any) {\r\n            console.error(\"API error:\", apiError);\r\n            setError(`Lỗi khi lấy dữ liệu từ API: ${apiError.message}`);\r\n            \r\n            // Fallback to mock data\r\n            console.log(\"Falling back to mock data...\");\r\n            await fallbackToMockData();\r\n          }\r\n        } else {\r\n          // Không có token, sử dụng mock data\r\n          console.log(\"No token available, using mock data...\");\r\n          await fallbackToMockData();\r\n        }\r\n      } catch (error: any) {\r\n        console.error(\"Error loading data:\", error);\r\n        setError(`Lỗi: ${error.message}`);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    \r\n    const fallbackToMockData = async () => {\r\n      try {\r\n        // Đảm bảo mock data được khởi tạo\r\n        await initializeData();\r\n        \r\n        // Lấy toàn bộ queue cùng với thông tin bệnh nhân từ mock data\r\n        const allQueues = await getAllQueuesWithPatientInfo();\r\n        const formattedMockQueues = formatMockQueueData(allQueues);\r\n        \r\n        setQueues(formattedMockQueues);\r\n        \r\n        // Lọc ra các trạng thái khác nhau\r\n        const waiting = formattedMockQueues.filter(q => q.status === 'waiting');\r\n        const inProgress = formattedMockQueues.filter(q => q.status === 'in_progress');\r\n        \r\n        setWaitingPatients(waiting);\r\n        setInProgressPatients(inProgress);\r\n        \r\n        // Không lấy danh sách bác sĩ ở đây nữa, sẽ lấy khi mở modal\r\n      } catch (mockError) {\r\n        console.error(\"Error loading mock data:\", mockError);\r\n        setError(`Không thể tải dữ liệu: ${mockError}`);\r\n      }\r\n    };\r\n    \r\n    loadData();\r\n  }, [token]);\r\n  \r\n  // Tính thời gian chờ dựa trên createdAt (giả lập)\r\n  const calculateWaitingTime = (createdAt: string): string => {\r\n    const createdDate = new Date(createdAt);\r\n    const currentDate = new Date();\r\n    const diffMs = currentDate.getTime() - createdDate.getTime();\r\n    const diffMins = Math.round(diffMs / 60000);\r\n    \r\n    if (diffMins < 60) {\r\n      return `${diffMins} phút`;\r\n    } else {\r\n      const hours = Math.floor(diffMins / 60);\r\n      const mins = diffMins % 60;\r\n      return `${hours} giờ ${mins} phút`;\r\n    }\r\n  };\r\n  \r\n  // Hàm xử lý khi click vào nút \"Chuyển vào khám\"\r\n  const handleMoveToExamination = async (queueId: string) => {\r\n    // Mở modal để chọn bác sĩ\r\n    setSelectedQueue(queueId);\r\n    setShowDoctorModal(true);\r\n    \r\n    // Lấy danh sách bác sĩ vào lúc này, không phải lúc load trang\r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      let doctorsList: User[] = [];\r\n      \r\n      if (token) {\r\n        // Thử sử dụng endpoint mới dành riêng cho việc lấy danh sách bác sĩ\r\n        try {\r\n          console.log(\"Fetching doctors from API...\");\r\n          doctorsList = await apiService.getDoctors(token);\r\n          console.log(`Retrieved ${doctorsList.length} doctors from API`);\r\n        } catch (apiError: any) {\r\n          console.error(\"API error when fetching doctors:\", apiError);\r\n          \r\n          // Fallback to mock data\r\n          console.log(\"Falling back to mock data for doctors...\");\r\n          doctorsList = await getUsersByRole('DOCTOR');\r\n        }\r\n      } else {\r\n        // Sử dụng mock data nếu không có token\r\n        console.log(\"Using mock data for doctors list...\");\r\n        doctorsList = await getUsersByRole('DOCTOR');\r\n      }\r\n      \r\n      // Cập nhật state với danh sách bác sĩ\r\n      setDoctors(doctorsList);\r\n    } catch (error: any) {\r\n      console.error(\"Error loading doctors:\", error);\r\n      setError(`Lỗi khi tải danh sách bác sĩ: ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  // Hàm xử lý khi đã chọn bác sĩ và xác nhận chuyển bệnh nhân vào khám\r\n  const handleConfirmMoveToExamination = async (doctorId: string) => {\r\n    setLoading(true);\r\n    try {\r\n      if (token) {\r\n        // Sử dụng API nếu có token\r\n        try {\r\n          console.log(`Updating queue ${selectedQueue} via API...`);\r\n          const updatedQueue = await apiService.updateQueueStatus(\r\n            selectedQueue, \r\n            token,\r\n            'in_progress',\r\n            doctorId\r\n          );\r\n          console.log(\"API update successful:\", updatedQueue);\r\n          \r\n          // Cập nhật UI với dữ liệu mới\r\n          await refreshData();\r\n          \r\n        } catch (apiError) {\r\n          console.error(\"API error when updating queue:\", apiError);\r\n          // Fallback to mock function\r\n          await fallbackUpdateQueue(selectedQueue, 'in_progress', doctorId);\r\n        }\r\n      } else {\r\n        // Sử dụng mock function nếu không có token\r\n        await fallbackUpdateQueue(selectedQueue, 'in_progress', doctorId);\r\n      }\r\n      \r\n      // Đóng modal\r\n      setShowDoctorModal(false);\r\n      setSelectedQueue('');\r\n    } catch (error) {\r\n      console.error(\"Error moving patient to examination:\", error);\r\n      setError(`Lỗi khi chuyển bệnh nhân vào khám: ${error}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  // Hàm xử lý khi hoàn thành khám bệnh\r\n  const handleCompleteExamination = async (queueId: string) => {\r\n    setLoading(true);\r\n    try {\r\n      if (token) {\r\n        // Sử dụng API nếu có token\r\n        try {\r\n          // Bước 1: Gửi thông tin bệnh nhân đến bác sĩ\r\n          console.log(`Sending queue ${queueId} information to doctor...`);\r\n          try {\r\n            const sendResult = await apiService.sendQueueToDoctor(queueId, token);\r\n            console.log(\"Queue sent to doctor successfully:\", sendResult);\r\n            setError(`Đã gửi thông tin bệnh nhân đến bác sĩ thành công!`);\r\n          } catch (sendError: any) {\r\n            console.error(\"Error sending queue to doctor:\", sendError);\r\n            setError(`Lỗi khi gửi thông tin đến bác sĩ: ${sendError.message}. Nhưng vẫn hoàn thành thay đổi trạng thái.`);\r\n          }\r\n          \r\n          // Bước 2: Cập nhật trạng thái queue\r\n          console.log(`Updating queue ${queueId} status to completed...`);\r\n          const updatedQueue = await apiService.updateQueueStatus(\r\n            queueId, \r\n            token,\r\n            'completed'\r\n          );\r\n          console.log(\"API update successful:\", updatedQueue);\r\n          \r\n          // Cập nhật UI với dữ liệu mới\r\n          await refreshData();\r\n          \r\n        } catch (apiError) {\r\n          console.error(\"API error when completing examination:\", apiError);\r\n          // Fallback to mock function\r\n          await fallbackUpdateQueue(queueId, 'completed');\r\n        }\r\n      } else {\r\n        // Sử dụng mock function nếu không có token\r\n        await fallbackUpdateQueue(queueId, 'completed');\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Error completing examination:\", error);\r\n      setError(`Lỗi khi hoàn thành khám bệnh: ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n      \r\n      // Tự động ẩn thông báo lỗi sau 5 giây\r\n      setTimeout(() => {\r\n        setError(null);\r\n      }, 5000);\r\n    }\r\n  };\r\n  \r\n  // Fallback function để sử dụng mock data khi API lỗi\r\n  const fallbackUpdateQueue = async (queueId: string, status: 'waiting' | 'in_progress' | 'completed' | 'canceled', doctorId?: string) => {\r\n    try {\r\n      console.log(`Using mock data to update queue ${queueId} to ${status}`);\r\n      \r\n      // Nếu đang chuyển sang trạng thái completed, gửi thông tin đến bác sĩ trước\r\n      if (status === 'completed') {\r\n        try {\r\n          // Trong trường hợp thực, thông tin này đã được gửi qua API\r\n          // Đối với mock data, ta giả lập việc gửi thông tin\r\n          console.log(`Sending queue ${queueId} information to doctor (mock)...`);\r\n          await sendQueueToDoctor(queueId);\r\n          console.log('Mock: Information successfully sent to doctor');\r\n        } catch (sendError) {\r\n          console.error(\"Error sending information to doctor (mock):\", sendError);\r\n        }\r\n      }\r\n      \r\n      const updatedQueue = await updateQueueStatus(queueId, status, doctorId);\r\n      \r\n      if (updatedQueue) {\r\n        // Cập nhật lại state để re-render UI\r\n        const allQueues = await getAllQueuesWithPatientInfo();\r\n        const formattedMockQueues = formatMockQueueData(allQueues);\r\n        \r\n        setQueues(formattedMockQueues);\r\n        \r\n        // Lọc lại các danh sách\r\n        const waiting = formattedMockQueues.filter(q => q.status === 'waiting');\r\n        const inProgress = formattedMockQueues.filter(q => q.status === 'in_progress');\r\n        \r\n        setWaitingPatients(waiting);\r\n        setInProgressPatients(inProgress);\r\n      }\r\n    } catch (mockError: any) {\r\n      console.error(\"Error using mock data:\", mockError);\r\n      setError(`Không thể cập nhật trạng thái: ${mockError.message || mockError}`);\r\n    }\r\n  };\r\n  \r\n  // Lấy thông tin bác sĩ được chỉ định cho bệnh nhân\r\n  const getAssignedDoctor = (doctorId?: any) => {\r\n    if (!doctorId) return null;\r\n    \r\n    // Nếu doctorId là object (từ API)\r\n    if (typeof doctorId === 'object' && doctorId !== null) {\r\n      return doctorId;\r\n    }\r\n    \r\n    // Nếu doctorId là string (từ mock data)\r\n    return doctors.find(doctor => doctor._id === doctorId) || null;\r\n  };\r\n  \r\n  // Hàm để refresh dữ liệu\r\n  const refreshData = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      if (token) {\r\n        console.log(\"Refreshing data from API...\");\r\n        const apiQueues = await apiService.getQueuesWithPatients(token);\r\n        const formattedQueues = formatApiQueueResponse(apiQueues);\r\n        \r\n        setQueues(formattedQueues);\r\n        setWaitingPatients(formattedQueues.filter(q => q.status === 'waiting'));\r\n        setInProgressPatients(formattedQueues.filter(q => q.status === 'in_progress'));\r\n      } else {\r\n        console.log(\"Refreshing data from mock data...\");\r\n        await initializeData();\r\n        const allQueues = await getAllQueuesWithPatientInfo();\r\n        const formattedMockQueues = formatMockQueueData(allQueues);\r\n        \r\n        setQueues(formattedMockQueues);\r\n        setWaitingPatients(formattedMockQueues.filter(q => q.status === 'waiting'));\r\n        setInProgressPatients(formattedMockQueues.filter(q => q.status === 'in_progress'));\r\n      }\r\n      \r\n      // Không cần refresh danh sách bác sĩ, vì danh sách này sẽ được load khi cần thiết\r\n    } catch (error: any) {\r\n      console.error(\"Error refreshing data:\", error);\r\n      setError(`Lỗi khi làm mới dữ liệu: ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Trích xuất thông tin bệnh nhân từ mỗi queue, xử lý cả từ API và mock data\r\n  const getPatientInfo = (queue: QueueWithPatientInfo) => {\r\n    // Ưu tiên patientInfo (đã được chuẩn hoá)\r\n    if (queue.patientInfo) {\r\n      return queue.patientInfo;\r\n    }\r\n    \r\n    // Nếu patient là object (từ API)\r\n    if (queue.patient && typeof queue.patient === 'object') {\r\n      return {\r\n        _id: queue.patient._id,\r\n        userId: queue.patient.userId,\r\n        fullName: queue.patient.fullName,\r\n        phone: queue.patient.phone,\r\n        role: queue.patient.role,\r\n        email: queue.patient.email\r\n      };\r\n    }\r\n    \r\n    // Trường hợp khác (có thể là null hoặc không có thông tin)\r\n    return null;\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full px-4 sm:px-6\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <button \r\n          onClick={onBack}\r\n          className=\"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-md flex items-center text-gray-700\"\r\n        >\r\n          ← Quay lại\r\n        </button>\r\n        \r\n        <button \r\n          onClick={refreshData}\r\n          disabled={loading}\r\n          className={`px-4 py-2 rounded-md flex items-center ${loading ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'} text-white`}\r\n        >\r\n          <RefreshCcw size={16} className={`mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n          {loading ? 'Đang tải...' : 'Làm mới dữ liệu'}\r\n        </button>\r\n      </div>\r\n      {/* Header section */}\r\n      <div className=\"mb-8 border-b border-gray-200 pb-5\">\r\n        <h1 className=\"text-3xl font-bold text-black tracking-tight\">Quản lý phòng chờ</h1>\r\n        <p className=\"text-black mt-2\">\r\n          Quản lý danh sách bệnh nhân đang chờ khám và theo dõi trạng thái\r\n        </p>\r\n        {error && (\r\n          <div className=\"mt-4 p-3 bg-red-50 border border-red-300 text-red-700 rounded-lg\">\r\n            {error}\r\n          </div>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Main content grid */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n        {/* Waiting patients card */}\r\n        <div className=\"border border-gray-300 rounded-xl shadow-sm overflow-hidden bg-white\">\r\n          <div className=\"p-4 border-b border-gray-300 bg-gray-50 flex justify-between items-center\">\r\n            <div className=\"flex items-center\">\r\n              <ClockIcon size={20} className=\"text-black mr-2\" />\r\n              <h2 className=\"text-lg font-semibold text-black\">\r\n                Bệnh nhân đang chờ\r\n              </h2>\r\n            </div>\r\n            <span className=\"bg-gray-800 text-white text-sm px-3.5 py-1 rounded-full font-medium flex items-center\">\r\n              <UserIcon size={14} className=\"mr-1.5\" />\r\n              {waitingPatients.length} bệnh nhân\r\n            </span>\r\n          </div>\r\n          \r\n          {loading ? (\r\n            <div className=\"p-8 text-center\">\r\n              <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-gray-900 mx-auto mb-3\"></div>\r\n              <p className=\"text-black\">Đang tải dữ liệu...</p>\r\n            </div>\r\n          ) : waitingPatients.length > 0 ? (\r\n            <div className=\"divide-y divide-gray-200\">\r\n              {waitingPatients.map((queue, index) => {\r\n                // Lấy thông tin bệnh nhân từ đúng nguồn dữ liệu\r\n                const patientInfo = getPatientInfo(queue);\r\n                \r\n                return (\r\n                  <div key={queue._id} className={`p-5 hover:bg-gray-50 transition-colors ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}`}>\r\n                    <div className=\"flex justify-between items-start mb-3\">\r\n                      <div>\r\n                        <h3 className=\"font-medium text-black text-base\">\r\n                          {patientInfo?.fullName || 'Không có tên'}\r\n                        </h3>\r\n                        <p className=\"text-sm text-black mt-1\">\r\n                          ID: {patientInfo?.userId || 'N/A'}\r\n                        </p>\r\n                        <p className=\"text-sm text-black mt-1\">\r\n                          SĐT: {patientInfo?.phone || 'N/A'}\r\n                        </p>\r\n                      </div>\r\n                      <div className=\"bg-gray-200 border border-gray-300 text-black px-3 py-1 rounded-full text-sm font-medium\">\r\n                        Chờ\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex justify-between items-center\">\r\n                      <span className=\"text-sm text-black flex items-center\">\r\n                        <ClockIcon size={16} className=\"mr-1.5 text-black\" />\r\n                        Thời gian chờ: <span className=\"font-medium ml-1\">{calculateWaitingTime(queue.createdAt)}</span>\r\n                      </span>\r\n                      <button \r\n                        onClick={() => handleMoveToExamination(queue._id)}\r\n                        disabled={loading}\r\n                        className={`flex items-center text-sm ${loading ? 'bg-green-400 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700'} text-white px-3.5 py-1.5 rounded-md transition-colors shadow-sm`}\r\n                      >\r\n                        Chuyển vào khám\r\n                        <MoveRightIcon size={16} className=\"ml-1.5\" />\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          ) : (\r\n            <div className=\"p-8 text-center\">\r\n              <ClockIcon size={40} className=\"mx-auto text-gray-400 mb-3\" />\r\n              <p className=\"text-black font-medium\">Không có bệnh nhân nào đang chờ</p>\r\n              <p className=\"text-sm text-black mt-1\">Hãy thêm bệnh nhân vào danh sách chờ từ màn hình Quản lý bệnh nhân</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        {/* In examination patients card */}\r\n        <div className=\"border border-gray-300 rounded-xl shadow-sm overflow-hidden bg-white\">\r\n          <div className=\"p-4 border-b border-gray-300 bg-gray-50 flex justify-between items-center\">\r\n            <div className=\"flex items-center\">\r\n              <CheckCircleIcon size={20} className=\"text-black mr-2\" />\r\n              <h2 className=\"text-lg font-semibold text-black\">Đang khám</h2>\r\n            </div>\r\n            <span className=\"bg-gray-800 text-white text-sm px-3.5 py-1 rounded-full font-medium flex items-center\">\r\n              <UserIcon size={14} className=\"mr-1.5\" />\r\n              {inProgressPatients.length} bệnh nhân\r\n            </span>\r\n          </div>\r\n          \r\n          {loading ? (\r\n            <div className=\"p-8 text-center\">\r\n              <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-gray-900 mx-auto mb-3\"></div>\r\n              <p className=\"text-black\">Đang tải dữ liệu...</p>\r\n            </div>\r\n          ) : inProgressPatients.length > 0 ? (\r\n            <div className=\"divide-y divide-gray-200\">\r\n              {inProgressPatients.map((queue, index) => {\r\n                // Lấy thông tin bệnh nhân từ đúng nguồn dữ liệu\r\n                const patientInfo = getPatientInfo(queue);\r\n                \r\n                // Lấy thông tin bác sĩ được chỉ định\r\n                const assignedDoctor = getAssignedDoctor(queue.doctorId);\r\n                \r\n                return (\r\n                  <div key={queue._id} className={`p-5 hover:bg-gray-50 transition-colors ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}`}>\r\n                    <div className=\"flex justify-between items-start mb-4\">\r\n                      <div>\r\n                        <h3 className=\"font-medium text-black text-base\">\r\n                          {patientInfo?.fullName || 'Không có tên'}\r\n                        </h3>\r\n                        <p className=\"text-sm text-black mt-1\">\r\n                          ID: {patientInfo?.userId || 'N/A'}\r\n                        </p>\r\n                        <p className=\"text-sm text-black mt-1\">\r\n                          SĐT: {patientInfo?.phone || 'N/A'}\r\n                        </p>\r\n                      </div>\r\n                      <div className=\"bg-blue-100 border border-blue-200 text-blue-800 px-3 py-1 rounded-full text-sm font-medium\">\r\n                        Đang khám\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200\">\r\n                      <div>\r\n                        <p className=\"text-xs font-medium text-black uppercase tracking-wide\">Bác sĩ khám</p>\r\n                        <p className=\"text-sm font-medium text-black mt-1\">\r\n                          {assignedDoctor ? (typeof assignedDoctor === 'object' ? assignedDoctor.fullName : assignedDoctor) : 'Chưa chỉ định'}\r\n                        </p>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"text-xs font-medium text-black uppercase tracking-wide\">Phòng khám</p>\r\n                        <p className=\"text-sm font-medium text-black mt-1\">\r\n                          {assignedDoctor ? `Phòng ${typeof assignedDoctor === 'object' ? \r\n                              (100 + parseInt(assignedDoctor._id.slice(-2), 16) % 10) : \r\n                              (100 + parseInt(String(assignedDoctor).slice(-2), 16) % 10)\r\n                            }` : 'N/A'}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    {/* Removed \"Hoàn thành khám\" button as this is now the doctor's responsibility */}\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          ) : (\r\n            <div className=\"p-8 text-center\">\r\n              <CheckCircleIcon size={40} className=\"mx-auto text-gray-400 mb-3\" />\r\n              <p className=\"text-black font-medium\">Không có bệnh nhân nào đang khám</p>\r\n              <p className=\"text-sm text-black mt-1\">Chuyển bệnh nhân từ phòng chờ vào khám</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Modal chọn bác sĩ */}\r\n      {showDoctorModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-lg shadow-xl p-6 w-full max-w-md\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h2 className=\"text-xl font-semibold text-black\">Chọn bác sĩ</h2>\r\n              <button \r\n                onClick={() => setShowDoctorModal(false)}\r\n                className=\"text-gray-500 hover:text-gray-700\"\r\n              >\r\n                <X size={20} />\r\n              </button>\r\n            </div>\r\n            \r\n            <p className=\"text-black mb-4\">Vui lòng chọn bác sĩ để chuyển bệnh nhân vào khám:</p>\r\n            \r\n            {loading ? (\r\n              <div className=\"p-8 text-center\">\r\n                <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-gray-900 mx-auto mb-3\"></div>\r\n                <p className=\"text-black\">Đang tải...</p>\r\n              </div>\r\n            ) : doctors.length > 0 ? (\r\n              <div className=\"space-y-2 max-h-60 overflow-auto\">\r\n                {doctors.map((doctor) => (\r\n                  <div \r\n                    key={doctor._id}\r\n                    onClick={() => !loading && handleConfirmMoveToExamination(doctor._id)}\r\n                    className={`p-3 border border-gray-300 rounded-md ${loading ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-50 cursor-pointer'} transition-colors flex justify-between items-center`}\r\n                  >\r\n                    <div>\r\n                      <p className=\"font-medium text-black\">{doctor.fullName}</p>\r\n                      <p className=\"text-sm text-gray-600\">{doctor.email}</p>\r\n                    </div>\r\n                    <div className=\"bg-gray-100 text-black text-xs px-2 py-1 rounded\">\r\n                      Phòng {100 + parseInt(doctor._id.slice(-2), 16) % 10}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <p className=\"text-center py-4 text-black\">Không có bác sĩ nào</p>\r\n            )}\r\n            \r\n            <div className=\"mt-6 flex justify-end\">\r\n              <button \r\n                onClick={() => setShowDoctorModal(false)}\r\n                className=\"px-4 py-2 bg-gray-200 rounded-md mr-2 text-black hover:bg-gray-300\"\r\n                disabled={loading}\r\n              >\r\n                Hủy\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 5557, "column": 0}, "map": {"version":3,"sources":["file:///D:/Codes/Projects/hospitalityWeb/hospitality-website/my-app/src/app/receptionistPage/MedicationHistory.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Search as SearchIcon, Calendar as CalendarIcon, Pill as PillIcon } from 'lucide-react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport * as apiService from '../services/api.service';\r\n\r\n// Define interfaces for the data we're working with\r\ninterface MedicationDetailDisplay {\r\n  name: string;\r\n  dosage: string;\r\n  frequency: string; // This will be derived from the dosage\r\n  duration: string;  // This will be derived from the quantity\r\n}\r\n\r\ninterface MedicationRecordDisplay {\r\n  id: string;\r\n  name: string;\r\n  patientId: string;\r\n  date: string;\r\n  originalDate?: string; // Original date string for sorting\r\n  doctor: string;\r\n  diagnosis: string;\r\n  medications: MedicationDetailDisplay[];\r\n  status?: string; // Status of the prescription\r\n}\r\n\r\ninterface MedicationHistoryProps {\r\n  onBack: () => void;\r\n}\r\n\r\nexport function MedicationHistory({ onBack }: MedicationHistoryProps) {\r\n  const [startDate, setStartDate] = useState('');\r\n  const [endDate, setEndDate] = useState('');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [medicationRecords, setMedicationRecords] = useState<MedicationRecordDisplay[]>([]);\r\n  const [allStatuses, setAllStatuses] = useState(true); // Toggle to show all statuses - default to true to show all\r\n  const [debugInfo, setDebugInfo] = useState<any>(null);\r\n  \r\n  // Pagination state\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [recordsPerPage, setRecordsPerPage] = useState(10);\r\n  \r\n  const { token } = useAuth();\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Load medication data from API\r\n  useEffect(() => {\r\n    if (!token) return;\r\n    \r\n    const initializeData = async () => {\r\n      const isTokenValid = await verifyToken();\r\n      if (!isTokenValid) return;\r\n      \r\n      if (allStatuses) {\r\n        loadAllPrescriptions();\r\n      } else {\r\n        loadDispensedPrescriptions();\r\n      }\r\n    };\r\n    \r\n    initializeData();\r\n  }, [token, allStatuses]);\r\n  \r\n  // Function to load prescriptions with DISPENSED status\r\n  const loadDispensedPrescriptions = async () => {\r\n    if (!token) return;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      // Get prescriptions with status DISPENSED from the API\r\n      console.log('MedicationHistory: Fetching DISPENSED prescriptions');\r\n      const prescriptions = await apiService.getPrescriptions({ status: 'DISPENSED' }, token);\r\n      console.log(`MedicationHistory: Found ${prescriptions.length} DISPENSED prescriptions`);\r\n      \r\n      if (prescriptions.length === 0) {\r\n        console.log('No DISPENSED prescriptions found, checking if they exist with other statuses');\r\n        const allPrescriptions = await apiService.getPrescriptions({}, token);\r\n        console.log(`Total prescriptions: ${allPrescriptions.length}`);\r\n        \r\n        // Filter them manually to see if any have DISPENSED status\r\n        const dispensedPrescriptions = allPrescriptions.filter((p: any) => p.status === 'DISPENSED');\r\n        console.log(`Manually filtered DISPENSED prescriptions: ${dispensedPrescriptions.length}`);\r\n        \r\n        if (dispensedPrescriptions.length > 0) {\r\n          console.log('Found DISPENSED prescriptions when not filtering by status, using those');\r\n          await processPrescriptions(dispensedPrescriptions);\r\n        } else {\r\n          console.log('No DISPENSED prescriptions found even in unfiltered results');\r\n          setMedicationRecords([]);\r\n        }\r\n      } else {\r\n        await processPrescriptions(prescriptions);\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Error loading dispensed medication data:\", error);\r\n      \r\n      // Handle specific error cases\r\n      if (error.response) {\r\n        if (error.response.status === 403) {\r\n          setError(\"Bạn không có quyền xem dữ liệu này. Vui lòng liên hệ với quản trị viên.\");\r\n        } else if (error.response.status === 401) {\r\n          setError(\"Phiên làm việc đã hết hạn. Vui lòng đăng nhập lại.\");\r\n        } else {\r\n          setError(`Lỗi từ máy chủ: ${error.response.status} - ${error.response.data?.message || error.message}`);\r\n        }\r\n      } else {\r\n        setError(error.message || \"Không thể tải dữ liệu lịch sử thuốc\");\r\n      }\r\n      \r\n      setMedicationRecords([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Function to load all prescriptions regardless of status\r\n  const loadAllPrescriptions = async () => {\r\n    if (!token) return;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      console.log('Loading all prescriptions regardless of status');\r\n      const prescriptions = await apiService.getPrescriptions({}, token);\r\n      console.log(`Found ${prescriptions.length} total prescriptions`);\r\n      \r\n      // Check if we have prescriptions to process\r\n      if (prescriptions.length === 0) {\r\n        console.log('No prescriptions found at all');\r\n        setMedicationRecords([]);\r\n      } else {\r\n        console.log('Processing prescription data for display');\r\n        await processPrescriptions(prescriptions);\r\n        \r\n        // Log the first few prescriptions to debug\r\n        prescriptions.slice(0, 3).forEach((prescription: any, index: number) => {\r\n          console.log(`Prescription ${index + 1}:`, {\r\n            id: prescription._id,\r\n            status: prescription.status,\r\n            patientName: prescription.patientId?.fullName || 'Unknown',\r\n            diagnosis: prescription.diagnosis\r\n          });\r\n        });\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Error loading all medication data:\", error);\r\n      \r\n      // Handle specific error cases\r\n      if (error.response) {\r\n        if (error.response.status === 403) {\r\n          setError(\"Bạn không có quyền xem dữ liệu này. Vui lòng liên hệ với quản trị viên.\");\r\n        } else if (error.response.status === 401) {\r\n          setError(\"Phiên làm việc đã hết hạn. Vui lòng đăng nhập lại.\");\r\n        } else {\r\n          setError(`Lỗi từ máy chủ: ${error.response.status} - ${error.response.data?.message || error.message}`);\r\n        }\r\n      } else {\r\n        setError(error.message || \"Không thể tải dữ liệu lịch sử thuốc\");\r\n      }\r\n      \r\n      setMedicationRecords([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  // Common function to process prescriptions data\r\n  const processPrescriptions = async (prescriptions: any[]) => {\r\n    try {\r\n      console.log(`Processing ${prescriptions.length} prescriptions`);\r\n      \r\n      // Sort prescriptions by newest first - using createdAt field if available, or date\r\n      const sortedPrescriptions = [...prescriptions].sort((a, b) => {\r\n        // Use createdAt if available, otherwise fall back to date field\r\n        const dateA = a.createdAt ? new Date(a.createdAt) : new Date(a.date);\r\n        const dateB = b.createdAt ? new Date(b.createdAt) : new Date(b.date);\r\n        \r\n        // Sort in descending order (newest first)\r\n        return dateB.getTime() - dateA.getTime();\r\n      });\r\n      \r\n      console.log('Sorted prescriptions by newest first');\r\n      \r\n      // Transform prescriptions to the format we need for display\r\n      const records: MedicationRecordDisplay[] = [];\r\n      \r\n      for (const prescription of sortedPrescriptions) {\r\n        try {\r\n          // Verify that the prescription object is valid\r\n          if (!prescription || !prescription._id) {\r\n            console.error('Invalid prescription object:', prescription);\r\n            continue;\r\n          }\r\n          \r\n          // Get prescription details (medicines)\r\n          console.log(`MedicationHistory: Fetching details for prescription ${prescription._id}`);\r\n          \r\n          // Fix for TypeScript errors - ensure token is not null\r\n          if (!token) {\r\n            console.error('Token is null, cannot fetch prescription details');\r\n            continue;\r\n          }\r\n          \r\n          // Add error handling for prescription details with detailed logging\r\n          let prescriptionDetails = [];\r\n          try {\r\n            console.log(`Calling getPrescriptionDetails API for prescriptionId: ${prescription._id}`);\r\n            prescriptionDetails = await apiService.getPrescriptionDetails(prescription._id, token);\r\n            console.log(`Got ${prescriptionDetails.length} medication details for prescription ${prescription._id}`, prescriptionDetails);\r\n            \r\n            // Log the first detail if available for debugging\r\n            if (prescriptionDetails.length > 0) {\r\n              console.log('First prescription detail:', prescriptionDetails[0]);\r\n            }\r\n          } catch (detailsError: any) {\r\n            console.error(`Error fetching details for prescription ${prescription._id}:`, detailsError);\r\n            if (detailsError.response) {\r\n              console.error('Details error status:', detailsError.response.status);\r\n              console.error('Details error data:', detailsError.response.data);\r\n            }\r\n            // Try a direct fetch as a backup\r\n            try {\r\n              const url = `http://localhost:5000/api/prescriptiondetails?prescriptionId=${prescription._id}`;\r\n              console.log(`Trying direct fetch to: ${url}`);\r\n              const response = await fetch(url, {\r\n                headers: {\r\n                  'Authorization': `Bearer ${token}`,\r\n                  'Content-Type': 'application/json'\r\n                }\r\n              });\r\n              \r\n              if (!response.ok) {\r\n                console.error(`Direct fetch error: ${response.status}`);\r\n              } else {\r\n                prescriptionDetails = await response.json();\r\n                console.log(`Direct fetch success: Got ${prescriptionDetails.length} details`);\r\n              }\r\n            } catch (directError) {\r\n              console.error('Direct fetch also failed:', directError);\r\n            }\r\n          }\r\n          \r\n          // Transform prescription details to medication details\r\n          const medications: MedicationDetailDisplay[] = [];\r\n          \r\n          console.log(`Processing ${prescriptionDetails.length} medication details for prescription ${prescription._id}`);\r\n          \r\n          // For each medicine in the prescription\r\n          for (const detail of prescriptionDetails) {\r\n            try {\r\n              console.log('Processing prescription detail:', detail);\r\n              \r\n              // Get medicine details if medicineId is an object with _id\r\n              let medicineId;\r\n              if (detail.medicineId) {\r\n                medicineId = typeof detail.medicineId === 'object' ? \r\n                  (detail.medicineId._id || detail.medicineId.id) : detail.medicineId;\r\n              } else {\r\n                console.error('Missing medicineId in prescription detail:', detail);\r\n                continue;\r\n              }\r\n              \r\n              console.log(`Extracted medicineId: ${medicineId}`);\r\n              \r\n              // Fix for TypeScript errors - ensure token is not null\r\n              if (!token) {\r\n                console.error('Token is null, cannot fetch medicine details');\r\n                continue;\r\n              }\r\n              \r\n              let medicine = null;\r\n              \r\n              // Check if medicineId is already populated\r\n              if (detail.medicineId && typeof detail.medicineId === 'object') {\r\n                medicine = detail.medicineId;\r\n                console.log(`Medicine already populated: ${JSON.stringify(medicine)}`);\r\n                console.log(`Medicine name from populated object: ${medicine.name}`);\r\n              } else {\r\n                try {\r\n                  console.log(`Fetching medicine details for ID: ${medicineId}`);\r\n                  medicine = await apiService.getMedicineById(medicineId, token);\r\n                  console.log(`Successfully fetched medicine: ${medicine.name}`);\r\n                } catch (medicineError) {\r\n                  console.error(`Error fetching medicine ${medicineId}:`, medicineError);\r\n                }\r\n              }\r\n              \r\n              // Parse dosage to extract frequency and duration (with error handling)\r\n              let frequency = 'Không có thông tin';\r\n              try {\r\n                if (detail.dosage) {\r\n                  const dosageInfo = detail.dosage.split(' ');\r\n                  frequency = dosageInfo.length > 0 ? dosageInfo.join(' ') : 'Không có thông tin';\r\n                }\r\n              } catch (parseError) {\r\n                console.error('Error parsing dosage:', parseError);\r\n              }\r\n              \r\n              // Calculate duration based on quantity and dosage (with error handling)\r\n              let duration = 'Không xác định';\r\n              try {\r\n                if (detail.dosage && detail.quantity) {\r\n                  const dosageInfo = detail.dosage.split(' ');\r\n                  const firstNumberInDosage = parseInt(dosageInfo[0]);\r\n                  if (!isNaN(firstNumberInDosage) && firstNumberInDosage > 0) {\r\n                    duration = `${Math.round(detail.quantity / firstNumberInDosage)} ngày`;\r\n                  }\r\n                }\r\n              } catch (durationError) {\r\n                console.error('Error calculating duration:', durationError);\r\n              }\r\n              \r\n              medications.push({\r\n                name: medicine?.name || 'Không xác định thuốc',\r\n                dosage: detail.dosage || 'Không xác định liều lượng',\r\n                frequency: frequency,\r\n                duration: duration\r\n              });\r\n            } catch (medErr) {\r\n              console.error(`Error processing medicine details for ${detail.medicineId}:`, medErr);\r\n              medications.push({\r\n                name: 'Lỗi dữ liệu thuốc',\r\n                dosage: 'Không xác định',\r\n                frequency: 'Không xác định',\r\n                duration: 'Không xác định'\r\n              });\r\n            }\r\n          }\r\n          \r\n          // Format date for display (with error handling)\r\n          let formattedDate = 'Không xác định';\r\n          let originalDate; // Store the original date for sorting\r\n          try {\r\n            const dateObj = new Date(prescription.date);\r\n            originalDate = dateObj;\r\n            if (!isNaN(dateObj.getTime())) {\r\n              formattedDate = `${dateObj.getDate().toString().padStart(2, '0')}/${(dateObj.getMonth() + 1).toString().padStart(2, '0')}/${dateObj.getFullYear()}`;\r\n            }\r\n          } catch (dateError) {\r\n            console.error('Error formatting date:', dateError);\r\n          }\r\n          \r\n          // Get patient and doctor info directly from populated fields if available (with error handling)\r\n          let patient = { fullName: 'Không xác định', _id: 'Unknown' };\r\n          let doctor = { fullName: 'Không xác định' };\r\n          \r\n          try {\r\n            if (prescription.patientId && typeof prescription.patientId === 'object') {\r\n              patient = prescription.patientId;\r\n            }\r\n          } catch (patientError) {\r\n            console.error('Error processing patient info:', patientError);\r\n          }\r\n          \r\n          try {\r\n            if (prescription.doctorId && typeof prescription.doctorId === 'object') {\r\n              doctor = prescription.doctorId;\r\n            }\r\n          } catch (doctorError) {\r\n            console.error('Error processing doctor info:', doctorError);\r\n          }\r\n          \r\n          // Create the record with proper error handling for all fields\r\n          const record: MedicationRecordDisplay = {\r\n            id: prescription._id || 'unknown',\r\n            name: patient.fullName || 'Không xác định',\r\n            patientId: patient._id || 'Unknown',\r\n            date: formattedDate,\r\n            originalDate: prescription.createdAt || prescription.date, // Store original date for sorting\r\n            doctor: doctor.fullName || 'Không xác định',\r\n            diagnosis: prescription.diagnosis || 'Không có chẩn đoán',\r\n            medications: medications,\r\n            status: prescription.status || 'Unknown' // Add status to the record\r\n          };\r\n          \r\n          records.push(record);\r\n          console.log(`Added record for patient ${record.name} with ${medications.length} medications`);\r\n          \r\n        } catch (prescErr) {\r\n          console.error(`Error processing prescription ${prescription?._id || 'unknown'}:`, prescErr);\r\n        }\r\n      }\r\n      \r\n      console.log(`Finished processing ${records.length} records out of ${prescriptions.length} prescriptions`);\r\n      \r\n      // Reset to first page when data changes\r\n      setCurrentPage(1);\r\n      setMedicationRecords(records);\r\n      setError(null);\r\n    } catch (error: any) {\r\n      console.error(\"Error processing prescriptions:\", error);\r\n      setError(\"Lỗi xử lý dữ liệu đơn thuốc: \" + (error.message || error));\r\n    }\r\n  };\r\n  \r\n  // Add debug function to show available data\r\n  const debugMedicationData = async () => {\r\n    if (!token) {\r\n      setError(\"Bạn chưa đăng nhập. Vui lòng đăng nhập để xem dữ liệu.\");\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      console.log('Debug: Checking token validity');\r\n      const tokenStatus = await apiService.validateToken(token);\r\n      \r\n      if (!tokenStatus.valid) {\r\n        console.error('Debug: Token is invalid:', tokenStatus.reason);\r\n        setError(\"Phiên làm việc đã hết hạn. Vui lòng đăng nhập lại.\");\r\n        return;\r\n      }\r\n      \r\n      console.log('Debug: Token is valid, user role:', tokenStatus.data?.role);\r\n      console.log('Debug: Token data object:', tokenStatus.data);\r\n      \r\n      // Show the user's information - this is helpful for debugging permission issues\r\n      console.log('Debug: User details:', {\r\n        id: tokenStatus.data?._id,\r\n        username: tokenStatus.data?.username,\r\n        role: tokenStatus.data?.role,\r\n      });\r\n      \r\n      // Manually test API access with a direct fetch - bypassing any frontend caching or filtering\r\n      console.log('Debug: Making direct fetch to prescriptions API with DISPENSED filter');\r\n      try {\r\n        const url = 'http://localhost:5000/api/prescriptions?status=DISPENSED';\r\n        const response = await fetch(url, {\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`,\r\n            'Content-Type': 'application/json'\r\n          }\r\n        });\r\n        \r\n        console.log('Debug: Direct fetch status:', response.status);\r\n        if (!response.ok) {\r\n          console.error('Debug: Direct fetch error:', await response.text());\r\n        } else {\r\n          const data = await response.json();\r\n          console.log(`Debug: Direct fetch found ${data.length} DISPENSED prescriptions`);\r\n          if (data.length > 0) {\r\n            console.log('Debug: First direct fetch result:', data[0]);\r\n          }\r\n        }\r\n      } catch (directFetchError) {\r\n        console.error('Debug: Direct fetch error:', directFetchError);\r\n      }\r\n      \r\n      console.log('Debug: Fetching all prescriptions to see available statuses');\r\n      \r\n      const allPrescriptions = await apiService.getPrescriptions({}, token);\r\n      \r\n      console.log('Debug: First 3 prescriptions raw data:', allPrescriptions.slice(0, 3));\r\n      \r\n      // Group by status to see what we have\r\n      const statusCounts: Record<string, number> = {};\r\n      allPrescriptions.forEach((prescription: any) => {\r\n        const status = prescription.status || 'unknown';\r\n        statusCounts[status] = (statusCounts[status] || 0) + 1;\r\n      });\r\n      \r\n      console.log('Debug: Available prescription statuses:', statusCounts);\r\n      setDebugInfo({\r\n        statusCounts,\r\n        totalPrescriptions: allPrescriptions.length,\r\n        firstPrescription: allPrescriptions.length > 0 ? allPrescriptions[0] : null,\r\n        userRole: tokenStatus.data?.role,\r\n        userId: tokenStatus.data?._id,\r\n      });\r\n      \r\n      // Check if we have any 'DISPENSED' prescriptions\r\n      if (statusCounts['DISPENSED'] && statusCounts['DISPENSED'] > 0) {\r\n        console.log('Debug: We have DISPENSED prescriptions, should be showing them');\r\n        \r\n        // Let's check those DISPENSED prescriptions\r\n        const dispensedPrescriptions = allPrescriptions.filter((p: any) => p.status === 'DISPENSED');\r\n        console.log('Debug: First DISPENSED prescription:', dispensedPrescriptions[0]);\r\n        \r\n        // Check why it's not showing up in the main view\r\n        console.log('Debug: Testing specific API call for DISPENSED prescriptions');\r\n        const specificDispensedPrescriptions = await apiService.getPrescriptions({ status: 'DISPENSED' }, token);\r\n        console.log(`Debug: API call found ${specificDispensedPrescriptions.length} DISPENSED prescriptions`);\r\n      } else {\r\n        console.log('Debug: No DISPENSED prescriptions found, this is why no data appears');\r\n        \r\n        // Let's try to manually search for a few other statuses\r\n        const tryOtherStatuses = async () => {\r\n          try {\r\n            console.log('Debug: Trying with status=PENDING_DISPENSE');\r\n            const pendingPrescriptions = await apiService.getPrescriptions({ status: 'PENDING_DISPENSE' }, token);\r\n            console.log(`Debug: Found ${pendingPrescriptions.length} PENDING_DISPENSE prescriptions`);\r\n            \r\n            if (pendingPrescriptions.length > 0) {\r\n              console.log('Debug: Example PENDING_DISPENSE prescription:', pendingPrescriptions[0]);\r\n            }\r\n            \r\n            // Check the specific prescription you mentioned by ID\r\n            const specificId = '68614f3d994cbb5f5a751225';\r\n            console.log(`Debug: Checking for specific prescription with ID ${specificId}`);\r\n            try {\r\n              const specificPrescription = await apiService.getPrescriptionById(specificId, token);\r\n              console.log('Debug: Found specific prescription:', specificPrescription);\r\n              console.log('Debug: Status of specific prescription:', specificPrescription?.status);\r\n            } catch (err) {\r\n              console.error(`Debug: Error fetching specific prescription ${specificId}:`, err);\r\n            }\r\n          } catch (err) {\r\n            console.error('Debug: Error fetching PENDING_DISPENSE prescriptions', err);\r\n          }\r\n        };\r\n        \r\n        tryOtherStatuses();\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error('Debug: Error fetching all prescriptions:', error);\r\n    }\r\n  };\r\n  \r\n  // Call debug function when component loads\r\n  useEffect(() => {\r\n    if (token) {\r\n      // Instead of calling debugMedicationData directly, try to load the data properly first\r\n      const initializeData = async () => {\r\n        try {\r\n          console.log('Component mounted, verifying token and loading data');\r\n          const isTokenValid = await verifyToken();\r\n          \r\n          if (isTokenValid) {\r\n            // Try to load prescriptions\r\n            if (allStatuses) {\r\n              await loadAllPrescriptions();\r\n            } else {\r\n              await loadDispensedPrescriptions();\r\n            }\r\n            \r\n            // If no medication records were loaded, try the debug function\r\n            if (medicationRecords.length === 0) {\r\n              console.log('No medication records loaded, running debug function');\r\n              await debugMedicationData();\r\n            }\r\n          }\r\n        } catch (err) {\r\n          console.error('Error during initialization:', err);\r\n        }\r\n      };\r\n      \r\n      initializeData();\r\n    }\r\n  }, [token]);\r\n  \r\n  // Function to verify token is valid\r\n  const verifyToken = async () => {\r\n    if (!token) {\r\n      setError(\"Bạn chưa đăng nhập hoặc phiên làm việc đã hết hạn\");\r\n      return false;\r\n    }\r\n    \r\n    try {\r\n      // Verify token is valid using validateToken function\r\n      console.log('Verifying token validity...');\r\n      const tokenStatus = await apiService.validateToken(token);\r\n      \r\n      if (!tokenStatus.valid) {\r\n        console.error('Token is invalid:', tokenStatus.reason);\r\n        setError(\"Phiên làm việc đã hết hạn. Vui lòng đăng nhập lại.\");\r\n        return false;\r\n      }\r\n      \r\n      console.log('Token is valid, checking permissions...');\r\n      \r\n      // Check if user has specific role with permissions\r\n      if (tokenStatus.data && tokenStatus.data.role) {\r\n        console.log('User role:', tokenStatus.data.role);\r\n        \r\n        // Check specific role permissions for viewing prescriptions\r\n        if (!['ADMIN', 'RECEPTIONIST', 'PHARMACIST', 'DOCTOR'].includes(tokenStatus.data.role)) {\r\n          console.error('User role does not have permission:', tokenStatus.data.role);\r\n          setError(\"Bạn không có quyền xem lịch sử thuốc\");\r\n          return false;\r\n        }\r\n      }\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error verifying token:', error);\r\n      setError(\"Không thể xác thực phiên làm việc. Vui lòng đăng nhập lại.\");\r\n      return false;\r\n    }\r\n  };\r\n  \r\n  // Filter medications based on search term and date range\r\n  const filteredMedications = medicationRecords.filter(record => {\r\n    // Filter by search term\r\n    const matchesSearch = \r\n      record.name.toLowerCase().includes(searchTerm.toLowerCase()) || \r\n      (record.patientId && record.patientId.toLowerCase().includes(searchTerm.toLowerCase()));\r\n    \r\n    // Filter by date range if applicable\r\n    let matchesDateRange = true;\r\n    if (startDate && endDate) {\r\n      let recordDate;\r\n      try {\r\n        // Try to parse the date from the formatted string (DD/MM/YYYY format)\r\n        recordDate = new Date(record.date.split('/').reverse().join('-'));\r\n      } catch {\r\n        // If that fails, use the original date field if available\r\n        recordDate = record.originalDate ? new Date(record.originalDate) : new Date();\r\n      }\r\n      const start = new Date(startDate);\r\n      const end = new Date(endDate);\r\n      // Add one day to end date to include the end date in results\r\n      end.setDate(end.getDate() + 1);\r\n      matchesDateRange = recordDate >= start && recordDate <= end;\r\n    }\r\n    \r\n    return matchesSearch && matchesDateRange;\r\n  });\r\n  \r\n  // Function to show a prescription from the debug data\r\n  const showDebugPrescription = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      // Create a set of mock prescriptions to demonstrate pagination\r\n      const mockPrescriptions = [];\r\n      const baseDate = new Date(\"2024-06-01T10:00:00.000Z\");\r\n      \r\n      // Create 15 mock prescriptions with different dates to show pagination\r\n      for (let i = 0; i < 15; i++) {\r\n        const mockDate = new Date(baseDate);\r\n        mockDate.setDate(baseDate.getDate() - i); // Each record is a day older\r\n        \r\n        mockPrescriptions.push({\r\n          _id: `debug-prescription-${i+1}`,\r\n          customPrescriptionId: `pr${i+1}`,\r\n          patientId: {\r\n            _id: `patient-${i+1}`,\r\n            username: \"nguyen.an\",\r\n            email: \"an.nguyen@mediclinic.com\",\r\n            fullName: `Bệnh nhân mẫu ${i+1}`,\r\n            phone: \"0901234567\"\r\n          },\r\n          doctorId: {\r\n            _id: \"doctor-1\",\r\n            username: \"tran.hoa\",\r\n            email: \"hoa.tran@mediclinic.com\",\r\n            fullName: \"Trần Thị Hoa\",\r\n            phone: \"0912345678\"\r\n          },\r\n          diagnosis: i % 3 === 0 ? \"Cảm cúm\" : (i % 3 === 1 ? \"Đau họng\" : \"Đau đầu\"),\r\n          date: mockDate.toISOString(),\r\n          status: \"DISPENSED\",\r\n          createdAt: mockDate.toISOString(),\r\n          updatedAt: mockDate.toISOString()\r\n        });\r\n      }\r\n      \r\n      // Process the mock prescriptions to create records\r\n      console.log('Using mock prescription data for debugging pagination');\r\n      \r\n      const records: MedicationRecordDisplay[] = mockPrescriptions.map((mockPrescription, index) => {\r\n        // Generate 1-3 mock medications for each prescription\r\n        const medicationCount = (index % 3) + 1;\r\n        const mockMedications: MedicationDetailDisplay[] = [];\r\n        \r\n        for (let j = 0; j < medicationCount; j++) {\r\n          const medicationTypes = [\r\n            {\r\n              name: 'Paracetamol',\r\n              dosage: '2 viên x 3 lần/ngày',\r\n              frequency: '3 lần/ngày',\r\n              duration: '5 ngày'\r\n            },\r\n            {\r\n              name: 'Vitamin C',\r\n              dosage: '1 viên x 2 lần/ngày',\r\n              frequency: '2 lần/ngày',\r\n              duration: '7 ngày'\r\n            },\r\n            {\r\n              name: 'Amoxicillin',\r\n              dosage: '1 viên x 3 lần/ngày',\r\n              frequency: '3 lần/ngày',\r\n              duration: '5 ngày'\r\n            }\r\n          ];\r\n          \r\n          mockMedications.push(medicationTypes[j % 3]);\r\n        }\r\n        \r\n        const formattedDate = new Date(mockPrescription.date).toLocaleDateString('vi-VN');\r\n        \r\n        return {\r\n          id: mockPrescription._id,\r\n          name: mockPrescription.patientId.fullName,\r\n          patientId: mockPrescription.patientId._id,\r\n          date: formattedDate,\r\n          originalDate: mockPrescription.createdAt,\r\n          doctor: mockPrescription.doctorId.fullName,\r\n          diagnosis: mockPrescription.diagnosis,\r\n          medications: mockMedications,\r\n          status: mockPrescription.status\r\n        };\r\n      });\r\n      \r\n      // Sort the records by newest first\r\n      records.sort((a, b) => {\r\n        const dateA = new Date(a.originalDate || a.date);\r\n        const dateB = new Date(b.originalDate || b.date);\r\n        return dateB.getTime() - dateA.getTime();\r\n      });\r\n      \r\n      // Set the medication records directly\r\n      setMedicationRecords(records);\r\n      console.log(`Set ${records.length} mock medication records for pagination testing`);\r\n    } catch (err) {\r\n      console.error('Error creating mock records:', err);\r\n      setError('Lỗi khi tạo dữ liệu mẫu');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  // Pagination logic\r\n  const indexOfLastRecord = currentPage * recordsPerPage;\r\n  const indexOfFirstRecord = indexOfLastRecord - recordsPerPage;\r\n  const currentRecords = filteredMedications.slice(indexOfFirstRecord, indexOfLastRecord);\r\n  const totalPages = Math.ceil(filteredMedications.length / recordsPerPage);\r\n  \r\n  return (\r\n    <div className=\"max-w-7xl mx-auto\">\r\n      <div className=\"flex items-center mb-4\">\r\n        <button \r\n          onClick={onBack}\r\n          className=\"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-md flex items-center text-gray-700\"\r\n        >\r\n          ← Quay lại\r\n        </button>\r\n      </div>\r\n      {/* Header section */}\r\n      <div className=\"mb-8 border-b border-gray-200 pb-5 flex justify-between items-center flex-wrap gap-3\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 tracking-tight\">Lịch sử thuốc</h1>\r\n          <p className=\"text-gray-600 mt-2 flex items-center\">\r\n            Xem lịch sử thuốc đã kê cho bệnh nhân\r\n            <span className=\"ml-2 inline-flex items-center text-sm bg-blue-100 text-blue-800 px-2 py-0.5 rounded\">\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" className=\"w-4 h-4 mr-1\">\r\n                <path fillRule=\"evenodd\" d=\"M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n              Mới nhất lên đầu\r\n            </span>\r\n          </p>\r\n        </div>\r\n        <div className=\"flex gap-3 items-center flex-wrap\">\r\n          <span className=\"text-sm text-gray-600\">\r\n            {filteredMedications.length} kết quả ({recordsPerPage} mỗi trang)\r\n          </span>\r\n          <button\r\n            onClick={() => setAllStatuses(!allStatuses)}\r\n            className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${\r\n              allStatuses \r\n                ? 'bg-blue-600 text-white hover:bg-blue-700' \r\n                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\r\n            }`}\r\n          >\r\n            {allStatuses ? 'Chỉ hiển thị đã phát thuốc' : 'Hiển thị tất cả đơn thuốc'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Main content container */}\r\n      <div className=\"border border-gray-300 rounded-xl shadow-sm overflow-hidden bg-white\">\r\n        {/* Search and date pickers */}\r\n        <div className=\"p-6 border-b border-gray-300 bg-white\">\r\n          <div className=\"flex flex-col md:flex-row md:items-end md:justify-between gap-4\">\r\n            <div className=\"relative flex-1\">\r\n              <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                <SearchIcon size={18} className=\"text-black\" />\r\n              </div>\r\n              <input \r\n                type=\"text\" \r\n                placeholder=\"Tìm theo TÊN hoặc ID...\" \r\n                className=\"pl-10 pr-4 py-3 border border-gray-300 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-black focus:border-black shadow-sm transition-all text-black placeholder-gray-500\" \r\n                value={searchTerm} \r\n                onChange={e => setSearchTerm(e.target.value)} \r\n              />\r\n            </div>\r\n            \r\n            <div className=\"flex flex-col md:flex-row gap-3\">\r\n              <div className=\"flex flex-col\">\r\n                <label htmlFor=\"start-date\" className=\"block text-sm font-medium text-black mb-1 pl-1\">Từ ngày</label>\r\n                <div className=\"relative\">\r\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                    <CalendarIcon size={16} className=\"text-black\" />\r\n                  </div>\r\n                  <input\r\n                    id=\"start-date\"\r\n                    type=\"date\"\r\n                    className=\"pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-black shadow-sm transition-all text-black\"\r\n                    value={startDate}\r\n                    onChange={e => setStartDate(e.target.value)}\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"flex flex-col\">\r\n                <label htmlFor=\"end-date\" className=\"block text-sm font-medium text-black mb-1 pl-1\">Đến ngày</label>\r\n                <div className=\"relative\">\r\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                    <CalendarIcon size={16} className=\"text-black\" />\r\n                  </div>\r\n                  <input\r\n                    id=\"end-date\"\r\n                    type=\"date\"\r\n                    className=\"pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-black shadow-sm transition-all text-black\"\r\n                    value={endDate}\r\n                    onChange={e => setEndDate(e.target.value)}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Records content */}\r\n        <div className=\"p-6\">\r\n          {loading ? (\r\n            <div className=\"text-center py-16 border border-dashed border-gray-300 rounded-lg\">\r\n              <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n              <h3 className=\"text-lg font-medium text-gray-700\">\r\n                Đang tải dữ liệu...\r\n              </h3>\r\n              <p className=\"text-gray-500 mt-2\">\r\n                Vui lòng đợi trong khi chúng tôi tải dữ liệu từ máy chủ\r\n              </p>\r\n            </div>\r\n          ) : error ? (\r\n            <div className=\"text-center py-16 border border-dashed border-gray-300 rounded-lg\">\r\n              <div className=\"mx-auto flex items-center justify-center w-12 h-12 rounded-full bg-red-100 mb-4\">\r\n                <PillIcon size={24} className=\"text-red-600\" />\r\n              </div>\r\n              <h3 className=\"text-lg font-medium text-gray-700\">\r\n                Không thể tải dữ liệu\r\n              </h3>\r\n              <p className=\"text-gray-500 mt-2 max-w-md mx-auto\">\r\n                {error}\r\n              </p>                \r\n              <div className=\"flex flex-col sm:flex-row gap-3 justify-center mt-4 flex-wrap\">\r\n                <button \r\n                  onClick={() => window.location.reload()}\r\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\r\n                >\r\n                  Thử lại\r\n                </button>\r\n                \r\n                <button \r\n                  onClick={verifyToken}\r\n                  className=\"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors\"\r\n                >\r\n                  Kiểm tra quyền truy cập\r\n                </button>\r\n                \r\n                <button \r\n                  onClick={showDebugPrescription}\r\n                  className=\"px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 transition-colors\"\r\n                >\r\n                  Dùng dữ liệu mẫu\r\n                </button>\r\n              </div>\r\n              \r\n              <div className=\"mt-6 text-sm text-gray-500\">\r\n                <p><b>Gợi ý khắc phục:</b></p>\r\n                <ul className=\"list-disc pl-8 mt-2 text-left max-w-lg mx-auto\">\r\n                  <li>Hãy chắc chắn bạn đã đăng nhập với tài khoản có quyền RECEPTIONIST</li>\r\n                  <li>Đảm bảo backend đã được cấu hình cho phép RECEPTIONIST xem đơn thuốc</li>\r\n                  <li>Kiểm tra kết nối mạng đến server API</li>\r\n                  <li>Nếu vẫn gặp vấn đề, hãy liên hệ quản trị viên</li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n          ) : currentRecords.length > 0 ? (\r\n            <div className=\"space-y-6\">\r\n              {currentRecords.map(record => (\r\n                <div key={record.id} className=\"border border-gray-300 rounded-lg overflow-hidden shadow-sm transition-all hover:shadow-md\">\r\n                  <div className=\"border-b border-gray-300 bg-gradient-to-r from-gray-50 to-white p-5 flex flex-col md:flex-row md:justify-between md:items-center gap-3\">\r\n                    <div>\r\n                      <h3 className=\"font-semibold text-lg text-gray-900\">\r\n                        {record.name}\r\n                      </h3>\r\n                      <p className=\"text-sm text-gray-700 mt-0.5\">\r\n                        ID: {record.patientId}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-6\">\r\n                      <div>\r\n                        <p className=\"text-xs text-gray-600 uppercase tracking-wide font-medium\">Ngày khám</p>\r\n                        <p className=\"text-sm font-medium text-gray-800 mt-1\">{record.date}</p>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"text-xs text-gray-600 uppercase tracking-wide font-medium\">Bác sĩ</p>\r\n                        <p className=\"text-sm font-medium text-gray-800 mt-1\">{record.doctor}</p>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"text-xs text-gray-600 uppercase tracking-wide font-medium\">Chẩn đoán</p>\r\n                        <p className=\"text-sm font-medium text-gray-800 mt-1\">{record.diagnosis}</p>\r\n                      </div>\r\n                      {record.status && (\r\n                        <div>\r\n                          <p className=\"text-xs text-gray-600 uppercase tracking-wide font-medium\">Trạng thái</p>\r\n                          <p className={`text-sm font-medium mt-1 px-2 py-0.5 rounded inline-block ${\r\n                            record.status === 'DISPENSED' \r\n                              ? 'bg-green-100 text-green-800' \r\n                              : record.status === 'PENDING_DISPENSE' \r\n                                ? 'bg-yellow-100 text-yellow-800'\r\n                                : 'bg-red-100 text-red-800'\r\n                          }`}>\r\n                            {record.status === 'DISPENSED' \r\n                              ? 'Đã phát thuốc' \r\n                              : record.status === 'PENDING_DISPENSE' \r\n                                ? 'Chờ phát thuốc' \r\n                                : 'Đã hủy'\r\n                            }\r\n                          </p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"p-5\">\r\n                    <h4 className=\"font-medium text-gray-900 mb-4 flex items-center\">\r\n                      <PillIcon size={18} className=\"mr-2 text-indigo-600\" />\r\n                      Danh sách thuốc\r\n                    </h4>\r\n                    <div className=\"overflow-x-auto rounded-lg border border-gray-300\">\r\n                      <table className=\"min-w-full divide-y divide-gray-300\">\r\n                        <thead className=\"bg-gray-50\">\r\n                          <tr>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b\">\r\n                              Tên thuốc\r\n                            </th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b\">\r\n                              Liều lượng\r\n                            </th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b\">\r\n                              Tần suất\r\n                            </th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b\">\r\n                              Thời gian dùng\r\n                            </th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody className=\"bg-white divide-y divide-gray-300\">\r\n                          {record.medications.map((med, index) => (\r\n                            <tr key={index} className=\"hover:bg-gray-50 transition-colors\">\r\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                                {med.name}\r\n                              </td>\r\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-700\">\r\n                                {med.dosage}\r\n                              </td>\r\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-700\">\r\n                                {med.frequency}\r\n                              </td>\r\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-700\">\r\n                                {med.duration}\r\n                              </td>\r\n                            </tr>\r\n                          ))}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center py-16 border border-dashed border-gray-300 rounded-lg\">\r\n              <PillIcon size={48} className=\"mx-auto text-gray-400 mb-4\" />\r\n              <h3 className=\"text-lg font-medium text-gray-700\">\r\n                {allStatuses ? 'Không tìm thấy đơn thuốc nào' : 'Không tìm thấy đơn thuốc đã phát'}\r\n              </h3>\r\n              <p className=\"text-gray-500 mt-2 max-w-md mx-auto\">\r\n                {allStatuses \r\n                  ? 'Không có đơn thuốc nào trong hệ thống' \r\n                  : 'Không có đơn thuốc nào ở trạng thái đã phát (DISPENSED) trong hệ thống.'}\r\n              </p>\r\n              \r\n              <div className=\"mt-6 flex flex-col sm:flex-row gap-4 justify-center flex-wrap\">\r\n                <button \r\n                  onClick={debugMedicationData}\r\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors\"\r\n                >\r\n                  Kiểm tra trạng thái đơn thuốc\r\n                </button>\r\n                \r\n                {!allStatuses && (\r\n                  <button \r\n                    onClick={() => setAllStatuses(true)}\r\n                    className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors\"\r\n                  >\r\n                    Hiển thị tất cả đơn thuốc\r\n                  </button>\r\n                )}\r\n                \r\n                <button \r\n                  onClick={async () => {\r\n                    try {\r\n                      setLoading(true);\r\n                      // Try multiple IDs if needed\r\n                      const specificIds = [\r\n                        '68614f3d994cbb5f5a751225', // Your specific ID\r\n                        '685face23fc4c04e1bd96c13'  // First prescription from debug data\r\n                      ];\r\n                      \r\n                      // Try each ID until one works\r\n                      for (const id of specificIds) {\r\n                        try {\r\n                          console.log(`Checking specific prescription: ${id}`);\r\n                          const prescription = await apiService.getPrescriptionById(id, token || '');\r\n                          \r\n                          if (prescription) {\r\n                            console.log(`Found prescription with ID ${id}:`, prescription);\r\n                            console.log(`Status: ${prescription.status}`);\r\n                            \r\n                            // Process and display this single prescription\r\n                            await processPrescriptions([prescription]);\r\n                            setLoading(false);\r\n                            setError(null);\r\n                            return; // Exit the loop if successful\r\n                          }\r\n                        } catch (idError) {\r\n                          console.error(`Error fetching prescription with ID ${id}:`, idError);\r\n                          // Continue to next ID\r\n                        }\r\n                      }\r\n                      \r\n                      // If we get here, none of the IDs worked\r\n                      console.error('Could not find any specific prescriptions');\r\n                      setError(`Không thể tìm thấy đơn thuốc cụ thể. Hãy kiểm tra lại ID hoặc quyền truy cập.`);\r\n                      setLoading(false);\r\n                    } catch (err: any) {\r\n                      console.error('Error in specific prescription check:', err);\r\n                      setError(`Lỗi khi tìm đơn thuốc cụ thể: ${err.message || err}`);\r\n                      setLoading(false);\r\n                    }\r\n                  }}\r\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors\"\r\n                >\r\n                  Kiểm tra đơn thuốc cụ thể\r\n                </button>\r\n                \r\n                <button \r\n                  onClick={showDebugPrescription}\r\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors\"\r\n                >\r\n                  Hiển thị dữ liệu từ debug\r\n                </button>\r\n              </div>\r\n              \r\n              <div className=\"mt-4 text-sm text-gray-500\">\r\n                <p>Trạng thái đơn thuốc hợp lệ:</p>\r\n                <ul className=\"mt-2 inline-flex flex-wrap gap-2 justify-center\">\r\n                  <li className=\"px-2 py-1 bg-yellow-100 text-yellow-800 rounded-md\">PENDING_DISPENSE</li>\r\n                  <li className=\"px-2 py-1 bg-green-100 text-green-800 rounded-md\">DISPENSED</li>\r\n                  <li className=\"px-2 py-1 bg-red-100 text-red-800 rounded-md\">CANCELLED</li>\r\n                </ul>\r\n                \r\n                {debugInfo && (\r\n                  <div className=\"mt-6 p-4 border border-dashed border-gray-300 rounded-lg bg-gray-50 text-left overflow-auto\">\r\n                    <h4 className=\"font-medium mb-2 text-gray-800\">Debug Information:</h4>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                      <div>\r\n                        <p><b>User Role:</b> {debugInfo.userRole || 'Unknown'}</p>\r\n                        <p><b>User ID:</b> {debugInfo.userId || 'Unknown'}</p>\r\n                        <p><b>Total Prescriptions:</b> {debugInfo.totalPrescriptions || 0}</p>\r\n                      </div>\r\n                      <div>\r\n                        <p><b>Status Counts:</b></p>\r\n                        <ul className=\"list-disc pl-5\">\r\n                          {debugInfo.statusCounts && Object.entries(debugInfo.statusCounts).map(([status, count]) => (\r\n                            <li key={status}>{status}: {String(count)}</li>\r\n                          ))}\r\n                        </ul>\r\n                      </div>\r\n                    </div>\r\n                    {debugInfo.firstPrescription && (\r\n                      <div className=\"mt-3\">\r\n                        <p><b>First Prescription:</b></p>\r\n                        <pre className=\"text-xs bg-gray-100 p-2 mt-1 max-h-40 overflow-auto rounded\">\r\n                          {JSON.stringify(debugInfo.firstPrescription, null, 2)}\r\n                        </pre>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          {/* Pagination */}\r\n          <div className=\"mt-8 flex flex-col md:flex-row justify-between items-center border-t border-gray-200 pt-5 gap-4\">\r\n            <div className=\"flex items-center gap-2 text-sm text-black\">\r\n              <p>\r\n                Hiển thị {filteredMedications.length > 0 ? \r\n                  `${indexOfFirstRecord + 1} - ${Math.min(indexOfLastRecord, filteredMedications.length)} của ${filteredMedications.length} kết quả` : \r\n                  \"0 kết quả\"}\r\n              </p>\r\n              \r\n              <select \r\n                className=\"ml-2 border border-gray-300 rounded-md py-1 px-2 focus:outline-none focus:ring-2 focus:ring-black focus:border-black\"\r\n                value={recordsPerPage}\r\n                onChange={(e) => {\r\n                  setRecordsPerPage(Number(e.target.value));\r\n                  setCurrentPage(1); // Reset to first page when changing items per page\r\n                }}\r\n              >\r\n                <option value={10}>10 mỗi trang</option>\r\n                <option value={20}>20 mỗi trang</option>\r\n                <option value={50}>50 mỗi trang</option>\r\n                <option value={100}>100 mỗi trang</option>\r\n                <option value={filteredMedications.length}>Hiển thị tất cả</option>\r\n              </select>\r\n            </div>\r\n            \r\n            {totalPages > 1 && (\r\n              <div className=\"inline-flex shadow-sm rounded-md\">\r\n                <button \r\n                  onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\r\n                  disabled={currentPage === 1}\r\n                  className={`px-4 py-2 border border-gray-300 text-sm font-medium rounded-l-md ${\r\n                    currentPage === 1 ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'bg-white text-black hover:bg-gray-50'\r\n                  } focus:z-10 focus:outline-none focus:ring-1 focus:ring-black focus:border-black transition-colors`}\r\n                >\r\n                  Trước\r\n                </button>\r\n                \r\n                {/* Show page numbers */}\r\n                {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\r\n                  // Logic to show pages around current page\r\n                  let pageToShow;\r\n                  if (totalPages <= 5) {\r\n                    pageToShow = i + 1;\r\n                  } else if (currentPage <= 3) {\r\n                    pageToShow = i + 1;\r\n                  } else if (currentPage >= totalPages - 2) {\r\n                    pageToShow = totalPages - 4 + i;\r\n                  } else {\r\n                    pageToShow = currentPage - 2 + i;\r\n                  }\r\n                  \r\n                  if (pageToShow > 0 && pageToShow <= totalPages) {\r\n                    return (\r\n                      <button\r\n                        key={pageToShow}\r\n                        onClick={() => setCurrentPage(pageToShow)}\r\n                        className={`px-4 py-2 border border-gray-300 relative -ml-px ${\r\n                          currentPage === pageToShow\r\n                            ? 'bg-blue-600 text-white'\r\n                            : 'bg-white text-black hover:bg-gray-50'\r\n                        } text-sm font-medium focus:z-10 focus:outline-none focus:ring-1 focus:ring-black focus:border-black transition-colors`}\r\n                      >\r\n                        {pageToShow}\r\n                      </button>\r\n                    );\r\n                  }\r\n                  return null;\r\n                })}\r\n                \r\n                <button \r\n                  onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}\r\n                  disabled={currentPage === totalPages}\r\n                  className={`px-4 py-2 border border-gray-300 text-sm font-medium rounded-r-md ${\r\n                    currentPage === totalPages ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'bg-white text-black hover:bg-gray-50'\r\n                  } focus:z-10 focus:outline-none focus:ring-1 focus:ring-black focus:border-black transition-colors`}\r\n                >\r\n                  Sau\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 7444, "column": 0}, "map": {"version":3,"sources":["file:///D:/Codes/Projects/hospitalityWeb/hospitality-website/my-app/src/app/receptionistPage/components/Appointments/AppointmentForm.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { XIcon, UserIcon, SearchIcon } from 'lucide-react';\r\nimport { User, searchUsers, getAllUsers, addQueue } from '../../../datats/mockPatients';\r\nimport * as apiService from '../../../services/api.service';\r\nimport { useAuth } from '../../../context/AuthContext';\r\n\r\ninterface AppointmentFormProps {\r\n  onClose: () => void;\r\n}\r\n\r\nexport function AppointmentForm({\r\n  onClose\r\n}: AppointmentFormProps) {\r\n  const [formData, setFormData] = useState({\r\n    patientId: '', // Lưu trữ ID của bệnh nhân\r\n    patientName: '',\r\n    patientPhone: '',\r\n    appointmentDate: new Date().toISOString().split('T')[0], // Today's date as default\r\n    appointmentTime: '09:00', // Default time\r\n    status: 'pending' // Default status for appointments\r\n  });\r\n  \r\n  const [selectedPatient, setSelectedPatient] = useState<User | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [searchResults, setSearchResults] = useState<User[]>([]);\r\n  const [patients, setPatients] = useState<User[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const { token } = useAuth();\r\n  \r\n  // Tải dữ liệu bệnh nhân khi component được tạo\r\n  useEffect(() => {\r\n    const loadPatients = async () => {\r\n      const allUsers = await getAllUsers();\r\n      const patientUsers = allUsers.filter(user => user.role === 'PATIENT');\r\n      setPatients(patientUsers);\r\n    };\r\n    \r\n    loadPatients();\r\n  }, []);\r\n\r\n  // Xử lý tìm kiếm bệnh nhân\r\n  useEffect(() => {\r\n    const searchPatientsAsync = async () => {\r\n      if (searchTerm.length > 0) {\r\n        // Sử dụng hàm searchUsers từ mockPatients.ts và lọc chỉ lấy các user có role='PATIENT'\r\n        const results = await searchUsers(searchTerm);\r\n        const filteredResults = results.filter(user => user.role === 'PATIENT');\r\n        setSearchResults(filteredResults);\r\n      } else {\r\n        setSearchResults([]);\r\n      }\r\n    };\r\n    \r\n    searchPatientsAsync();\r\n  }, [searchTerm]);\r\n\r\n  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setSearchTerm(e.target.value);\r\n  };\r\n\r\n  const selectPatient = (patient: User) => {\r\n    setSelectedPatient(patient);\r\n    setFormData({\r\n      ...formData,\r\n      patientId: patient._id,\r\n      patientName: patient.fullName,\r\n      patientPhone: patient.phone\r\n    });\r\n    setSearchTerm('');\r\n    setSearchResults([]);\r\n  };\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData({\r\n      ...formData,\r\n      [name]: value\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!selectedPatient) {\r\n      alert('Vui lòng chọn bệnh nhân');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      \r\n      // Create appointment object\r\n      const appointmentData = {\r\n        patientId: formData.patientId,\r\n        patientName: formData.patientName,\r\n        patientPhone: formData.patientPhone,\r\n        appointmentDate: formData.appointmentDate,\r\n        appointmentTime: formData.appointmentTime,\r\n        status: formData.status\r\n      };\r\n      \r\n      // Create appointment via API if token exists\r\n      let success = false;\r\n      if (token) {\r\n        try {\r\n          const createdAppointment = await apiService.createAppointment(appointmentData, token);\r\n          if (createdAppointment && createdAppointment._id) {\r\n            success = true;\r\n          }\r\n        } catch (apiError) {\r\n          console.error(\"API Error creating appointment:\", apiError);\r\n        }\r\n      }\r\n      \r\n      // Fallback: Add to queue directly if API fails or no token\r\n      if (!success) {\r\n        // Add the patient to queue as a fallback\r\n        const queueStatus = 'waiting' as const;\r\n        const newQueue = await addQueue(formData.patientId, queueStatus);\r\n        \r\n        if (newQueue) {\r\n          console.log('Patient added to queue as fallback:', newQueue);\r\n          success = true;\r\n        }\r\n      }\r\n      \r\n      if (success) {\r\n        alert(`Đã đặt lịch hẹn cho bệnh nhân ${selectedPatient.fullName}!`);\r\n        onClose();\r\n      } else {\r\n        alert('Không thể đặt lịch hẹn. Vui lòng thử lại sau.');\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error creating appointment:\", error);\r\n      alert('Đã xảy ra lỗi khi đặt lịch hẹn. Vui lòng thử lại sau.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"bg-white rounded-lg shadow\">\r\n      <div className=\"flex justify-between items-center border-b p-4\">\r\n        <h2 className=\"text-xl font-semibold text-gray-800\">Đặt lịch khám</h2>\r\n        <div className=\"flex items-center\">\r\n          <span className=\"text-sm text-gray-500 mr-3\">ID và version sẽ được tạo tự động</span>\r\n          <button onClick={onClose} className=\"p-1 rounded-full hover:bg-gray-200\">\r\n            <XIcon size={20} className=\"text-gray-500\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      <form onSubmit={handleSubmit} className=\"p-6\">\r\n        {/* Tìm kiếm bệnh nhân */}\r\n        <div className=\"mb-6\">\r\n          <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n            Tìm bệnh nhân (patient) <span className=\"text-red-500\">*</span>\r\n          </label>\r\n          \r\n          <div className=\"relative\">\r\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n              <SearchIcon size={18} className=\"text-gray-400\" />\r\n            </div>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Tìm theo tên, CCCD hoặc số điện thoại...\"\r\n              className=\"pl-10 pr-4 py-2 border border-gray-300 rounded-md w-full text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n              value={searchTerm}\r\n              onChange={handleSearchChange}\r\n            />\r\n          </div>\r\n          \r\n          {searchResults.length > 0 && (\r\n            <div className=\"mt-2 border border-gray-200 rounded-md max-h-60 overflow-y-auto bg-white shadow-md\">\r\n              {searchResults.map((patient) => (\r\n                <div\r\n                  key={patient._id}\r\n                  className=\"p-3 border-b border-gray-100 hover:bg-blue-50 cursor-pointer flex items-center\"\r\n                  onClick={() => selectPatient(patient)}\r\n                >\r\n                  <UserIcon size={20} className=\"text-gray-500 mr-2\" />\r\n                  <div>\r\n                    <p className=\"font-medium text-gray-800\">{patient.fullName}</p>\r\n                    <div className=\"text-sm text-gray-500\">\r\n                      ID: {patient.userId} | SĐT: {patient.phone}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n          \r\n          {/* Hiển thị bệnh nhân đã chọn */}\r\n          {selectedPatient && (\r\n            <div className=\"mt-4 p-3 border border-blue-200 rounded-md bg-blue-50\">\r\n              <div className=\"flex justify-between\">\r\n                <div className=\"flex items-center\">\r\n                  <UserIcon size={20} className=\"text-blue-500 mr-2\" />\r\n                  <div>\r\n                    <p className=\"font-medium text-gray-800\">{selectedPatient.fullName}</p>\r\n                    <div className=\"text-sm text-gray-600\">\r\n                      ID: {selectedPatient.userId} | SĐT: {selectedPatient.phone}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => {\r\n                    setSelectedPatient(null);\r\n                    setFormData({...formData, patientId: '', patientName: '', patientPhone: ''});\r\n                  }}\r\n                  className=\"text-gray-500 hover:text-red-500\"\r\n                >\r\n                  <XIcon size={18} />\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Date and Time */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\r\n          {/* Appointment Date */}\r\n          <div>\r\n            <label className=\"block text-sm font-semibold text-gray-700 mb-2\" htmlFor=\"appointmentDate\">\r\n              Ngày hẹn <span className=\"text-red-500\">*</span>\r\n            </label>\r\n            <input\r\n              type=\"date\"\r\n              id=\"appointmentDate\"\r\n              name=\"appointmentDate\"\r\n              min={new Date().toISOString().split('T')[0]}\r\n              className=\"w-full border border-gray-300 rounded-md px-3 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n              value={formData.appointmentDate}\r\n              onChange={handleInputChange}\r\n              required\r\n            />\r\n          </div>\r\n          \r\n          {/* Appointment Time */}\r\n          <div>\r\n            <label className=\"block text-sm font-semibold text-gray-700 mb-2\" htmlFor=\"appointmentTime\">\r\n              Thời gian <span className=\"text-red-500\">*</span>\r\n            </label>\r\n            <input\r\n              type=\"time\"\r\n              id=\"appointmentTime\"\r\n              name=\"appointmentTime\"\r\n              className=\"w-full border border-gray-300 rounded-md px-3 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n              value={formData.appointmentTime}\r\n              onChange={handleInputChange}\r\n              required\r\n            />\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Trạng thái */}\r\n        <div className=\"mb-6\">\r\n          <label className=\"block text-sm font-semibold text-gray-700 mb-2\" htmlFor=\"status\">\r\n            Trạng thái cuộc hẹn\r\n          </label>\r\n          <select\r\n            id=\"status\"\r\n            name=\"status\"\r\n            className=\"w-full border border-gray-300 rounded-md px-3 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n            value={formData.status}\r\n            onChange={handleInputChange}\r\n          >\r\n            <option value=\"pending\">Đang chờ xác nhận (pending)</option>\r\n            <option value=\"confirmed\">Đã xác nhận (confirmed)</option>\r\n            <option value=\"canceled\">Đã hủy (canceled)</option>\r\n          </select>\r\n        </div>\r\n        \r\n        <div className=\"mt-8 flex justify-end space-x-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50\"\r\n            disabled={loading}\r\n          >\r\n            Hủy bỏ\r\n          </button>\r\n          <button\r\n            type=\"submit\"\r\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed\"\r\n            disabled={!selectedPatient || loading}\r\n          >\r\n            {loading ? 'Đang xử lý...' : 'Đặt lịch'}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 8052, "column": 0}, "map": {"version":3,"sources":["file:///D:/Codes/Projects/hospitalityWeb/hospitality-website/my-app/src/app/receptionistPage/AppointmentBooking.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { CalendarIcon, SearchIcon, CheckCircleIcon, XIcon } from 'lucide-react';\r\nimport { AppointmentForm } from './components/Appointments/AppointmentForm';\r\nimport { \r\n  getAllPatients, \r\n  getQueuesByStatus, \r\n  addQueue\r\n} from '../datats/mockPatients';\r\nimport { User } from '../datats/mockPatients';\r\nimport axiosInstance from '../services/axios.customize.service';\r\nimport * as apiService from '../services/api.service';\r\nimport { useAuth } from '../context/AuthContext';\r\n\r\ninterface AppointmentBookingProps {\r\n  onBack: () => void;\r\n}\r\n\r\n// Interface for our appointment data structure\r\ninterface Appointment {\r\n  id: string;\r\n  name: string;\r\n  userId: string;\r\n  phone: string;\r\n  appointmentDate: string;\r\n  appointmentTime: string;\r\n  status: 'pending' | 'confirmed' | 'completed' | 'canceled';\r\n}\r\n\r\nexport function AppointmentBooking({ onBack }: AppointmentBookingProps) {\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [appointments, setAppointments] = useState<Appointment[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const { token } = useAuth();\r\n\r\n  // Load appointments from API\r\n  useEffect(() => {\r\n    const loadAppointments = async () => {\r\n      try {\r\n        setLoading(true);\r\n        \r\n        // Get patients for mapping \r\n        const patients = await getAllPatients();\r\n        \r\n        // In a real implementation, fetch appointments from the API\r\n        // For now, generate mock appointments from patient data\r\n        if (token) {\r\n          // Try to get appointments from API\r\n          try {\r\n            const apiAppointments = await apiService.getAppointments(token);\r\n            if (apiAppointments && Array.isArray(apiAppointments)) {\r\n              // Format appointments from API\r\n              const formattedAppointments = apiAppointments.map((appt: any) => ({\r\n                id: appt._id,\r\n                name: appt.patientName || 'Unknown',\r\n                userId: appt.patientId || '',\r\n                phone: appt.patientPhone || '',\r\n                appointmentDate: new Date(appt.appointmentDate).toISOString().split('T')[0],\r\n                appointmentTime: appt.appointmentTime,\r\n                status: appt.status as 'pending' | 'confirmed' | 'completed' | 'canceled'\r\n              }));\r\n              setAppointments(formattedAppointments);\r\n              setLoading(false);\r\n              return;\r\n            }\r\n          } catch (apiError) {\r\n            console.log('Could not fetch appointments from API, falling back to mock data', apiError);\r\n          }\r\n        }\r\n\r\n        // Fallback: Generate mock appointments from patient data\r\n        const today = new Date();\r\n        const mockAppointments = patients.slice(0, 5).map((patient, index) => {\r\n          const appointmentHour = 9 + index;\r\n          const appointmentDate = new Date();\r\n          appointmentDate.setDate(today.getDate() + (index % 3)); // Distribute over next 3 days\r\n          \r\n          return {\r\n            id: patient._id,\r\n            name: patient.fullName,\r\n            userId: patient.userId,\r\n            phone: patient.phone,\r\n            appointmentDate: appointmentDate.toISOString().split('T')[0],\r\n            appointmentTime: `${appointmentHour < 10 ? '0' + appointmentHour : appointmentHour}:00`,\r\n            status: (index % 2 === 0) ? 'pending' : 'confirmed'\r\n          } as Appointment;\r\n        });\r\n        \r\n        setAppointments(mockAppointments);\r\n      } catch (err) {\r\n        console.error(\"Error loading appointments:\", err);\r\n        setError(\"Could not load appointments. Please try again later.\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    \r\n    loadAppointments();\r\n  }, [token]);\r\n  \r\n  const filteredAppointments = appointments.filter(appointment => \r\n    appointment.name.toLowerCase().includes(searchTerm.toLowerCase()) || \r\n    appointment.userId.includes(searchTerm) ||\r\n    appointment.phone.includes(searchTerm)\r\n  );\r\n  \r\n  const handleMoveToQueue = async (appointmentId: string) => {\r\n    try {\r\n      // Add patient to queue using the addQueue function (now async)\r\n      const result = await addQueue(appointmentId, 'waiting');\r\n      \r\n      if (result) {\r\n        // Update appointment status\r\n        setAppointments(appointments.map(appt => \r\n          appt.id === appointmentId ? {...appt, status: 'completed' as const} : appt\r\n        ));\r\n        \r\n        // In a real implementation, update the appointment status in the API\r\n        if (token) {\r\n          try {\r\n            const appointmentToUpdate = appointments.find(a => a.id === appointmentId);\r\n            if (appointmentToUpdate) {\r\n              await apiService.updateAppointment(\r\n                appointmentId, \r\n                { status: 'completed' }, \r\n                token\r\n              );\r\n            }\r\n          } catch (apiError) {\r\n            console.error(\"Failed to update appointment status in API:\", apiError);\r\n          }\r\n        }\r\n        \r\n        alert('Đã chuyển bệnh nhân vào phòng chờ!');\r\n      } else {\r\n        alert('Bệnh nhân đã có trong phòng chờ hoặc không thể thêm!');\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error adding patient to queue:\", error);\r\n      alert('Đã xảy ra lỗi khi chuyển bệnh nhân vào phòng chờ!');\r\n    }\r\n  };\r\n  \r\n  if (loading) return <div className=\"p-8 text-center\">Đang tải dữ liệu...</div>;\r\n  \r\n  if (error) return <div className=\"p-8 text-center text-red-500\">{error}</div>;\r\n  \r\n  return <div>\r\n      <div className=\"flex items-center mb-4\">\r\n        <button \r\n          onClick={onBack}\r\n          className=\"mr-4 px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-md flex items-center text-gray-700\"\r\n        >\r\n          ← Quay lại\r\n        </button>\r\n      </div>\r\n      <div className=\"mb-8 border-b border-gray-200 pb-5\">\r\n        <h1 className=\"text-3xl font-bold text-black tracking-tight\">Đặt lịch khám</h1>\r\n        <p className=\"text-black mt-2\">\r\n          Quản lý các cuộc hẹn khám bệnh và điều phối lịch\r\n        </p>\r\n      </div>\r\n      \r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n        <div className=\"lg:col-span-2\">\r\n          <div className=\"bg-white rounded-xl shadow border border-gray-200 overflow-hidden\">\r\n            <div className=\"flex justify-between items-center p-6 border-b border-gray-200\">\r\n              <h2 className=\"text-xl font-semibold text-black\">Lịch hẹn</h2>\r\n              <button \r\n                onClick={() => setShowForm(true)}\r\n                className=\"bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-4 py-2 flex items-center text-sm font-medium transition-colors\"\r\n              >\r\n                <CalendarIcon className=\"w-4 h-4 mr-2\" />\r\n                Thêm lịch hẹn\r\n              </button>\r\n            </div>\r\n            \r\n            <div className=\"p-6 border-b border-gray-200\">\r\n              <div className=\"relative\">\r\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                  <SearchIcon size={18} className=\"text-black\" />\r\n                </div>\r\n                <input \r\n                  type=\"text\" \r\n                  placeholder=\"Tìm kiếm theo tên, ID hoặc số điện thoại...\" \r\n                  className=\"pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-black focus:border-black shadow-sm\" \r\n                  value={searchTerm}\r\n                  onChange={e => setSearchTerm(e.target.value)}\r\n                />\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full divide-y divide-gray-200\">\r\n                <thead className=\"bg-gray-50\">\r\n                  <tr>\r\n                    <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Bệnh nhân\r\n                    </th>\r\n                    <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Thời gian\r\n                    </th>\r\n                    <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Trạng thái\r\n                    </th>\r\n                    <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Thao tác\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                  {filteredAppointments.length > 0 ? (\r\n                    filteredAppointments.map((appointment) => (\r\n                      <tr key={appointment.id} className=\"hover:bg-gray-50\">\r\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                          <div className=\"text-sm font-medium text-gray-900\">{appointment.name}</div>\r\n                          <div className=\"text-sm text-gray-500\">ID: {appointment.userId}</div>\r\n                          <div className=\"text-sm text-gray-500\">SĐT: {appointment.phone}</div>\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                          <div className=\"text-sm text-gray-900\">\r\n                            {new Date(appointment.appointmentDate).toLocaleDateString('vi-VN')}\r\n                          </div>\r\n                          <div className=\"text-sm text-gray-500\">{appointment.appointmentTime}</div>\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                          <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n                            appointment.status === 'confirmed' \r\n                              ? 'bg-green-100 text-green-800' \r\n                              : appointment.status === 'canceled'\r\n                              ? 'bg-red-100 text-red-800'\r\n                              : appointment.status === 'completed'\r\n                              ? 'bg-blue-100 text-blue-800'\r\n                              : 'bg-yellow-100 text-yellow-800'\r\n                          }`}>\r\n                            {appointment.status === 'confirmed' \r\n                              ? 'Đã xác nhận' \r\n                              : appointment.status === 'canceled'\r\n                              ? 'Đã hủy'\r\n                              : appointment.status === 'completed'\r\n                              ? 'Đã hoàn thành'\r\n                              : 'Đang chờ'}\r\n                          </span>\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                          {appointment.status !== 'completed' && appointment.status !== 'canceled' && (\r\n                            <button \r\n                              onClick={() => handleMoveToQueue(appointment.id)}\r\n                              className=\"text-white bg-blue-600 hover:bg-blue-700 px-3 py-1.5 rounded-md mr-2 flex items-center\"\r\n                            >\r\n                              <CheckCircleIcon className=\"w-4 h-4 mr-1\" />\r\n                              Chuyển vào phòng chờ\r\n                            </button>\r\n                          )}\r\n                        </td>\r\n                      </tr>\r\n                    ))\r\n                  ) : (\r\n                    <tr>\r\n                      <td colSpan={4} className=\"px-6 py-10 text-center text-sm text-gray-500\">\r\n                        Không tìm thấy lịch hẹn nào\r\n                      </td>\r\n                    </tr>\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n            \r\n            <div className=\"p-4 bg-gray-50 border-t border-gray-200\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"text-sm text-gray-700\">\r\n                  Hiển thị {filteredAppointments.length} trong tổng số {appointments.length} lịch hẹn\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div>\r\n          <div className=\"bg-white rounded-xl shadow border border-gray-200 overflow-hidden\">\r\n            <div className=\"p-6 border-b border-gray-200\">\r\n              <h2 className=\"text-xl font-semibold text-black\">Lịch hẹn hôm nay</h2>\r\n              <p className=\"mt-1 text-sm text-gray-500\">\r\n                {new Date().toLocaleDateString('vi-VN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\r\n              </p>\r\n            </div>\r\n            <div className=\"p-6\">\r\n              {appointments.filter(a => a.appointmentDate === new Date().toISOString().split('T')[0]).length > 0 ? (\r\n                <ul className=\"divide-y divide-gray-200\">\r\n                  {appointments\r\n                    .filter(a => a.appointmentDate === new Date().toISOString().split('T')[0])\r\n                    .map(appointment => (\r\n                      <li key={appointment.id} className=\"py-4\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <div>\r\n                            <p className=\"text-sm font-medium text-black\">{appointment.appointmentTime}</p>\r\n                            <p className=\"text-sm text-gray-600 mt-1\">{appointment.name}</p>\r\n                          </div>\r\n                          <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n                            appointment.status === 'confirmed' \r\n                              ? 'bg-green-100 text-green-800' \r\n                              : appointment.status === 'canceled'\r\n                              ? 'bg-red-100 text-red-800'\r\n                              : appointment.status === 'completed'\r\n                              ? 'bg-blue-100 text-blue-800'\r\n                              : 'bg-yellow-100 text-yellow-800'\r\n                          }`}>\r\n                            {appointment.status === 'confirmed' \r\n                              ? 'Đã xác nhận' \r\n                              : appointment.status === 'canceled'\r\n                              ? 'Đã hủy'\r\n                              : appointment.status === 'completed'\r\n                              ? 'Đã hoàn thành'\r\n                              : 'Đang chờ'}\r\n                          </span>\r\n                        </div>\r\n                      </li>\r\n                    ))\r\n                  }\r\n                </ul>\r\n              ) : (\r\n                <div className=\"text-center py-8\">\r\n                  <CalendarIcon className=\"mx-auto h-12 w-12 text-gray-400\" />\r\n                  <h3 className=\"mt-2 text-sm font-medium text-gray-900\">Không có lịch hẹn hôm nay</h3>\r\n                  <p className=\"mt-1 text-sm text-gray-500\">\r\n                    Chưa có lịch hẹn nào được đặt cho hôm nay.\r\n                  </p>\r\n                  <div className=\"mt-6\">\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setShowForm(true)}\r\n                      className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\r\n                    >\r\n                      <CalendarIcon className=\"-ml-1 mr-2 h-5 w-5\" aria-hidden=\"true\" />\r\n                      Thêm lịch hẹn\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Appointment Form Modal */}\r\n      {showForm && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n            <AppointmentForm onClose={() => setShowForm(false)} />\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>;\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 8781, "column": 0}, "map": {"version":3,"sources":["file:///D:/Codes/Projects/hospitalityWeb/hospitality-website/my-app/src/app/receptionistPage/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Dashboard } from './Dashboard';\r\nimport { PatientManagement } from './PatientManagement';\r\nimport { QueueManagement } from './QueueManagement';\r\nimport { MedicationHistory } from './MedicationHistory';\r\nimport { AppointmentBooking } from './AppointmentBooking';\r\n\r\nexport default function ReceptionistPage() {\r\n  const { user, isAuthenticated, logout } = useAuth();\r\n  const router = useRouter();\r\n  const [currentView, setCurrentView] = useState('Dashboard');\r\n\r\n  useEffect(() => {\r\n    if (!isAuthenticated) {\r\n      router.push('/login');\r\n    } else if (user?.role !== 'RECEPTIONIST') {\r\n      logout();\r\n      router.push('/login');\r\n    }\r\n  }, [isAuthenticated, router, user, logout]);\r\n\r\n  if (!isAuthenticated || !user) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const renderCurrentView = () => {\r\n    switch(currentView) {\r\n      case 'PatientManagement':\r\n        return <PatientManagement onBack={() => setCurrentView('Dashboard')} />;\r\n      case 'QueueManagement':\r\n        return <QueueManagement onBack={() => setCurrentView('Dashboard')} />;\r\n      case 'MedicationHistory':\r\n        return <MedicationHistory onBack={() => setCurrentView('Dashboard')} />;\r\n      case 'AppointmentBooking':  // Thêm case này để xử lý AppointmentBooking\r\n        return <AppointmentBooking onBack={() => setCurrentView('Dashboard')} />;\r\n      case 'Dashboard':\r\n      default:\r\n        return <Dashboard onNavigate={(view) => setCurrentView(view)} />;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col w-full min-h-screen bg-gray-50\">\r\n      {renderCurrentView()}\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AATA;;;;;;;;;AAWe,SAAS;;IACtB,MAAM,EAAE,IAAI,EAAE,eAAe,EAAE,MAAM,EAAE,GAAG,CAAA,GAAA,wIAAA,CAAA,UAAO,AAAD;IAChD,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAE/C,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;sCAAE;YACR,IAAI,CAAC,iBAAiB;gBACpB,OAAO,IAAI,CAAC;YACd,OAAO,IAAI,MAAM,SAAS,gBAAgB;gBACxC;gBACA,OAAO,IAAI,CAAC;YACd;QACF;qCAAG;QAAC;QAAiB;QAAQ;QAAM;KAAO;IAE1C,IAAI,CAAC,mBAAmB,CAAC,MAAM;QAC7B,qBACE,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC;gBAAI,WAAU;;;;;;;;;;;IAGrB;IAEA,MAAM,oBAAoB;QACxB,OAAO;YACL,KAAK;gBACH,qBAAO,6LAAC,uJAAA,CAAA,oBAAiB;oBAAC,QAAQ,IAAM,eAAe;;;;;;YACzD,KAAK;gBACH,qBAAO,6LAAC,qJAAA,CAAA,kBAAe;oBAAC,QAAQ,IAAM,eAAe;;;;;;YACvD,KAAK;gBACH,qBAAO,6LAAC,uJAAA,CAAA,oBAAiB;oBAAC,QAAQ,IAAM,eAAe;;;;;;YACzD,KAAK;gBACH,qBAAO,6LAAC,wJAAA,CAAA,qBAAkB;oBAAC,QAAQ,IAAM,eAAe;;;;;;YAC1D,KAAK;YACL;gBACE,qBAAO,6LAAC,+IAAA,CAAA,YAAS;oBAAC,YAAY,CAAC,OAAS,eAAe;;;;;;QAC3D;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACZ;;;;;;AAGP;GA3CwB;;QACoB,wIAAA,CAAA,UAAO;QAClC,qIAAA,CAAA,YAAS;;;KAFF","debugId":null}}]
}