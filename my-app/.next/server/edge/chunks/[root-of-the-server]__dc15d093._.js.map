{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\n\r\nexport function middleware(request: NextRequest) {\r\n  const isAuthenticated = request.cookies.has('user'); \r\n  const isAuthPage = request.nextUrl.pathname === '/login';\r\n  const isDashboardRoute = request.nextUrl.pathname.startsWith('/dashboard-doctor');\r\n  const isPharmacyRoute = request.nextUrl.pathname.startsWith('/pharmacyPage');\r\n  const isReceptionistRoute = request.nextUrl.pathname.startsWith('/receptionistPage');\r\n\r\n  // Log current path and authentication status for debugging\r\n  console.log('Current path:', request.nextUrl.pathname);\r\n  console.log('Is authenticated:', isAuthenticated);\r\n\r\n  // Nếu đã đăng nhập và cố truy cập trang login, chuyển hướng về trang phù hợp\r\n  if (isAuthenticated && isAuthPage) {\r\n    // Lấy thông tin user từ cookie để xác định vai trò\r\n    const userCookie = request.cookies.get('user');\r\n    const user = userCookie ? JSON.parse(userCookie.value) : null;\r\n    \r\n    // Log user data for debugging\r\n    console.log('User cookie value:', JSON.stringify(user));\r\n    console.log('User role (raw):', user?.role);\r\n    \r\n    // Sử dụng cách tiếp cận an toàn với kiểm tra rõ ràng hơn\r\n    let userRole = '';\r\n    if (user && typeof user.role === 'string') {\r\n      userRole = user.role.toUpperCase();\r\n      console.log('User role (uppercase):', userRole);\r\n    }\r\n    \r\n    // Kiểm tra vai trò và chuyển hướng tương ứng\r\n    if (userRole === 'PHARMACIST') {\r\n      console.log('Redirecting to pharmacy page');\r\n      return NextResponse.redirect(new URL('/pharmacyPage', request.url));\r\n    } else if (userRole === 'RECEPTIONIST') {\r\n      console.log('Redirecting to receptionist page');\r\n      return NextResponse.redirect(new URL('/receptionistPage', request.url));\r\n    } else if (userRole === 'PATIENT') {\r\n      console.log('Redirecting to home page for patient');\r\n      return NextResponse.redirect(new URL('/', request.url));\r\n    } else if (userRole === 'DOCTOR') {\r\n      console.log('Redirecting to doctor dashboard');\r\n      return NextResponse.redirect(new URL('/dashboard-doctor', request.url));\r\n    } else {\r\n      console.log('No specific role matched, using fallback redirect to home');\r\n      // Fallback for any other roles or if role is not defined\r\n      return NextResponse.redirect(new URL('/', request.url));\r\n    }\r\n  }\r\n\r\n  // Nếu chưa đăng nhập và cố truy cập các trang được bảo vệ\r\n  if (!isAuthenticated && (isDashboardRoute || isPharmacyRoute || isReceptionistRoute)) {\r\n    console.log('Unauthorized access attempt, redirecting to login');\r\n    return NextResponse.redirect(new URL('/login', request.url));\r\n  }\r\n  \r\n  // Nếu đã đăng nhập, kiểm tra xem có truy cập đúng route dựa theo vai trò hay không\r\n  if (isAuthenticated && (isDashboardRoute || isPharmacyRoute || isReceptionistRoute)) {\r\n    const userCookie = request.cookies.get('user');\r\n    const user = userCookie ? JSON.parse(userCookie.value) : null;\r\n    \r\n    if (user) {\r\n      const userRole = typeof user.role === 'string' ? user.role.toUpperCase() : '';\r\n      console.log('Authenticated user accessing protected route:', request.nextUrl.pathname);\r\n      console.log('User role for route check:', userRole);\r\n      \r\n      // Kiểm tra quyền truy cập route\r\n      const isDoctorAccessing = isDashboardRoute && userRole !== 'DOCTOR';\r\n      const isPharmacistAccessing = isPharmacyRoute && userRole !== 'PHARMACIST';\r\n      const isReceptionistAccessing = isReceptionistRoute && userRole !== 'RECEPTIONIST';\r\n      \r\n      // Nếu truy cập sai route theo vai trò, chuyển hướng về trang phù hợp\r\n      if (isDoctorAccessing || isPharmacistAccessing || isReceptionistAccessing) {\r\n        console.log('User attempting to access unauthorized route, redirecting to appropriate page');\r\n        \r\n        if (userRole === 'DOCTOR') {\r\n          return NextResponse.redirect(new URL('/dashboard-doctor', request.url));\r\n        } else if (userRole === 'PHARMACIST') {\r\n          return NextResponse.redirect(new URL('/pharmacyPage', request.url));\r\n        } else if (userRole === 'RECEPTIONIST') {\r\n          return NextResponse.redirect(new URL('/receptionistPage', request.url));\r\n        } else if (userRole === 'PATIENT') {\r\n          return NextResponse.redirect(new URL('/', request.url));\r\n        } else {\r\n          return NextResponse.redirect(new URL('/', request.url));\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  console.log('Proceeding with the request');\r\n  return NextResponse.next();\r\n}\r\n\r\n// Cập nhật matcher để bao gồm cả route receptionistPage\r\nexport const config = {\r\n  matcher: ['/login', '/dashboard-doctor/:path*', '/pharmacyPage/:path*', '/receptionistPage/:path*'],\r\n};"],"names":[],"mappings":";;;;AAAA;AAAA;;AAGO,SAAS,WAAW,OAAoB;IAC7C,MAAM,kBAAkB,QAAQ,OAAO,CAAC,GAAG,CAAC;IAC5C,MAAM,aAAa,QAAQ,OAAO,CAAC,QAAQ,KAAK;IAChD,MAAM,mBAAmB,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAC7D,MAAM,kBAAkB,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAC5D,MAAM,sBAAsB,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAEhE,2DAA2D;IAC3D,QAAQ,GAAG,CAAC,iBAAiB,QAAQ,OAAO,CAAC,QAAQ;IACrD,QAAQ,GAAG,CAAC,qBAAqB;IAEjC,6EAA6E;IAC7E,IAAI,mBAAmB,YAAY;QACjC,mDAAmD;QACnD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,MAAM,OAAO,aAAa,KAAK,KAAK,CAAC,WAAW,KAAK,IAAI;QAEzD,8BAA8B;QAC9B,QAAQ,GAAG,CAAC,sBAAsB,KAAK,SAAS,CAAC;QACjD,QAAQ,GAAG,CAAC,oBAAoB,MAAM;QAEtC,yDAAyD;QACzD,IAAI,WAAW;QACf,IAAI,QAAQ,OAAO,KAAK,IAAI,KAAK,UAAU;YACzC,WAAW,KAAK,IAAI,CAAC,WAAW;YAChC,QAAQ,GAAG,CAAC,0BAA0B;QACxC;QAEA,6CAA6C;QAC7C,IAAI,aAAa,cAAc;YAC7B,QAAQ,GAAG,CAAC;YACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB,QAAQ,GAAG;QACnE,OAAO,IAAI,aAAa,gBAAgB;YACtC,QAAQ,GAAG,CAAC;YACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,qBAAqB,QAAQ,GAAG;QACvE,OAAO,IAAI,aAAa,WAAW;YACjC,QAAQ,GAAG,CAAC;YACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACvD,OAAO,IAAI,aAAa,UAAU;YAChC,QAAQ,GAAG,CAAC;YACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,qBAAqB,QAAQ,GAAG;QACvE,OAAO;YACL,QAAQ,GAAG,CAAC;YACZ,yDAAyD;YACzD,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACvD;IACF;IAEA,0DAA0D;IAC1D,IAAI,CAAC,mBAAmB,CAAC,oBAAoB,mBAAmB,mBAAmB,GAAG;QACpF,QAAQ,GAAG,CAAC;QACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,mFAAmF;IACnF,IAAI,mBAAmB,CAAC,oBAAoB,mBAAmB,mBAAmB,GAAG;QACnF,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,MAAM,OAAO,aAAa,KAAK,KAAK,CAAC,WAAW,KAAK,IAAI;QAEzD,IAAI,MAAM;YACR,MAAM,WAAW,OAAO,KAAK,IAAI,KAAK,WAAW,KAAK,IAAI,CAAC,WAAW,KAAK;YAC3E,QAAQ,GAAG,CAAC,iDAAiD,QAAQ,OAAO,CAAC,QAAQ;YACrF,QAAQ,GAAG,CAAC,8BAA8B;YAE1C,gCAAgC;YAChC,MAAM,oBAAoB,oBAAoB,aAAa;YAC3D,MAAM,wBAAwB,mBAAmB,aAAa;YAC9D,MAAM,0BAA0B,uBAAuB,aAAa;YAEpE,qEAAqE;YACrE,IAAI,qBAAqB,yBAAyB,yBAAyB;gBACzE,QAAQ,GAAG,CAAC;gBAEZ,IAAI,aAAa,UAAU;oBACzB,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,qBAAqB,QAAQ,GAAG;gBACvE,OAAO,IAAI,aAAa,cAAc;oBACpC,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB,QAAQ,GAAG;gBACnE,OAAO,IAAI,aAAa,gBAAgB;oBACtC,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,qBAAqB,QAAQ,GAAG;gBACvE,OAAO,IAAI,aAAa,WAAW;oBACjC,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;gBACvD,OAAO;oBACL,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;gBACvD;YACF;QACF;IACF;IAEA,QAAQ,GAAG,CAAC;IACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;AAC1B;AAGO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAU;QAA4B;QAAwB;KAA2B;AACrG"}}]
}